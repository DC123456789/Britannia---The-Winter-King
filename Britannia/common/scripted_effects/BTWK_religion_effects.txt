

convert_to_flagged_religion_effect = {
	if = {
		limit = { has_character_flag = converted_catholic }
		religion = catholic
		clr_character_flag = converted_catholic
	}
	if = {
		limit = { has_character_flag = converted_pelagian }
		religion = pelagian
		clr_character_flag = converted_pelagian
	}
	if = {
		limit = { has_character_flag = converted_nestorian }
		religion = nestorian
		clr_character_flag = converted_nestorian
	}
	if = {
		limit = { has_character_flag = converted_priscillian }
		religion = priscillian
		clr_character_flag = converted_priscillian
	}
	if = {
		limit = { has_character_flag = converted_arian }
		religion = arian
		clr_character_flag = converted_arian
	}
	if = {
		limit = { has_character_flag = converted_gnostic }
		religion = gnostic
		clr_character_flag = converted_gnostic
	}
	if = {
		limit = { has_character_flag = converted_sunni }
		religion = sunni
		clr_character_flag = converted_sunni
	}
	if = {
		limit = { has_character_flag = converted_shiite }
		religion = shiite
		clr_character_flag = converted_shiite
	}
	if = {
		limit = { has_character_flag = converted_ibadi }
		religion = ibadi
		clr_character_flag = converted_ibadi
	}
	if = {
		limit = { has_character_flag = converted_jewish }
		religion = jewish
		clr_character_flag = converted_jewish
	}
	if = {
		limit = { has_character_flag = converted_manichean }
		religion = manichean
		clr_character_flag = converted_manichean
	}
	if = {
		limit = { has_character_flag = converted_briton_pagan }
		religion = briton_pagan
		clr_character_flag = converted_briton_pagan
	}
	if = {
		limit = { has_character_flag = converted_pict_pagan }
		religion = pict_pagan
		clr_character_flag = converted_pict_pagan
	}
	if = {
		limit = { has_character_flag = converted_gael_pagan }
		religion = gael_pagan
		clr_character_flag = converted_gael_pagan
	}
	if = {
		limit = { has_character_flag = converted_norse_pagan }
		religion = norse_pagan
		clr_character_flag = converted_norse_pagan
	}
	if = {
		limit = { has_character_flag = converted_germanic_pagan }
		religion = germanic_pagan
		clr_character_flag = converted_germanic_pagan
	}
	if = {
		limit = { has_character_flag = converted_frankish_pagan }
		religion = frankish_pagan
		clr_character_flag = converted_frankish_pagan
	}
	if = {
		limit = { has_character_flag = converted_suebic_pagan }
		religion = suebic_pagan
		clr_character_flag = converted_suebic_pagan
	}
	if = {
		limit = { has_character_flag = converted_gothic_pagan }
		religion = gothic_pagan
		clr_character_flag = converted_gothic_pagan
	}
	if = {
		limit = { has_character_flag = converted_alan_pagan }
		religion = alan_pagan
		clr_character_flag = converted_alan_pagan
	}
	if = {
		limit = { has_character_flag = converted_tengri_pagan }
		religion = tengri_pagan
		clr_character_flag = converted_tengri_pagan
	}
	if = {
		limit = { has_character_flag = converted_vasconic_pagan }
		religion = vasconic_pagan
		clr_character_flag = converted_vasconic_pagan
	}
	if = {
		limit = { has_character_flag = converted_briton_pagan_reformed }
		religion = briton_pagan_reformed
		clr_character_flag = converted_briton_pagan_reformed
	}
	if = {
		limit = { has_character_flag = converted_britannic_pagan }
		religion = britannic_pagan
		clr_character_flag = converted_britannic_pagan
	}
	if = {
		limit = { has_character_flag = converted_pict_pagan_reformed }
		religion = pict_pagan_reformed
		clr_character_flag = converted_pict_pagan_reformed
	}
	if = {
		limit = { has_character_flag = converted_gael_pagan_reformed }
		religion = gael_pagan_reformed
		clr_character_flag = converted_gael_pagan_reformed
	}
	if = {
		limit = { has_character_flag = converted_norse_pagan_reformed }
		religion = norse_pagan_reformed
		clr_character_flag = converted_norse_pagan_reformed
	}
	if = {
		limit = { has_character_flag = converted_germanic_pagan_reformed }
		religion = germanic_pagan_reformed
		clr_character_flag = converted_germanic_pagan_reformed
	}
	if = {
		limit = { has_character_flag = converted_frankish_pagan_reformed }
		religion = frankish_pagan_reformed
		clr_character_flag = converted_frankish_pagan_reformed
	}
	if = {
		limit = { has_character_flag = converted_suebic_pagan_reformed }
		religion = suebic_pagan_reformed
		clr_character_flag = converted_suebic_pagan_reformed
	}
	if = {
		limit = { has_character_flag = converted_gothic_pagan_reformed }
		religion = gothic_pagan_reformed
		clr_character_flag = converted_gothic_pagan_reformed
	}
	if = {
		limit = { has_character_flag = converted_alan_pagan_reformed }
		religion = alan_pagan_reformed
		clr_character_flag = converted_alan_pagan_reformed
	}
	if = {
		limit = { has_character_flag = converted_tengri_pagan_reformed }
		religion = tengri_pagan_reformed
		clr_character_flag = converted_tengri_pagan_reformed
	}
	if = {
		limit = { has_character_flag = converted_vasconic_pagan_reformed }
		religion = vasconic_pagan_reformed
		clr_character_flag = converted_vasconic_pagan_reformed
	}
	if = {
		limit = { has_character_flag = converted_roman_pagan }
		religion = roman_pagan
		clr_character_flag = converted_roman_pagan
	}
	if = {
		limit = { has_character_flag = converted_roman_pagan_reformed }
		religion = roman_pagan_reformed
		clr_character_flag = converted_roman_pagan_reformed
	}
	# if = {
		# limit = { has_character_flag = converted_sol_invictus }
		# religion = sol_invictus
		# clr_character_flag = converted_sol_invictus
	# }
	if = {
		limit = { has_character_flag = converted_titan_pagan }
		religion = titan_pagan
		clr_character_flag = converted_titan_pagan
	}
	if = {
		limit = { has_character_flag = converted_promethean_pagan }
		religion = promethean_pagan
		clr_character_flag = converted_promethean_pagan
	}
}

flag_culture_pagan_religion_effect = {
	if = {
		limit = { 
			AND = {
				is_brythonic_culture_trigger = yes
				NAND = { 
					culture = romanobritish # Hellenic lord spiritual on Romano-British will flip it directly
					FROM = {
						OR = {
							religion = roman_pagan 
							religion = roman_pagan_reformed 
							religion = sol_invictus 
						}
					}
				}
			}
		}
		if = {
			limit = { NOT = { has_global_flag = briton_reformation } }
			set_character_flag = converted_briton_pagan
		}
		if = {
			limit = { has_global_flag = briton_reformation }
			set_character_flag = converted_briton_pagan_reformed
		}
	}
	if = {
		limit = { culture = pictish }
		if = {
			limit = { NOT = { has_global_flag = pict_reformation } }
			set_character_flag = converted_pict_pagan
		}
		if = {
			limit = { has_global_flag = pict_reformation }
			set_character_flag = converted_pict_pagan_reformed
		}
	}
	if = {
		limit = { is_gaelic_culture_trigger = yes }
		if = {
			limit = { NOT = { has_global_flag = gael_reformation } }
			set_character_flag = converted_gael_pagan
		}
		if = {
			limit = { has_global_flag = gael_reformation }
			set_character_flag = converted_gael_pagan_reformed
		}
	}
	if = {
		limit = { is_north_germanic_trigger = yes }
		if = {
			limit = { NOT = { has_global_flag = norse_reformation } }
			set_character_flag = converted_norse_pagan
		}
		if = {
			limit = { has_global_flag = norse_reformation }
			set_character_flag = converted_norse_pagan_reformed
		}
	}
	if = {
		limit = { is_ingvaeonic_culture_trigger = yes }
		if = {
			limit = { NOT = { has_global_flag = germanic_reformation } }
			set_character_flag = converted_germanic_pagan
		}
		if = {
			limit = { has_global_flag = germanic_reformation }
			set_character_flag = converted_germanic_pagan_reformed
		}
	}
	if = {
		limit = { is_istvaeonic_culture_trigger = yes }
		if = {
			limit = { NOT = { has_global_flag = frankish_reformation } }
			set_character_flag = converted_frankish_pagan
		}
		if = {
			limit = { has_global_flag = frankish_reformation }
			set_character_flag = converted_frankish_pagan_reformed
		}
	}
	if = {
		limit = { is_irminonic_culture_trigger = yes }
		if = {
			limit = { NOT = { has_global_flag = suebic_reformation } }
			set_character_flag = converted_suebic_pagan
		}
		if = {
			limit = { has_global_flag = suebic_reformation }
			set_character_flag = converted_suebic_pagan_reformed
		}
	}
	if = {
		limit = { is_east_germanic_trigger = yes }
		if = {
			limit = { NOT = { has_global_flag = gothic_reformation } }
			set_character_flag = converted_gothic_pagan
		}
		if = {
			limit = { has_global_flag = gothic_reformation }
			set_character_flag = converted_gothic_pagan_reformed
		}
	}
	if = {
		limit = { culture_group = sarmatian }
		if = {
			limit = { NOT = { has_global_flag = alan_reformation } }
			set_character_flag = converted_alan_pagan
		}
		if = {
			limit = { has_global_flag = alan_reformation }
			set_character_flag = converted_alan_pagan_reformed
		}
	}
	if = {
		limit = { culture_group = altaic }
		if = {
			limit = { NOT = { has_global_flag = tengri_reformation } }
			set_character_flag = converted_tengri_pagan
		}
		if = {
			limit = { has_global_flag = tengri_reformation }
			set_character_flag = converted_tengri_pagan_reformed
		}
	}
	if = {
		limit = { culture_group = basque }
		if = {
			limit = { NOT = { has_global_flag = vasconic_reformation } }
			set_character_flag = converted_vasconic_pagan
		}
		if = {
			limit = { has_global_flag = vasconic_reformation }
			set_character_flag = converted_vasconic_pagan_reformed
		}
	}
	if = {
		limit = { 
			OR = { 
				is_roman_pagan_culture_trigger = yes 
				AND = { 
					culture = romanobritish # Hellenic lord spiritual on Romano-British will flip it directly
					FROM = {
						OR = {
							religion = roman_pagan 
							religion = roman_pagan_reformed 
							religion = sol_invictus 
						}
					}
				}
			}
		}
		if = {
			limit = { NOT = { has_global_flag = roman_reformation } }
			set_character_flag = converted_roman_pagan
		}
		else = {
			set_character_flag = converted_roman_pagan_reformed
		}
		# if = {
			# limit = { has_global_flag = roman_reformation_sol_invictus }
			# set_character_flag = converted_sol_invictus
		# }
	}
	if = {
		limit = { culture_group = israelite }
		set_character_flag = converted_jewish
	}
}

destroy_held_religion_head_title_effect = {
	if = {
		limit = { 
			NOR = {
				AND = {
					has_religion_features = no
					is_celtic_pagan_trigger = yes
				}
				has_religion_feature = religion_druidic_leadership
			}
		}
		any_demesne_title = {
			limit = {
				controls_religion = yes
			}
			if = {			# Temporal religious head titles are destroyed
				limit = { is_landless_type_title = no }
				destroy_landed_title = THIS
			}
			else = {		# Hierocratic religious head titles are given to a random new character
				hidden_tooltip = {
					liege = {
						save_event_target_as = liege_target
					}
					create_character = {
						age = 38
						dynasty = random
						religion = ROOT
						culture = ROOT
						random_traits = yes
					}
					new_character = {
						save_event_target_as = new_holder
					}
				}
				any_demesne_title = {
					limit = {
						controls_religion = yes
					}
					grant_title = event_target:new_holder
					holder_scope = {
						any_vassal = {
							set_defacto_liege = event_target:liege_target
						}
					}
				}
				hidden_tooltip = {
					set_defacto_liege = event_target:liege_target
				}
			}
		}
	}
	else = {		# Druidic religious head titles trigger succession
		if = {
			limit = { has_landed_title = d_briton_pagan }
			hidden_tooltip = { character_event = { id = 316047 } }
		}
		if = {
			limit = { has_landed_title = d_pict_pagan }
			hidden_tooltip = { character_event = { id = 316147 } }
		}
		if = {
			limit = { has_landed_title = d_gael_pagan }
			hidden_tooltip = { character_event = { id = 316247 } }
		}
	}
}

convert_to_default_cultural_pagan_religion_effect = {
	if = {
		limit = {
			is_brythonic_culture_trigger = yes
			NOT = { has_global_flag = briton_reformation }
		}
		religion = briton_pagan
	}
	if = {
		limit = {
			is_brythonic_culture_trigger = yes
			has_global_flag = briton_reformation
		}
		religion = briton_pagan_reformed
	}
	if = {
		limit = {
			culture = pictish 
			NOT = { has_global_flag = pict_reformation }
		}
		religion = pict_pagan
	}
	if = {
		limit = {
			culture = pictish 
			has_global_flag = pict_reformation
		}
		religion = pict_pagan_reformed
	}
	if = {
		limit = {
			is_gaelic_culture_trigger = yes
			NOT = { has_global_flag = gael_reformation }
		}
		religion = gael_pagan
	}
	if = {
		limit = {
			is_gaelic_culture_trigger = yes
			has_global_flag = gael_reformation
		}
		religion = gael_pagan_reformed
	}
	if = {
		limit = {
			is_ingvaeonic_culture_trigger = yes		
			NOT = { has_global_flag = germanic_reformation } 
		}
		religion = germanic_pagan
	}
	if = {
		limit = { 
			is_ingvaeonic_culture_trigger = yes
			has_global_flag = germanic_reformation 
		}
		religion = germanic_pagan_reformed
	}
	if = {
		limit = {
			is_north_germanic_trigger = yes	
			NOT = { has_global_flag = norse_reformation } 
		}
		religion = norse_pagan
	}
	if = {
		limit = {
			is_north_germanic_trigger = yes
			has_global_flag = norse_reformation 			
		}
		religion = norse_pagan_reformed
	}
	if = {
		limit = {
			is_istvaeonic_culture_trigger = yes		
			NOT = { has_global_flag = frankish_reformation } 
		}
		religion = frankish_pagan
	}
	if = {
		limit = {
			is_istvaeonic_culture_trigger = yes		
			has_global_flag = frankish_reformation 			
		}
		religion = frankish_pagan_reformed
	}
	if = {
		limit = {
			is_irminonic_culture_trigger = yes	
			NOT = { has_global_flag = suebic_reformation } 
		}
		religion = suebic_pagan
	}
	if = {
		limit = {
			is_irminonic_culture_trigger = yes		
			has_global_flag = suebic_reformation 			
		}
		religion = suebic_pagan_reformed
	}
	if = {
		limit = {
			is_east_germanic_trigger = yes	
			NOT = { has_global_flag = gothic_reformation } 
		}
		religion = gothic_pagan
	}
	if = {
		limit = {
			is_east_germanic_trigger = yes		
			has_global_flag = gothic_reformation 			
		}
		religion = gothic_pagan_reformed
	}
	if = {
		limit = {
			is_roman_pagan_culture_trigger = yes		
			NOT = { has_global_flag = roman_reformation }		
		}
		religion = roman_pagan
	}
	if = {
		limit = {
			is_roman_pagan_culture_trigger = yes		
			has_global_flag = roman_reformation			
		}
		religion = roman_pagan_reformed
	}
	# if = {
		# limit = {
			# is_roman_pagan_culture_trigger = yes		
			# has_global_flag = roman_reformation_sol_invictus 			
		# }
		# religion = sol_invictus
	# }
	if = {
		limit = { 
			culture_group = sarmatian
			NOT = { has_global_flag = alan_reformation } 
		}
		religion = alan_pagan
	}
	if = {
		limit = { 
			culture_group = sarmatian
			has_global_flag = alan_reformation 
		}
		religion = alan_pagan_reformed
	}
	if = {
		limit = { 
			culture_group = altaic
			NOT = { has_global_flag = tengri_reformation } 
		}
		religion = tengri_pagan
	}
	if = {
		limit = { 
			culture_group = altaic
			has_global_flag = tengri_reformation 
		}
		religion = tengri_pagan_reformed
	}
	if = {
		limit = { 
			culture_group = basque
			NOT = { has_global_flag = vasconic_reformation } 
		}
		religion = vasconic_pagan
	}
	if = {
		limit = { 
			culture_group = basque
			has_global_flag = vasconic_reformation 
		}
		religion = vasconic_pagan_reformed
	}
	if = {
		limit = { 
			culture_group = israelite
		}
		religion = jewish
	}
}

set_proper_pagan_religions_effect = {
	any_character = {
		limit = { religion = pagan }
		convert_to_default_cultural_pagan_religion_effect = yes
	}
	any_province = {
		limit = { religion = pagan }
		convert_to_default_cultural_pagan_religion_effect = yes
	}
}

flag_theocracy_titles_effect = {
	if = {
		limit = { is_theocracy = yes }
		set_character_flag = is_theocracy
		if = {
			limit = { independent = no }
			liege = { save_event_target_as = archdruid_liege }
		}
		any_demesne_title = {
			set_title_flag = archdruid_title_@PREV
		}
	}
}

# Used in conjunction with the above
restore_theocracy_titles_effect = {
	if = {
		limit = { has_character_flag = is_theocracy }
		clr_character_flag = is_theocracy
		any_title = {
			limit = { has_title_flag = archdruid_title_@PREV }
			clr_title_flag = archdruid_title_@PREV
			grant_title = PREV
		}
		event_target:archdruid_liege = {
			set_defacto_vassal = PREV
		}
	}
}