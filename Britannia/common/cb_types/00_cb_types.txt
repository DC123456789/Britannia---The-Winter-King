### CLAIMS CBs ###
# 0
claim = {
	name = CB_NAME_CLAIM
	war_name = WAR_NAME_CLAIM
	sprite = 1
	truce_days = 1095
	hostile_against_others = yes
	can_ask_to_join_war = no
	# allow_whitepeace = no
	press_claim = yes
	can_call_allies = yes
	can_call_vassals = yes
	reflect_titleholder_change = yes
	
	allowed_to_target_tributaries = no

	infamy_modifier = 0.85
	
	sort_priority = 1000
	
	can_use_gui = {
		ROOT = {
			OR = {
				NOT = { government = tribal_government }
				prestige = 600
			}
		}
	}
	
	can_use = {
		ROOT = { is_from_and_this_top_liege_roman_province_trigger = no }
	}
	
	can_use_title = {
		OR = {
			ROOT = { is_female = no }
			AND = { 
				NOT = { ROOT = { religion_group = muslim } }
				NOT = { ROOT = { has_religion_feature = religion_patriarchal } } 
			}
		}
		OR = {
			ROOT = { is_female = yes }
			NOT = { ROOT = { has_religion_feature = religion_matriarchal } } 
		}
		
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		
		ROOT = {
			OR = {
				is_ruler = no
				primary_title = {
					OR = {
						is_primary_type_title = no # Static Mercs, the Pope, Holy Orders, etc
						higher_tier_than = PREVPREV
						tier = PREVPREV
					}
				}
			}
		}
		
		OR = { 
			ROOT = { has_strong_claim = PREV }
			ROOT = { has_character_flag = claimant_adventurer }
			AND = {
				ROOT = { has_weak_claim = PREV }
				OR = {
					is_pretender = yes # Checks vs ROOT character
					holder_scope = { has_regent = yes }
					AND = {
						ROOT = { 
							OR = { 
								is_female = no 
								has_law = status_of_women_4
								has_religion_feature = religion_matriarchal
								has_religion_feature = religion_equal
								has_religion_feature = religion_feature_pict
								#has_religion_feature = religion_feature_bon
							} 
						}
						holder_scope = { 
							AND = { 
								is_female = yes 
								NOR = { 
									has_religion_feature = religion_matriarchal
									has_religion_feature = religion_equal
									has_religion_feature = religion_feature_pict
									#has_religion_feature = religion_feature_bon
									has_law = status_of_women_4 
									has_game_rule = { name = gender value = all } 
								} 
							} 
						}
					}
					is_contested = yes # Is already being contested in some form of Claim or Succession War
				}
			}
		}
		
		OR = {
			NOT = { title = e_britannia }
			has_global_flag = britannia_formalized_heir
		}
		OR = {
			NOT = { title = e_aengland }
			has_global_flag = aengland_united
		}
		
		NOT = { is_landless_normal_title_trigger = yes }
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		ROOT = { has_claim = PREV }
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		ROOT = {
			if = {
				limit = { government = tribal_government }
				prestige = -200
			}
		}
	}
	
	on_success_title = {	
		hidden_tooltip = {
			ROOT = {
				# Set proper adventurer government
				if = {
					limit = { 
						has_character_flag = claimant_adventurer 
						is_landed = no
					}
					FROM = { save_event_target_as = target_to_switch_government_to }
					flag_target_government_effect = yes
				}
				clr_character_flag = claimant_adventurer
				if = {
					limit = {
						has_nickname = no
						lower_tier_than = PREV
					}
					random = {
						chance = 25
						give_nickname = nick_the_usurper
					}
				}
			}
		}
	
		# Flag marches
		holder_scope = { save_event_target_as = target_char }
		flag_target_marches_effect = yes
		
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
		
		ROOT = { set_flagged_government_effect = yes }
		
		# Transfer marches
		ROOT = { save_event_target_as = new_holder }
		event_target:target_char = { save_event_target_as = old_holder }
		transfer_marches_to_new_holder_claim_effect = yes
		
		# Transfer foederati
		if = {
			limit = { higher_tier_than = COUNT }
			hidden_tooltip = {
				ROOT = { character_event = { id = foederati.21 } }
			}
		}
		
		if = {
			limit = {
				higher_tier_than = BARON
				NOT = { culture = ROOT }
			}
			hidden_tooltip = { conquest_culture = ROOT }
		}
		
		any_attacker = {
			limit = {
				character = ROOT
				NOT = { religion_group = christian }
			}
			piety = 50
		}
		
		ROOT = {
			show_scope_change = no
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		FROM = {
			show_scope_change = no
			prestige = -100
		}
		
		ROOT = {
			if = {
				limit = { has_landed_title = c_angeln_host }
				hidden_tooltip = { character_event = { id = 301406 } }
			}
		}
	}

	on_fail_title = {
		ROOT = {
			show_scope_change = no
			prestige = -100
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		ROOT = {
			clr_character_flag = claimant_adventurer
			#if = {
			#	limit = { 
			#		has_landed_title = c_angeln_host 
			#		NOT = { c_angeln_host = { has_title_flag = failed_first_invasion } }
			#	}
			#	hidden_tooltip = { character_event = { id = 301408 } }
			#}
			if = {
				limit = { 
					has_landed_title = c_angeln_host 
					#c_angeln_host = { has_title_flag = failed_first_invasion }
				}
				hidden_tooltip = { character_event = { id = 301409 } }
			}
		}
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			prestige = -150
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 150
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 150 }
		}
		ROOT = {
			#if = {
			#	limit = { 
			#		has_landed_title = c_angeln_host 
			#		NOT = { c_angeln_host = { has_title_flag = failed_first_invasion } }
			#	}
			#	hidden_tooltip = { character_event = { id = 301408 } }
			#}
			if = {
				limit = { 
					has_landed_title = c_angeln_host 
					#c_angeln_host = { has_title_flag = failed_first_invasion }
				}
				hidden_tooltip = { character_event = { id = 301409 } }
			}
		}
	}

	on_reverse_demand_title = {
		#any_claim = { #Does not work.
			#remove_claim = ROOT
		#}
		ROOT = { show_scope_change = no remove_claim = PREV }
		ROOT = {
			hidden_tooltip = {
		#		disband_event_forces = yes
				clr_character_flag = claimant_adventurer
			}
		}
	}
	
	on_attacker_leader_death = {
		if = {
			limit = { ROOT = { has_character_flag = claimant_adventurer } }
			end_war = invalid
		}
	}
		
	on_invalidation = {
		ROOT = {
			if = {
				limit = {
					has_landed_title = d_north_angles
					is_landed = no
					NOT = { year = 575 }
				}
				character_event = { id = 313007 }
			}
			if = {
				limit = {
					has_landed_title = d_west_saxons
					is_landed = no
					NOT = { year = 575 }
				}
				character_event = { id = 313022 }
			}
			if = {
				limit = {
					has_landed_title = d_angles
					is_landed = no
					NOT = { year = 505 }
				}
				character_event = { id = 313301 }
			}
			if = {
				limit = {
					has_landed_title = d_iclingas
					is_landed = no
					NOT = { year = 625 }
				}
				character_event = { id = 313051 }
			}
			if = {
				limit = {
					has_landed_title = d_hwiccas
					is_landed = no
					NOT = { year = 625 }
				}
				character_event = { id = 313061 }
			}
			if = {
				limit = { has_landed_title = c_angeln_host }
				hidden_tooltip = { character_event = { id = 301407 } }
			}
			if = {
				limit = { 
					has_landed_title = d_saxon_hamaland
					is_landed = no
				}
				hidden_tooltip = { character_event = { id = 301601 } }
			}
		}			
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		modifier = {		# Get Lugaid ap Loegaire to finish off the Ui Neill conquests in Mide
			factor = 10
			FROM = {
				OR = {
					has_landed_title = k_leinster
					has_landed_title = d_northmide
				}
			}
			ROOT = {
				has_character_flag = lugaid_of_mide
			}
		}
	}
}
# 1
other_claim = {
	name = CB_NAME_CLAIM
	war_name = WAR_NAME_OTHER_CLAIM
	sprite = 2
	truce_days = 1095
	hostile_against_others = yes
	can_ask_to_join_war = no

	press_claim = yes
	
	allowed_to_target_tributaries = no

	infamy_modifier = 0.5
	
	sort_priority = 900
	
	can_use_gui = {
		ROOT = {
			OR = {
				NOT = { government = tribal_government }
				prestige = 700
			}
		}
	}
	
	can_use = {
		ROOT = { is_from_and_this_top_liege_roman_province_trigger = no }
	}

	can_use_title = {
		OR = {
			ROOT = { is_female = no }
			AND = {
				NOT = { ROOT = { religion_group = muslim } }
				NOT = { ROOT = { has_religion_feature = religion_patriarchal } }
				NOT = { succ_law_title = { has_law = agnatic_succession } }
			}
		}
		OR = {
			ROOT = { is_female = yes }
			AND = {
				NOT = { ROOT = { has_religion_feature = religion_matriarchal } }
				NOT = { succ_law_title = { has_law = enatic_succession } }
			}
		}
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		ROOT = {
			OR = {
				is_ruler = no
				primary_title = {
					OR = {
						is_primary_type_title = no # Static Mercs, the Pope, Holy Orders, etc
						higher_tier_than = PREVPREV
						tier = PREVPREV
					}
				}
			}
		}

		NOT = {
			any_war = { # when used in title scope, checks all wars for that title
				attacker = {
					character = ROOT
				}
			}
		}
		
		OR = { 
			ROOT = { has_strong_claim = PREV }
			AND = {
				ROOT = { has_weak_claim = PREV }
				OR = {
					is_pretender = yes # Checks vs ROOT character
					holder_scope = { has_regent = yes }
					AND = {
						ROOT = { OR = { is_female = no  has_law = status_of_women_4 } }
						holder_scope ={ AND = { is_female = yes NOR = { has_law = status_of_women_4 has_game_rule = { name = gender value = all } } } }
					}
					is_contested = yes # Is already being contested in some form of Claim or Succession War
				}
			}
		}
		
		OR = {
			multiplayer = no
			FROMFROM = { ai = yes }
			has_game_rule = {
				name = multiplayer_third_party_claims
				value = on
			}
			AND = {
				has_game_rule = {
					name = multiplayer_third_party_claims
					value = limited
				}
				lower_tier_than = KING
			}
		}
		
		OR = {
			NOT = { title = e_britannia }
			has_global_flag = britannia_formalized_heir
		}
		OR = {
			NOT = { title = e_aengland }
			has_global_flag = aengland_united
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		ROOT = { has_claim = PREV }
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		ROOT = {
			if = {
				limit = { government = tribal_government }
				prestige = -200
			}
		}
	}
	
	on_success = {
		hidden_tooltip = {
			ROOT = {
				opinion = {
					modifier = pressed_my_claim 
					who = PREV
				}
			}
		}
		ROOT = {
			show_scope_change = no
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		FROM = {
			show_scope_change = no
			prestige = -100
		}
	}

	on_success_title = {
		if = {
			limit = {
				controls_religion = yes
				holder_scope = { religion = catholic }
			}
			holder_scope = {
				abdicate_to = ROOT
			}
		}
		
		# Flag marches
		holder_scope = { save_event_target_as = target_char }
		flag_target_marches_effect = yes
		
		if = {
			limit = {
				OR = {
					controls_religion = no
					NOT = { holder_scope = { religion = catholic } }
				}
			}
			
			if = {
				limit = {
					holder_scope = {
						same_realm = FROMFROM # The current holder and the one pressing my claim are in the same larger realm
					}
				}
				ROOT = {
					set_character_flag = other_claim_tmp_flag
				}
			}
			
			if = {
				limit = {
					ROOT = {
						is_ruler = yes
						is_liege_or_above = FROMFROM # The claimant is a vassal ruler of the presser
					}
				}
				ROOT = {
					set_character_flag = claimant_is_vassal_ruler_flag
					if = {
						limit = { tier = KING }
						set_character_flag = claimant_is_king_vassal_ruler_flag
					}
				}
			}

			# Flag characters that should be tribal
			if = {
				limit = { 
					ROOT = { is_ruler = no }
					FROM = { is_tribal = yes }
				}
				ROOT = { set_character_flag = convert_to_tribal }
			}
			
			usurp_title_plus_barony_if_unlanded = ROOT
			
			# Make sure that tribals stay tribal
			if = {
				limit = { 
					ROOT = { has_character_flag = convert_to_tribal }
				}
				ROOT = { 
					clr_character_flag = convert_to_tribal 
					if = {
						limit = { 
							capital_holding = {
								holding_type = TRIBAL
							}
						}
						if = {
							limit = {
								OR = {
									FROM = { government = high_tribal_government }
									FROMFROM = { government = high_tribal_government }
								}
							}
							set_government_type = high_tribal_government
						}
						else = {
							set_government_type = tribal_government
						}						
					}
				}
			}
			
			hidden_tooltip = {
				ROOT = { 
					any_child = { 
						limit = { 
							is_ruler = no 
							is_married = no 
							prisoner = no 
							is_adult = no
							is_within_diplo_range = ROOT 
						} 
						move_character = ROOT 
					}
					any_spouse =  { 
						limit = { 
							is_ruler = no 
							prisoner = no 
							is_within_diplo_range = ROOT 
						} 
						move_character = ROOT 
					}
					any_consort =  { 
						limit = { 
							is_ruler = no 
							prisoner = no 
							is_within_diplo_range = ROOT 
						} 
						move_character = ROOT 
					}
				}
			
				# If we were erroneously vassalized, break free
				if = {
					limit = {
						NOT = { ROOT = { has_character_flag = claimant_is_vassal_ruler_flag } }
						holder_scope = {
							is_liege_or_above = FROMFROM
						}
						OR = {
							AND = {
								NOT = { 
									FROMFROM = {
										any_demesne_title = {
											de_jure_vassal_or_below = PREVPREV
											OR = {
												NOT = { title = e_britannia }
												has_global_flag = britannia_empowered_high_council
											}
											OR = {
												NOT = { title = e_aengland }
												has_global_flag = aengland_united
											}
										}
									}
								}
								ROOT = {
									NOT = { dynasty = FROMFROM }
								}
							}
							AND = {
								NOT = { ROOT = { has_character_flag = claimant_is_king_vassal_ruler_flag } }
								FROMFROM = {
									NOT = {
										any_demesne_title = {
											tier = EMPEROR
											OR = { 
												NOT = { title = e_britannia }
												has_global_flag = britannia_empowered_high_council
											}
											OR = {
												NOT = { title = e_aengland }
												has_global_flag = aengland_united
											}
										}
									}
								}
							}
						}
					}
					ROOT = { set_defacto_liege = ROOT }
				}
			
				# try and vassalize, but only conditionally
				if = {
					limit = {
						holder_scope = {
							NOR = {
								is_liege_or_above = FROMFROM
								character = FROMFROM
							}
						}
						OR = {
							holder_scope = {
								FROMFROM = {
									any_demesne_title = {
										de_jure_vassal_or_below = PREVPREV
										OR = {
											NOT = { title = e_britannia }
											has_global_flag = britannia_empowered_high_council
										}
										OR = {
											NOT = { title = e_aengland }
											has_global_flag = aengland_united
										}
									}
								}
							}
							ROOT = { has_character_flag = claimant_is_vassal_ruler_flag }
							ROOT = { dynasty = FROMFROM }
						}
						NAND = {
							ROOT = { tier = KING }
							FROMFROM = {
								NOT = {
									any_demesne_title = {
										tier = EMPEROR
										OR = { 
											NOT = { title = e_britannia }
											has_global_flag = britannia_empowered_high_council
										}
										OR = {
											NOT = { title = e_aengland }
											has_global_flag = aengland_united
										}
									}
								}
							}
						}
					}
					ROOT = {
						set_defacto_liege = FROMFROM
					}
				}

				# check if the previous effect managed to make us part of the same realm
				# if not, we'll break the other realm
				if = {
					limit = {
						NOT = { ROOT = { has_character_flag = other_claim_tmp_flag } }
						FROM = {
							FROM = {
								top_liege = {
									ROOT = {
										top_liege = {
											NOT = {
												character = PREVPREV
											}
										}
									}
								}
							}
						}
					}
					ROOT = {
						set_defacto_liege = ROOT
					}
				}
				
				# If we have become independent from our mutual liege, restore that vassal tie
				if = {
					limit = {
						ROOT = { 
							has_character_flag = other_claim_tmp_flag 
							de_facto_liege = ROOT
						}
					}
					FROM = {
						FROM = {
							top_liege = {
								ROOT = { 
									set_defacto_liege = PREV
								}
							}
						}
					}
				}
				
				# If FROMFROM is the high king and ROOT is independent, make ROOT a Subject Kingdom if applicable
				if = {
					limit = {
						ROOT = {
							independent = yes
							is_potential_britannia_subject_trigger = yes
						}		
						FROMFROM = {
							has_landed_title = e_britannia 
							NOT = { has_global_flag = britannia_empowered_high_council }
						}			
					}
					FROMFROM = { save_event_target_as = britannia_high_king }
					ROOT = { make_britannia_subject_of_event_target_effect = yes }
				}
				
				ROOT = { 
					clr_character_flag = other_claim_tmp_flag 
					clr_character_flag = claimant_is_vassal_ruler_flag 
					clr_character_flag = claimant_is_king_vassal_ruler_flag
				}
			}
		}
		
		# Transfer marches
		ROOT = { save_event_target_as = new_holder }
		event_target:target_char = { save_event_target_as = old_holder }
		transfer_marches_to_new_holder_claim_effect = yes
		
		# Transfer foederati
		if = {
			limit = { higher_tier_than = COUNT }
			hidden_tooltip = {
				ROOT = { character_event = { id = foederati.21 } }
			}
		}
		
		if = {
			limit = {
				higher_tier_than = BARON
				NOT = { culture = ROOT }
			}
			hidden_tooltip = { conquest_culture = ROOT }
		}
	}

	on_fail_title = {
		ROOT = {
			show_scope_change = no
			prestige = -100
		}
		FROM = {
			show_scope_change = no
			FROM = {
				show_scope_change = no
				prestige = -100
			}
		}
		
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_reverse_demand = {
		prestige = -150
		transfer_scaled_wealth = {
			to = FROM
			value = 4.0
		}
		ROOT = {
			show_scope_change = no
			prestige = -150
			imprison = FROM
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 150
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 150 }
		}
	}

	on_reverse_demand_title = {
		ROOT = { show_scope_change = no remove_claim = PREV }
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		modifier = {		# Get Lugaid ap Loegaire to finish off the Ui Neill conquests in Mide
			factor = 10
			FROM = {
				OR = {
					has_landed_title = k_leinster
					has_landed_title = d_northmide
				}
			}
			ROOT = {
				has_character_flag = lugaid_of_mide
			}
		}
	}
}
# 2
claim_on_liege = {
	name = CB_NAME_CLAIM
	war_name = WAR_NAME_CLAIM_LIEGE
	sprite = 3
	truce_days = 1825
	hostile_against_others = yes
	major_revolt = yes

	allowed_to_target_tributaries = no

	press_claim = yes
	can_call_vassals = yes

	infamy_modifier = 0.85
	
	sort_priority = 910
	
	can_use = {
		FROM = {
			in_revolt = no
			liege = {
				in_revolt = no
				liege = {
					in_revolt = no
				}
			}
		}
	}

	can_use_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		OR = { 
			ROOT = { has_strong_claim = PREV }
			ROOT = { has_character_flag = faction_claimant_ultimatum_taken } # Faction war. Ignore claim strength.
			AND = {
				ROOT = { has_weak_claim = PREV }
				OR = {
					is_pretender = yes # Checks vs ROOT character
					holder_scope = { has_regent = yes }
					AND = {
						ROOT = { OR = { is_female = no has_law = status_of_women_4 } }
						holder_scope ={ AND = { is_female = yes NOR = { has_law = status_of_women_4 has_game_rule = { name = gender value = all } } } }
					}
					is_contested = yes # Is already being contested in some form of Claim or Succession War
				}
			}
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		OR = {
			ROOT = { has_claim = PREV }
			ROOT = { has_character_flag = faction_claimant_ultimatum_taken }
			ROOT = { has_character_flag = faction_claimant_war_allowed }
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		flag_faction_revolt_title_effect = yes
	}
	
	on_success = {
		ROOT = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		
		ROOT = { clr_character_flag = faction_claimant_war_allowed }
		
		FROM = {
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
	#					is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_2
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_3
					}
				}
			}
		}
		if = {
			limit = {
				ROOT = {
					prisoner = yes
					host = { character = FROM  }
				}
			}
			ROOT = { prisoner = no }
		}
		destroy_faction_revolt_title_effect = yes
	}
	
	on_success_title = {
		if = {
			limit = {
				is_primary_holder_title = yes
			}
			FROM = { imprison = ROOT }
		}
		
		if = {
			limit = { 
				FROM = {
					primary_title = {
						title = PREVPREV
					}
				}
			}
			
			if = {
				limit = {
					FROM = { 
						any_vassal = { 
							government = legion_government
							in_revolt = no
						}
					}
				}
				FROM = { 
					any_vassal = { 
						limit = {
							government = legion_government
						}
						set_character_flag = legion_to_transfer_@ROOT
					}
					set_character_flag = transfer_legions_@ROOT 
				}
			}
			
			# If all the legions revolted to ROOT
			if = {
				limit = {
					ROOT = { 
						any_vassal = { 
							government = legion_government
						}
					}
				}
				FROM = {
					set_character_flag = transfer_legions_@ROOT 
				}
			}
		}
		
		# Flag marches
		holder_scope = { save_event_target_as = target_char }
		flag_target_marches_effect = yes		
		
		usurp_title_plus_barony_if_unlanded_and_vassals = ROOT
		
		# Transfer marches
		ROOT = { save_event_target_as = new_holder }
		event_target:target_char = { save_event_target_as = old_holder }
		transfer_marches_to_new_holder_claim_effect = yes
		
		# Transfer foederati
		if = {
			limit = { higher_tier_than = COUNT }
			hidden_tooltip = {
				ROOT = { character_event = { id = foederati.21 } }
			}
		}
		
		# Transfer Legions
		if = {
			limit = {
				FROM = { has_character_flag = transfer_legions_@ROOT }
			}
			ROOT = { character_event = { id = 315925 } }
		}
		
		if = {
			limit = {
				higher_tier_than = BARON
				NOT = { culture = ROOT }
			}
			hidden_tooltip = { conquest_culture = ROOT }
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
			clr_character_flag = faction_claimant_war_allowed
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				disband_event_forces = faction_revolters
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		destroy_faction_revolt_title_effect = yes
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -150
			clr_character_flag = faction_claimant_war_allowed
		}
		
		FROM = {
			participation_scaled_prestige = 100
			hidden_tooltip = { 
				if = { 
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				disband_event_forces = faction_revolters
				prisoner = FROM
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		destroy_faction_revolt_title_effect = yes
	}
	
	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}
		end_war = invalid
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
}
# 3
claim_on_liege_plot = {
	name = CB_NAME_CLAIM
	war_name = WAR_NAME_CLAIM_LIEGE
	sprite = 3
	truce_days = 1825
	hostile_against_others = yes

	press_claim = yes
	can_call_allies = no
	can_ask_to_join_war = no
	
	allowed_to_target_tributaries = no

	infamy_modifier = 0.85
	
	can_use = {
	}

	can_use_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success = {
		ROOT = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		
		FROM = {
			hidden_tooltip = { disband_event_forces = faction_loyalists }
		
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
	#					is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_2
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_3
					}
				}
			}
		}
	}
	
	on_success_title = {
		if = {
			limit = { 
				FROM = {
					primary_title = {
						title = PREVPREV
					}
				}
			}
			
			if = {
				limit = {
					FROM = { 
						any_vassal = { 
							government = legion_government
							in_revolt = no
						}
					}
				}
				FROM = { 
					any_vassal = { 
						limit = {
							government = legion_government
						}
						set_character_flag = legion_to_transfer_@ROOT
					}
					set_character_flag = transfer_legions_@ROOT 
				}
			}
			
			# If all the legions revolted to ROOT
			if = {
				limit = {
					ROOT = { 
						any_vassal = { 
							government = legion_government
						}
					}
				}
				FROM = {
					set_character_flag = transfer_legions_@ROOT 
				}
			}
		}
		
		usurp_title_plus_barony_if_unlanded_and_vassals = ROOT
		
		# Transfer Legions
		if = {
			limit = {
				FROM = { has_character_flag = transfer_legions_@ROOT }
			}
			ROOT = { character_event = { id = 315925 } }
		}
		
		if = {
			limit = {
				higher_tier_than = BARON
				NOT = { culture = ROOT }
			}
			hidden_tooltip = { conquest_culture = ROOT }
		}
		ROOT = {
			plot_succeeds = yes
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 50
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			imprison = FROM
		}
		FROM = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
			hidden_tooltip = { 
				if = { 
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}
	
	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}
		end_war = invalid
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
}

# 4
claim_on_vassal_plot = {
	name = CB_NAME_CLAIM_VASSAL
	war_name = WAR_NAME_CLAIM_VASSAL
	sprite = 3
	truce_days = 1825
	hostile_against_others = yes
	reflect_titleholder_change = no

	press_claim = yes
	attacker_can_call_allies = no
	can_attack_vassals = yes

	allowed_to_target_tributaries = no

	infamy_modifier = 0.85

	can_use_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				de_facto_liege = ROOT
			}
		}
	}

	is_valid_title = {
		FROM = {
			has_landed_title = PREV
		}
		ROOT = {
			has_plot = plot_gain_vassal_title
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success = {
		ROOT = {
			prestige = 50
		}
	}
	
	on_success_title = {
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
		ROOT = { plot_succeeds = yes }
	}

	on_fail = {
		ROOT = {
			prestige = -100
			cancel_plot = plot_gain_vassal_title
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_invalidation = {
		ROOT = {
			cancel_plot = plot_gain_vassal_title
		}
		
	}
	
	on_reverse_demand = {
		ROOT = {
			prestige = -200
			cancel_plot = plot_gain_vassal_title
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}
	
	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}
		
		end_war = invalid
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}
	
	on_defender_leader_death = {
		ROOT = {
			cancel_plot = plot_gain_vassal_title
		}
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
}

# 5
other_claim_on_liege = {
	name = CB_NAME_CLAIM
	war_name = WAR_NAME_OTHER_CLAIM
	sprite = 4
	truce_days = 1825
	hostile_against_others = yes
	major_revolt = yes

	press_claim = yes
	can_call_vassals = yes
	
	allowed_to_target_tributaries = no

	infamy_modifier = 0.5
	
	sort_priority = 850
	
	can_use = {
		FROM = {
			in_revolt = no
			liege = {
				in_revolt = no
				liege = {
					in_revolt = no
				}
			}
		}
	}

	can_use_title = {
		OR = {
			ROOT = { is_female = no }
			NOT = { has_law = agnatic_succession }
			AND = {
				lower_tier_than = KING
				is_primary_holder_title = no
			}
			FROMFROM = { has_character_flag = faction_claimant_ultimatum_taken } # Faction war. Ignore claim strength.
		}
		
		FROM = {
			has_landed_title = PREV
		}
		
		OR = { 
			ROOT = { has_strong_claim = PREV }
			FROMFROM = { has_character_flag = faction_claimant_ultimatum_taken } # Faction war. Ignore claim strength.
			AND = {
				ROOT = { has_weak_claim = PREV }
				OR = {
					is_pretender = yes # Checks vs ROOT character
					holder_scope = { has_regent = yes }
					AND = {
						ROOT = { OR = { is_female = no has_law = status_of_women_4 } }
						holder_scope ={ AND = { is_female = yes NOR = { has_law = status_of_women_4 has_game_rule = { name = gender value = all } } } }
					}
					is_contested = yes # Is already being contested in some form of Claim or Succession War
				}
			}
		}
	}
			
	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		flag_faction_revolt_title_effect = yes
	}
	
	on_invalidation = {
		if = {
			limit = { 
				OR = {
					is_liege_or_above = FROM 
					liege_before_war = {
						character = FROM
					}
				}
			}
			hidden_tooltip = {
				FROM = { set_character_flag = prewar_liege_@PREV }
				character_event = { id = 315913 }
			}
		}
		else = {
			FROM = {
				character_event = { id = 315923 } 
			}
		}
		destroy_faction_revolt_title_effect = yes
	}

	on_success = {
		ROOT = {
			participation_scaled_prestige = 100
			hidden_tooltip = { disband_event_forces = faction_revolters }
		}
		participation_scaled_prestige = 100
		hidden_tooltip = { disband_event_forces = faction_revolters }
		any_attacker = {
			limit = { 
				NOT = { character = ROOT } 
				NOT = { character = PREV }
			}
			hidden_tooltip = { 
				participation_scaled_prestige = 100 
				disband_event_forces = faction_revolters
			}
		}
		ROOT = {
			opinion = {
				modifier = pressed_my_claim 
				who = PREV
			}
		}

		FROM = {
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
	#					is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_2
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_3
					}
				}
			}
		}
		
		if = {
			limit = {
				ROOT = {
					prisoner = yes
					host = { character = FROM  }
				}
			}
			ROOT = { prisoner = no }
		}
		destroy_faction_revolt_title_effect = yes
	}
	
	on_success_title = {
		if = {
			limit = {
				is_primary_holder_title = yes
			}
			hidden_tooltip = {
				FROM = { set_character_flag = temp_other_claim_on_liege_prison }
			}
		}
		
		# If the claimant has the wrong government type, take care of that first.
		if = {
			limit = {
				higher_tier_than = ROOT
				holder_scope = {
					OR = {
						is_feudal = yes
						is_tribal = yes
					}
				}
				ROOT = {
					is_ruler = yes
					OR = {
						is_theocracy = yes
						is_republic = yes
					}
				}
			}
			ROOT = {
				abdicate = {
					move = no
				}
			}
		}
		
		# Revassalize any legions back to FROM
		any_title = {
			limit = { has_title_flag = revolting_legion_@PREV }
			set_defacto_liege = FROM
			clr_title_flag = revolting_legion_@PREV
			holder_scope = {
				if = {
					limit = { government = legion_government }
					set_character_flag = legion_to_transfer_@ROOT
				}
			}
			FROM = { set_character_flag = transfer_legions_@ROOT }
		}
		
		if = {
			limit = { 
				FROM = {
					primary_title = {
						title = PREVPREV
					}
				}
			}
			
			if = {
				limit = {
					FROM = { 
						any_vassal = { 
							government = legion_government
							in_revolt = no
						}
					}
				}
				FROM = {
					any_vassal = { 
						limit = {
							government = legion_government
						}
						set_character_flag = legion_to_transfer_@ROOT
					}
					set_character_flag = transfer_legions_@ROOT 
				}
			}
		}
		
		# Flag is checked and handled in posttitle
		ROOT = {
			if = {
				limit = {
					is_landed = no
				}
				set_character_flag = set_proper_unlanded_liege
				FROM = { save_event_target_as = target_to_switch_government_to }
				flag_target_government_effect = yes
				if = {
					limit = { FROM = { independent = yes } }
					save_global_event_target_as = new_ROOT_liege
				}
				else = {
					FROM = {
						liege = {
							save_global_event_target_as = new_ROOT_liege
						}
					}
				}
			}
		}
		
		usurp_title_plus_barony_if_unlanded_and_vassals_no_adj = { target = ROOT type = claim }
		
		if = {
			limit = {
				higher_tier_than = BARON
				NOT = { culture = ROOT }
			}
			hidden_tooltip = { conquest_culture = ROOT }
		}
	}

	on_success_posttitle = {
		set_character_flag = rebel_leader_@ROOT
		ROOT = { set_character_flag = check_rebel_leader_for_legions }
		
		# Transfer Legions
		if = {
			limit = {
				FROM = { has_character_flag = transfer_legions_@ROOT }
			}
			ROOT = { character_event = { id = 315925 } }
		}
		
		hidden_tooltip = {
			if = {
				limit = {
					top_liege = {
						ROOT = {
							NOT = {
								top_liege = {
									character = PREVPREV
								}
							}
						}
					}
				}

				ROOT = {
					set_defacto_liege = PREV
				}
			}

			if = {
				limit = {
					top_liege = {
						ROOT = {
							NOT = {
								top_liege = {
									character = PREVPREV
								}
							}
						}
					}
				}

				ROOT = {
					set_defacto_liege = ROOT
				}
			}
			
			if = {
				limit = {
					FROM = { has_character_flag = temp_other_claim_on_liege_prison }
				}
				FROM = { 
					imprison = ROOT
					clr_character_flag = temp_other_claim_on_liege_prison
				}
			}
		
			# If the claimant was formerly unlanded, make sure they get the right government and don't keep their host as liege
			ROOT = {
				if = {
					limit = {
						has_character_flag = set_proper_unlanded_liege
					}
					clr_character_flag = set_proper_unlanded_liege
					set_flagged_government_effect = yes
					if = {
						limit = {
							NOT = { lower_tier_than = FROM }
						}
						set_defacto_liege = event_target:new_ROOT_liege
					}
					else_if = {
						limit = { NOT = { any_liege = { character = FROM } } }
						set_defacto_liege = FROM
					}
					clear_global_event_target = event_target:new_ROOT_liege
				}
			}
		}
	}

	on_fail = {
		if = {
			limit = { is_liege_or_above = FROM }
			hidden_tooltip = {
				character_event = { id = 315911 } 
			}
		}
		
		prestige = -100
		
		imprison = FROM
		if = {
			limit = {
				OR = {
					is_liege_of = ROOT
					ROOT = { is_liege_or_above = FROM }
				}
			}
			ROOT = {
				imprison = FROM
			}
		}
		
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		destroy_faction_revolt_title_effect = yes
	}

	on_reverse_demand = {
		prestige = -200
		if = {
			limit = { is_liege_or_above = FROM }
			hidden_tooltip = { 
				set_character_flag = faction_defeated
				character_event = { id = 315911 } 
			}
		}
		
		imprison = FROM
		if = {
			limit = {
				OR = {
					is_liege_of = ROOT
					ROOT = { is_liege_or_above = FROM }
				}
			}
			ROOT = {
				imprison = FROM
			}
		}
		
		FROM = {
			participation_scaled_prestige = 100
			hidden_tooltip = { 
				if = { 
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				disband_event_forces = faction_revolters
				prisoner = FROM
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		destroy_faction_revolt_title_effect = yes
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
}

# 6
claim_all = {
	name = CB_NAME_CLAIM_ALL
	war_name = WAR_NAME_CLAIM_ALL
	sprite = 5
	truce_days = 1825
	is_permanent = yes
	can_ask_to_join_war = no
	is_claim_all = yes
	
	allowed_to_target_tributaries = no
	
	sort_priority = 1100
	
	can_use_gui = {
		ROOT = {
			OR = {
				NOT = { government = tribal_government }
				prestige = 1000
			}
		}
	}

	can_use = {
		ROOT = {
			total_claims = {
				who = FROM
				strong = yes # Count only strong claims
				value = 2
			}
			prisoner = no
		}
	}

	is_valid = {
		ROOT = {
			total_claims = {
				who = FROM
				strong = yes # Count only strong claims
				value = 1 # must have at least one claim left
			}
		}
	}

	on_add = {
		ROOT = {
			show_scope_change = no
			any_claim = {
				show_scope_change = no
				limit = {
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
					ROOT = { has_strong_claim = PREV }
				}
				press_claim = ROOT
			}
		}
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		ROOT = {
			if = {
				limit = { government = tribal_government }
				prestige = -300
			}
			any_claim = {
				limit = {
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
					ROOT = { has_strong_claim = PREV }
				}
				press_claim = ROOT
			}
		}
	}

	on_success = {
		ROOT = {
			show_scope_change = no
			any_claim = {
				show_scope_change = no
				limit = {
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
					ROOT = { has_strong_claim = PREV }
				}
				if = {
					limit = { 
						FROM = {
							primary_title = {
								title = PREVPREV
							}
						}
						NOT = { FROM = { has_character_flag = usurped_primary_title } }
					}
					FROM = { set_character_flag = usurped_primary_title }
				}
				usurp_title_plus_barony_if_unlanded = ROOT
				if = {
					limit = {
						higher_tier_than = BARON
						NOT = { culture = ROOT }
					}
					hidden_tooltip = { conquest_culture = ROOT }
				}
			}
		}
		
		# Transfer Legions
		if = {
			limit = { FROM = { has_character_flag = usurped_primary_title } }
			FROM = { clr_character_flag = usurped_primary_title }
			if = {
				limit = {
					FROM = { 
						any_vassal = { 
							government = legion_government
							in_revolt = no
						}
					}
				}
				FROM = { 
					any_vassal = { 
						limit = {
							government = legion_government
						}
						set_character_flag = legion_to_transfer_@ROOT
					}
					set_character_flag = transfer_legions_@ROOT 
				}
			}
			
			if = {
				limit = {
					FROM = { has_character_flag = transfer_legions_@ROOT }
				}
				ROOT = { character_event = { id = 315925 } }
			}
		}
		
		ROOT = {
			show_scope_change = no
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = {
				character = ROOT
				NOT = { religion_group = christian }
			}
			piety = 50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_fail = {
		ROOT = {
			show_scope_change = no
			prestige = -150
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 75
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 75 }
		}
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			any_claim = {
				limit = {
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
					ROOT = { has_strong_claim = PREV }
				}
				ROOT = { show_scope_change = no remove_claim = PREV }
			}
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		modifier = {		# Get Lugaid ap Loegaire to finish off the Ui Neill conquests in Mide
			factor = 20
			FROM = {
				OR = {
					has_landed_title = k_leinster
					has_landed_title = d_northmide
				}
			}
			ROOT = {
				has_character_flag = lugaid_of_mide
			}
		}
	}
}

### DEMAND LAW CHANGE CBs ###
change_seniority_succession_law = {
	name = CB_NAME_SENIORITY_SUCCESSION_LAW
	war_name = WAR_NAME_SENIORITY_SUCCESSION_LAW
	sprite = 6
	truce_days = 3650
	can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes
	
	can_use = {
		ROOT = {
			vassal_of = FROM	
		}
	}

	is_valid_title = {
		NOT = {
			has_law = succ_seniority
		}
		OR = {
			tier = emperor
			tier = king
			is_primary_holder_title = yes
		}
	}	

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		flag_faction_revolt_title_effect = yes
	}
	
	on_invalidation = {
		FROM = { set_character_flag = prewar_liege_@ROOT }
		ROOT = { character_event = { id = 315913 } }
		destroy_faction_revolt_title_effect = yes
	}
	
	on_success = {
		ROOT = {
			hidden_tooltip = { 
				character_event = { id = 315911 } 
			}
		}
		FROM = {
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
	#					is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_2
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_3
					}
				}
			}
		}
		ROOT = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100 
				disband_event_forces = faction_revolters
			}
		}
		destroy_faction_revolt_title_effect = yes
	}

	on_success_title = {
		succession_w_cooldown = seniority
	}

	on_fail = {
		ROOT = {
			show_scope_change = no
			hidden_tooltip = { 
				character_event = { id = 315911 } 
			}
			prestige = -100
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_seniority_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		destroy_faction_revolt_title_effect = yes
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			hidden_tooltip = { 
				set_character_flag = faction_defeated
				character_event = { id = 315911 } 
			}
			prestige = -200
			prisoner = FROM
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 100
			hidden_tooltip = { 
				if = { 
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_seniority_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		destroy_faction_revolt_title_effect = yes
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
}
change_primogeniture_succession_law = {
	name = CB_NAME_PRIMOGENITURE_SUCCESSION_LAW
	war_name = WAR_NAME_PRIOGENITURE_SUCCESSION_LAW
	sprite = 6
	truce_days = 3650
	can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes
	
	can_use = {
		ROOT = {
			vassal_of = FROM	
		}
	}
		
	is_valid_title = {
		NOT = {
			has_law = succ_primogeniture
		}
		OR = {
			tier = emperor
			tier = king
			is_primary_holder_title = yes
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		flag_faction_revolt_title_effect = yes
	}
	
	on_invalidation = {
		FROM = { set_character_flag = prewar_liege_@ROOT }
		ROOT = { character_event = { id = 315913 } }
		destroy_faction_revolt_title_effect = yes
	}
	
	on_success = {
		ROOT = {
			hidden_tooltip = { 
				character_event = { id = 315911 } 
			}
		}
		FROM = {
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
	#					is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_2
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_3
					}
				}
			}
		}
		
		ROOT = {
			show_scope_change = no
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100 
				disband_event_forces = faction_revolters
			}
		}
		destroy_faction_revolt_title_effect = yes
	}

	on_success_title = {
		succession_w_cooldown = primogeniture
	}

	on_fail = {
		ROOT = {
			show_scope_change = no
			hidden_tooltip = { 
				character_event = { id = 315911 } 
			}
			prestige = -100
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_primogeniture_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		destroy_faction_revolt_title_effect = yes
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			hidden_tooltip = { 
				set_character_flag = faction_defeated
				character_event = { id = 315911 } 
			}
			prestige = -200
			prisoner = FROM
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 100
			hidden_tooltip = { 
				if = { 
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_primogeniture_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		destroy_faction_revolt_title_effect = yes
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
}
change_feudal_elective_succession_law = {
	name = CB_NAME_FEUDAL_ELECTIVE_SUCCESSION_LAW
	war_name = WAR_NAME_FEUDAL_ELECTIVE_SUCCESSION_LAW
	sprite = 6
	truce_days = 3650
	can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes
	
	can_use = {
		ROOT = {
			vassal_of = FROM	
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		flag_faction_revolt_title_effect = yes
	}

	is_valid_title = {
		has_feudal_elective_succession_law = no
		OR = {
			tier = emperor
			tier = king
			is_primary_holder_title = yes
		}

#		OR = {
#			AND = {
#				tier = emperor
#				OR = {
#					ROOT = { tier = king }
#					ROOT = { tier = duke }
#				}
#			}
#			AND = {
#				tier = king
#				ROOT = { tier = duke }
#			}
#			AND = {
#				tier = duke
#				ROOT = { tier = count }
#			}
#		}

	}
	
	on_invalidation = {
		FROM = { set_character_flag = prewar_liege_@ROOT }
		ROOT = { character_event = { id = 315913 } }
		destroy_faction_revolt_title_effect = yes
	}
	
	on_success = {
		ROOT = {
			hidden_tooltip = { 
				character_event = { id = 315911 } 
			}
		}
		FROM = {
		
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
	#					is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_2
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_3
					}
				}
			}
		}
		ROOT = {
			show_scope_change = no
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100 
				disband_event_forces = faction_revolters
			}
		}
		destroy_faction_revolt_title_effect = yes
	}
	
	on_success_title = {
		succession_w_cooldown = feudal_elective
	}

	on_fail = {
		ROOT = {
			show_scope_change = no
			hidden_tooltip = { 
				character_event = { id = 315911 } 
			}
			prestige = -100
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_feudal_elective_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		destroy_faction_revolt_title_effect = yes
	}
	
	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			hidden_tooltip = { 
				set_character_flag = faction_defeated
				character_event = { id = 315911 } 
			}
			prestige = -200
			prisoner = FROM
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 100
			hidden_tooltip = { 
				if = { 
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_feudal_elective_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		destroy_faction_revolt_title_effect = yes
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
}

invasion = {					# Available only to skilled and prestigious High Kings
	name = CB_NAME_INVASION
	war_name = WAR_NAME_INVASION
	sprite = 7
	truce_days = 1095
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = no
	can_call_allies = yes
	can_call_vassals = yes
	can_ask_to_join_war = no
	
	allow_distant = yes
	
	allowed_to_target_tributaries = no
	
	sort_priority = 2000
	
	can_use = {
		ROOT = {
			OR = {
				AND = {
					is_female = no
					age = 25
					OR = {
						tier = EMPEROR
						AND = {
							has_landed_title = k_gaul
							has_global_flag = senate_restored
							is_roman_culture_trigger = yes
						}
					}				
					prestige = 2000
					martial = 17
					diplomacy = 15
					OR = {
						trait = brilliant_strategist
						trait = skilled_tactician
					}
					NOR = { 
						trait = weak
						trait = shy
						trait = slow
						trait = blinded
						trait = incapable
						trait = slothful
						trait = imbecile
						trait = content
						trait = craven 
					}
				}
				AND = {
					has_character_flag = allowed_invasion
					FROM = { has_character_flag = allowed_invasion_target }
				}
			}
		}

		FROM = {
			OR = {
				AND = {
					independent = yes
					NOR = {
						culture = ROOT
						religion = ROOT
						AND = {
							culture = armorican
							NOT = { year = 520 }
							ROOT = { NOT = { has_character_flag = allowed_invasion } }
						}
					}
					NOT = {
						is_istvaeonic_culture_trigger = yes
						NOT = { year = 550 }
					}
				}
				AND = {
					has_character_flag = allowed_invasion_target
					ROOT = { has_character_flag = allowed_invasion }
				}
			}
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	is_valid = {
		ROOT = {
			OR = {
				AND = {
					is_female = no
					age = 25
					OR = {
						tier = EMPEROR
						AND = {
							has_landed_title = k_gaul
							has_global_flag = senate_restored
							is_roman_culture_trigger = yes
						}
					}				
					prestige = 2000
					OR = {
						trait = brilliant_strategist
						trait = skilled_tactician
					}
					NOR = { 
						trait = blinded
						trait = incapable 
					}
				}
				AND = {
					has_character_flag = allowed_invasion
					FROM = { has_character_flag = allowed_invasion_target }
				}
			}
		}

		FROM = {
			OR = {
				AND = {
					independent = yes
					NOT = { culture = ROOT }
					NOT = { religion = ROOT }
				}
				AND = {
					has_character_flag = allowed_invasion_target
					ROOT = { has_character_flag = allowed_invasion }
				}
			}
		}
	}
	
	can_use_title = {
		higher_tier_than = COUNT
		FROM = {
			has_landed_title = PREV
		}
		holder_scope = {
			NOT = { same_realm = ROOT }
		}
	}
		
	is_valid_title = {
		higher_tier_than = COUNT
		FROM = {
			has_landed_title = PREV
		}
		holder_scope = {
			NOT = { same_realm = ROOT }
		}
	}
	
	on_success = {
		any_attacker = {
			limit = {
				character = ROOT
				NOT = { religion_group = christian }
			}
			piety = 150
		}
		ROOT = {
			show_scope_change = no
			participation_scaled_prestige = 250
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		
		hidden_tooltip = {
			ROOT = {
				occupy_minors_of_occupied_settlements = FROM
				gain_all_occupied_titles = FROM			
				if = {
					limit = {
						NOT = { has_character_flag = allowed_invasion }
						prestige = 2000
						martial = 14
						realm_size = 70
					}
					give_nickname = nick_the_conqueror
				}
				clr_character_flag = allowed_invasion
			}
		}
		
		FROM = {
			show_scope_change = no
			prestige = -200
			clr_character_flag = allowed_invasion_target
		}
	}

	on_success_title = {
		custom_tooltip = {
			text = invasion_succ_tip
		}
		if = {
			limit = {
				higher_tier_than = BARON
				NOT = { culture = ROOT }
			}
			hidden_tooltip = { conquest_culture = ROOT }
		}
	}

	on_fail = {
		ROOT = {
			show_scope_change = no
			prestige = -200
			clr_character_flag = allowed_invasion
		}
		FROM = {
			show_scope_change = no
			prestige = 100
			clr_character_flag = allowed_invasion_target
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 5.0
			}
			clr_character_flag = allowed_invasion
		}
		FROM = {
			show_scope_change = no
			prestige = 200
			clr_character_flag = allowed_invasion_target
		}
		FROM = {
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
	}

	on_reverse_demand_title = {
	}

	attacker_ai_victory_worth = {
		factor = 150
	}
	
	attacker_ai_defeat_worth = {
		factor = 75
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 0
	}
}

tribal_invasion = {
	name = CB_NAME_INVASION
	war_name = WAR_NAME_INVASION
	sprite = 8
	truce_days = 1095
	hostile_against_others = yes
	is_permanent = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	
	allowed_to_target_tributaries = no
	
	sort_priority = 2000
	
	can_use_gui = {
		ROOT = {
			OR = {
				trait = tough_soldier
				trait = skilled_tactician
				trait = brilliant_strategist
			}
			martial = 15
			prestige = 1500
			NOR = {
				trait = craven
				trait = weak
				trait = incapable
				trait = imbecile
			}
		}
		conditional_tooltip = {
			trigger = {
				ROOT = { has_character_modifier = friendly_with_romans }
				FROM = { culture = romanogallic }
			}
			NAND = {			# Block Childeric against Soissons
				ROOT = { has_character_modifier = friendly_with_romans }
				FROM = { culture = romanogallic }
			}
		}
	}

	can_use = {
		OR = {
			AND = {
				ROOT = { has_character_flag = frankish_invasion_allowed }
				FROM = { has_character_flag = frankish_invasion_target }
			}
			AND = {
				ROOT = { 
					OR = {
						culture = oldfrankish
						culture = frankish
					}
					independent = yes
				}
				FROM = {
					any_realm_province = {
						any_neighbor_province = {
							owner = {
								OR = {
									character = ROOT
									is_liege_or_above = ROOT
								}
							}
						}
					}
					NOR = {
						culture = oldfrisian
						culture = frisian 
					}
					realm_size = 20
				}
				OR = {
					NOT = { year = 600 }
					FROM = { is_istvaeonic_culture_trigger = yes }
				}
				NOR = { 
					has_character_flag = frankish_invasion_used		
					AND = {				# Block Franks against Frisians
						ROOT = { 
							is_frankish_culture_trigger = yes
						}
						FROM = { 
							OR = {
								culture = oldfrisian
								culture = frisian 
							}
						}
						NOT = { year = 650 }
					}		
					AND = {			# Block Franks against Saxons
						ROOT = { 
							is_frankish_culture_trigger = yes
						}
						FROM = { 
							OR = {
								culture = oldsaxon
								culture = saxon
							}
						}
						NOT = { year = 700 }
					}
					ROOT = {
						is_tributary = yes
						suzerain = {
							character = FROM
						}
					}
				}
			}
			# AND = {
				# has_character_flag = is_child_of_destiny
				# any_owned_bloodline = {
					# has_bloodline_flag = founder_invasions
				# }
			# }
			# AND = {
				# NOT = { has_character_flag = flag_declared_bloodline_invasion }
				# any_owned_bloodline = {
					# has_bloodline_flag = bloodline_great_conquerors
				# }
			# }
		}
	}
	
	can_use_title = {
		tier = KING
		FROM = {
			has_landed_title = PREV
		}
		holder_scope = {
			NOT = { same_realm = ROOT }
		}
		NOT = { title = k_broceliande }
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		if = {
			limit = { 
				attacker = { 
					any_owned_bloodline = {
						has_bloodline_flag = bloodline_great_conquerors
					} 
				} 
			}
			attacker = {  
				set_character_flag = flag_declared_bloodline_invasion
			}
		}
	}
	
	on_add_title = {
		ROOT = {
			set_character_flag = frankish_invasion_used 
		}
	}

	on_success = {
		ROOT = {
			show_scope_change = no
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = {
				character = ROOT
				NOT = { religion_group = christian }
			}
			show_scope_change = no
			piety = 150
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		FROM = {
			show_scope_change = no
			prestige = -200
		}
	}
	
	on_success_title = {
		hidden_tooltip = {
			if = {
				limit = { 
					title = k_benoic 
					holder_scope = {
						character = FROM
					}
					ROOT = { is_istvaeonic_culture_trigger = yes }
					NOT = { has_global_flag = franks_sack_trebes }
				}
				ROOT = { 
					set_character_flag = benoic_defeated_franks
					character_event = { id = 312220 } # Siege of Trebes
				}	
				break = yes
			}
			if = {
				limit = {
					title = k_gaul
					holder_scope = {
						character = FROM
					}
					NOT = { has_global_flag = roman_provinces_gaul_restored }
					NOT = { has_global_flag = soissons_conquered }
					ROOT = { is_istvaeonic_culture_trigger = yes }
				}
				ROOT = { set_character_flag = conquered_soissons }
			}
			if = {
				limit = {
					title = k_benoic
					holder_scope = {
						character = FROM
					}
					NOT = { has_global_flag = benoic_conquered }
					ROOT = { is_istvaeonic_culture_trigger = yes }
				}
				ROOT = { set_character_flag = conquered_benoic }
			}
			if = {
				limit = {
					title = k_visigoths
					holder_scope = {
						character = FROM
					}
					FROM = {
						any_realm_province = {
							OR = {
								region = world_gaul_aquitania
								region = custom_tolosa
							}
						}
					}
					NOT = { has_global_flag = toulouse_conquered }
					ROOT = { is_istvaeonic_culture_trigger = yes }
				}
				ROOT = { set_character_flag = conquered_toulouse }
			}
			if = {
				limit = {
					title = k_burgundy
					holder_scope = {
						character = FROM
					}
					NOT = { has_global_flag = burgundy_subjugated }
					ROOT = { is_istvaeonic_culture_trigger = yes }
				}
				ROOT = { set_character_flag = conquered_burgundy }
			}
			if = {
				limit = {
					title = k_praetorian_prefecture_of_gaul
					holder_scope = {
						character = FROM
					}
					NOT = { has_global_flag = provence_conquered }
					ROOT = { is_istvaeonic_culture_trigger = yes }
				}
				ROOT = { set_character_flag = conquered_provence }
			}
			if = {
				limit = {
					title = k_alemannia
					holder_scope = {
						character = FROM
					}
					NOT = { has_global_flag = alemannia_subjugated }
					ROOT = { is_istvaeonic_culture_trigger = yes }
				}
				ROOT = { set_character_flag = conquered_alemannia }
			}
		}
		if = {
			limit = {
				title = k_visigoths
				holder_scope = {
					character = FROM
				}
				ROOT = { is_istvaeonic_culture_trigger = yes }
				FROM = {
					any_realm_province = {
						count = 10
						region = world_gaul
						NOT = { region = world_gaul_narbonensis_septimania }
					}
					any_realm_province = {
						region = world_gaul
						NOT = { region = world_gaul_narbonensis_septimania }
					}
				}
			}
			custom_tooltip = {  
				text = tribal_invasion_toulouse_succ_tip
			}
			hidden_tooltip = {		# Usurp or vassalize all titles in Aquitania or Tolosa, but only in those regions
				ROOT = { character_event = { id = 313210 } }
			}
			break = yes
		}
		custom_tooltip = {  
			text = tribal_invasion_succ_tip
		}
		hidden_tooltip = {
			ROOT = {
				occupy_minors_of_occupied_settlements = FROM
				gain_all_occupied_titles = FROM
			}
			if = {
				limit = {
					holder_scope = {
						character = FROM
						tier = KING
						NOT = { num_of_king_titles = 2 }
					}
				}
				if = {
					limit = {
						OR = {
							title = k_franks
							title = k_ripuarian_franks
							title = k_neustria
							title = k_orleans
							title = k_aquitaine
							title = k_burgundy
						}
					}
					usurp_title = ROOT
				}
				# Disband all legions belonging to FROM
				FROM = {
					any_vassal = {
						limit = { government = legion_government }
						primary_title = {
							unsafe_destroy_landed_title = THIS
							activate_title = { title = THIS status = no }
						}
					}
				}
				ROOT = {
					vassalize_or_take_under_title = {
						title = PREV
						enemy = FROM
						is_crusade = yes # Even if the title holder is not participating in the war, gain holdings occupied by all Crusade participants
					}
				}
				FROM = {
					any_vassal = {
						limit = { mercenary = no }
						set_defacto_liege = ROOT
						opinion = {
							modifier = opinion_subjugated
							who = ROOT
							months = 120
						}
					}
					any_demesne_title = {
						limit = { lower_tier_than = DUKE }
						usurp_title = ROOT
					}
					imprison = ROOT
				}
				if = {
					limit = {
						NOR = {
							title = k_franks
							title = k_ripuarian_franks
							title = k_neustria
							title = k_orleans
							title = k_aquitaine
							title = k_burgundy
						}
					}
					destroy_landed_title = THIS
				}
			}
			if = {
				limit = {
					NOT = {
						holder_scope = {
							character = FROM
							tier = KING
							NOT = { num_of_king_titles = 2 }
						}
					}
				}
				ROOT = {
					vassalize_or_take_under_title = {
						title = PREV
						enemy = FROM
						is_crusade = yes # Even if the title holder is not participating in the war, gain holdings occupied by all Crusade participants
					}
				}
			}
			if = {
				limit = {
					holder_scope = {
						character = FROM
					}
					OR = {
						title = k_franks
						title = k_ripuarian_franks
						title = k_neustria
						title = k_orleans
						title = k_aquitaine
						title = k_burgundy
					}
				}
				usurp_title = ROOT
			}
			if = {
				limit = {
					holder_scope = {
						character = FROM
					}
					NOR = {
						title = k_franks
						title = k_ripuarian_franks
						title = k_neustria
						title = k_orleans
						title = k_aquitaine
						title = k_burgundy
					}
				}
				destroy_landed_title = THIS
			}
			if = {
				limit = {
					ROOT = { has_character_flag = conquered_soissons }
				}
				ROOT = { 
					clr_character_flag = conquered_soissons
					character_event = { id = 314201 } 
				}
			}
			if = {
				limit = {
					ROOT = { has_character_flag = conquered_benoic }
				}
				ROOT = { 
					clr_character_flag = conquered_benoic
					character_event = { id = 314202 }
				}
			}
			if = {
				limit = {
					ROOT = { has_character_flag = conquered_toulouse }
				}
				ROOT = { 
					clr_character_flag = conquered_toulouse
					character_event = { id = 314204 } 
				}
			}
			if = {
				limit = {
					ROOT = { has_character_flag = conquered_burgundy }
				}
				ROOT = {
					#clr_character_flag = conquered_burgundy
					character_event = { id = 314205 } 
				}
			}
			if = {
				limit = {
					ROOT = { has_character_flag = conquered_provence }
				}
				ROOT = {
					clr_character_flag = conquered_provence
					character_event = { id = 314206 } 
				}
			}
			if = {
				limit = {
					ROOT = { has_character_flag = conquered_alemannia }
				}
				ROOT = {
					character_event = { id = 314210 } 
					clr_character_flag = conquered_alemannia
				}
			}
		}
	}

	on_fail = {
		FROM = {
			show_scope_change = no
			prestige = 100
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		ROOT = {
			show_scope_change = no
			prestige = -200
		}
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			show_scope_change = no
			prestige = 200
		}
		FROM = {
			if = {
				limit = { 
					has_dlc = "Legacy of Rome"
					is_roman_emperor_trigger = yes
					OR = {
						religion_group = christian
						is_hellenic_group_religion_trigger = yes
					}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = 150
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		modifier = {
			factor = 0		# Not if small or kingdom has few counties
			OR = {
				FROM = { NOT = { num_of_count_titles_in_realm = 6 } }
				FROM = {
					OR = {
						tier = EMPEROR
						num_of_king_titles = 2
					}
					num_of_realm_counties = {
						value = 6
						title = PREV
					}
				}
			}
		}
		modifier = {
			factor = 5		# Prefer for larger realms
			OR = {
				FROM = { 
					num_of_count_titles_in_realm = 10 
					lower_tier_than = EMPEROR
					NOT = { num_of_king_titles = 2 }
				}
				FROM = {
					OR = {
						tier = EMPEROR
						num_of_king_titles = 2
					}
					num_of_realm_counties = {
						value = 10
						title = PREV
					}
				}
			}
		}
		modifier = {
			factor = 10		# Prefer for larger realms
			OR = {
				FROM = { 
					num_of_count_titles_in_realm = 20 
					lower_tier_than = EMPEROR
					NOT = { num_of_king_titles = 2 }
				}
				FROM = {
					OR = {
						tier = EMPEROR
						num_of_king_titles = 2
					}
					num_of_realm_counties = {
						value = 20
						title = PREV
					}
				}
			}
		}
		modifier = {
			factor = 0		# Clovis shouldn't declare war before the event
			ROOT = { character = 1100 }
			NOT = { has_global_flag = frankish_war_480 }
		}
	}
}

### INDEPENDENCE and REVOLT CBs ###
bid_for_independence = {
	name = CB_NAME_INDEPENDENCE
	war_name = WAR_NAME_INDEPENDENCE
	sprite = 12
	truce_days = 1095
	
	is_permanent = yes
	is_independence = yes
	
	sort_priority = 1500

	can_use = {
		ROOT = {
			de_facto_liege = FROM
		}
		
		FROM = {
			NOT = {
				any_war = {
					attacker = {
						character = FROM
					}
					OR = {
						using_cb = bid_for_independence
						using_cb = depose_liege
					}
				}
			}
		}
	}

	can_use_gui = {
		ROOT = {
			NOT = {
				trait = loyal
			}
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = { 
					FROM = { 
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
		FROM = {
			any_demesne_title = {
				NOT = { lower_tier_than = ROOT }
				temporary = no
			}
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success = {
		if = {
			limit = {
				FROM = {
					independent = no
				}
			}
			FROM = {
				liege = {
					ROOT = {
						set_defacto_liege = PREV
					}
				}
			}
		}

		if = {
			limit = {
				FROM = {
					independent = yes
				}
			}
			ROOT = {
				set_defacto_liege = ROOT
			}
		}

		hidden_tooltip = {
			ROOT = {
				prestige = 100
				if = {
					limit = { 
						NOR = {
							has_character_flag = revolt_for_mercia
							has_character_flag = revolt_for_wessex
							has_character_flag = revolt_for_northumbria
							has_character_flag = revolt_for_essex
							has_character_flag = revolt_for_sussex
							has_character_flag = revolt_for_cantia
							has_character_flag = revolt_for_meonware
							has_character_flag = revolt_from_sussex
							AND = {
								primary_title = { title = d_cantware }
								FROM = { primary_title = { title = k_sussex } }
								NOT = { has_global_flag = cantia_created }
							}
							government = tribal_government
						}
					}
					any_demesne_title = {
						add_pressed_claim = FROM
					}
				}
				set_character_flag = ai_flag_never_transfer
			}
		}
		
		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = {
				character = ROOT
				NOT = { religion_group = christian }
			}
			piety = 50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}

		FROM = {
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
	#					is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_2
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_3
					}
				}
			}
		}
		if = {
			limit = {
				ROOT = {
					OR = {
						independent = yes
						liege = { tier = EMPEROR }
					}
					has_character_flag = claiming_iclingas
				}
			}
			ROOT = { character_event = { id = 313071 } }
		}
		if = {
			limit = {
				ROOT = {
					NOR = {
						independent = yes
						liege = { tier = EMPEROR }
					}
					has_character_flag = claiming_iclingas
				}
			}
			ROOT = { character_event = { id = 313072 } }
		}
	}

	on_fail = {
		ROOT = {
			prestige = -50
		}
		ROOT = {
			participation_scaled_prestige = -50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = -50 }
		}
		if = {
			limit = { ROOT = { has_character_flag = claiming_iclingas } }
			ROOT = { character_event = { id = 313073 } }
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -100
			prisoner = FROM
		}
		ROOT = {
			participation_scaled_prestige = -100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = -100 }
		}
		FROM = {
			prestige = 50
		}
		if = {
			limit = { ROOT = { has_character_flag = claiming_iclingas } }
			ROOT = { character_event = { id = 313073 } }
		}
	}

	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}

		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 150
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 90
	}
}

depose_liege = {
	name = CB_NAME_DEPOSE_LIEGE
	war_name = WAR_NAME_DEPOSE_LIEGE
	sprite = 12
	truce_days = 1095
	
	is_permanent = yes
	can_call_vassals = yes

	can_use = {
		ROOT = {
			de_facto_liege = FROM
		}
		
		# cannot depose 
		FROM = {
			in_revolt = no
			liege = {
				in_revolt = no
				liege = {
					in_revolt = no
				}
			}
			NOT = {
				any_war = {
					OR = {
						AND = { # Cannot depose liege when our liege is currently involved in such a war
							attacker = {
								character = FROM
							}
							OR = {
								using_cb = bid_for_independence
								using_cb = depose_liege
							}
						}
						AND = { # Cannot depose liege if someone else is already deposing liege
							defender = {
								character = FROM
							}
							using_cb = depose_liege
						}
					}
				}
			}
		}
	}

	can_use_gui = {
		ROOT = {
			NOT = {
				trait = loyal
			}
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = { 
					FROM = { 
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
		FROM = {
			higher_tier_than = ROOT
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success = {	
		# Flag marches
		FROM = { save_event_target_as = target_char }
		flag_target_marches_effect = yes
		
		FROM = {
			prestige = -500
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
	#					is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_2
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_3
					}
				}
			}
			
			primary_title = { 
				set_title_flag = former_primary_title 
				save_event_target_as = FROM_old_primary_title
			}
			if = {
				limit = { NOT = { government = tribal_government } }
				abdicate_to_most_liked_by = ROOT
			}
			if = {
				limit = { government = tribal_government }
				usurp_all_top_level_titles_to_ROOT_effect = yes
			}
		}
		
		# Transfer marches
		PREVPREV = { save_event_target_as = new_holder }
		FROM = { save_event_target_as = old_holder }
		event_target:FROM_old_primary_title = { transfer_marches_to_new_holder_claim_effect = yes }
		
		# Transfer foederati
		hidden_tooltip = {
			any_title = { 
				limit = { 
					has_title_flag = former_primary_title 
					higher_tier_than = COUNT
				}
				holder_scope = { 
					character_event = { id = foederati.21 } 
				}
			}
		}
		
		ROOT = {
			participation_scaled_prestige = 250
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 250 }
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			prisoner = FROM
		}
		FROM = {
			participation_scaled_prestige = 50
			hidden_tooltip = { 
				if = { 
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 150
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
}

overthrow_ruler = {
	name = CB_NAME_OVERTHROWRULER
	war_name = WAR_NAME_OVERTHROWRULER
	sprite = 12
	truce_days = 1825
	is_tyranny_cb = yes
	
	is_revolt_cb = yes
	can_call_vassals = yes

	can_use = {
		ROOT = {
			de_facto_liege = FROM
		}
		FROM = {
			OR = {
				trait = cruel
				trait = impaler
				# trait = ruthless
			}
			NOT = {
				OR = {
					trait = just
					trait = kind
					# trait = honorable
					trait = charitable
				}
			}
		}
	}

	can_use_gui = {
		ROOT = {
			NOT = {
				trait = loyal
			}
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = { 
					FROM = { 
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
		FROM = {
			higher_tier_than = ROOT
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		hidden_tooltip = {
			# Legions that join the rebellion defect
			FROM = {
				any_vassal = {
					limit = { government = legion_government }
					character_event = { id = 315915 days = 2 }
				}
			}
		}
	}
	
	on_success = {
		ROOT = {
			primary_title = {
				add_pressed_claim = FROM	
			}
		}
		FROM = {
			prestige = -500
			remove_opinion = {
				who = ROOT
				modifier = declared_war
			}
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
	#					is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_2
					}
				}
			}
			if = {
				limit = { has_dlc = "Zeus" }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = duke
							tier = king
							tier = emperor
						}
						NOT = { has_law = revoke_title_law_0 }
					}
					if = {
						limit = { has_law = revoke_title_law_1 }
						add_law = revoke_title_law_0
					}
					if = {
						limit = { has_law = revoke_title_law_2 }
						add_law = revoke_title_law_0
					}
				}
			}
			abdicate = yes
		}
		ROOT = {
			participation_scaled_prestige = 250
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 250 }
			hidden_tooltip = {
				# Return revolting legions
				character_event = { id = 315917 days = 2 }
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			remove_opinion = {
				who = ROOT
				modifier = declared_war
			}
		}
		any_attacker = {
			hidden_tooltip = {
				# Return revolting legions
				character_event = { id = 315917 days = 2 }
			}
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			prisoner = FROM
		}
		FROM = {
			participation_scaled_prestige = 50
			hidden_tooltip = { 
				if = { 
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		hidden_tooltip = {
			any_attacker = {
				hidden_tooltip = {
					# Return revolting legions
					character_event = { id = 315917 days = 2 }
				}
			}
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_council_power_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 150
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
}
overthrow_ruler_no_calls = {
	name = CB_NAME_OVERTHROWRULER_NC
	war_name = WAR_NAME_OVERTHROWRULER_NC
	sprite = 12
	truce_days = 1825
	
	is_revolt_cb = yes
	can_call_vassals = no
	can_ask_to_join_war = no

	can_use = {
		ROOT = {
			de_facto_liege = FROM
			#NOT = { culture = roman }
		}
		FROM = {
			OR = {
				trait = cruel
				trait = impaler
				# trait = ruthless
			}
			NOT = {
				OR = {
					trait = just
					trait = kind
					# trait = honorable
					trait = charitable
				}
			}
		}
	}

	can_use_gui = {
		ROOT = {
			NOT = {
				trait = loyal
			}
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = { 
					FROM = { 
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
		FROM = {
			higher_tier_than = ROOT
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success = {
		ROOT = {
			prestige = 200
			primary_title = {
				add_pressed_claim = FROM	
			}
		}
		FROM = {
			prestige = -500
			remove_opinion = {
				who = ROOT
				modifier = declared_war
			}
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
	#					is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_2
					}
				}
			}
			abdicate = yes
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		
		FROM = {
			prestige = -100
			remove_opinion = {
				who = ROOT
				modifier = declared_war
			}
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			prisoner = FROM
		}
		FROM = {
			prestige = 50
			hidden_tooltip = { 
				if = { 
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
}

change_gavelkind_succession_law = {
	name = CB_NAME_GAVELKIND_SUCCESSION_LAW
	war_name = WAR_NAME_GAVELKIND_SUCCESSION_LAW
	sprite = 6
	truce_days = 1825
	can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes
	
	can_use = {
		ROOT = {
			vassal_of = FROM	
		}
	}

	is_valid_title = {
		NOT = {
			has_law = succ_gavelkind
		}
		OR = {
			tier = emperor
			tier = king
			is_primary_holder_title = yes
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		flag_faction_revolt_title_effect = yes
	}
	
	on_invalidation = {
		FROM = { set_character_flag = prewar_liege_@ROOT }
		ROOT = { character_event = { id = 315913 } }
		destroy_faction_revolt_title_effect = yes
	}
	
	on_success = {
		ROOT = {
			hidden_tooltip = { 
				character_event = { id = 315911 } 
			}
		}
		FROM = {
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
	#					is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_2
					}
				}
			}
		}
		
		ROOT = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100 
				disband_event_forces = faction_revolters
			}
		}
		destroy_faction_revolt_title_effect = yes
	}

	on_success_title = {
		succession_w_cooldown = gavelkind
	}

	on_fail = {
		ROOT = {
			hidden_tooltip = { 
				character_event = { id = 315911 } 
			}
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_gavelkind_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		destroy_faction_revolt_title_effect = yes
	}

	on_reverse_demand = {
		ROOT = {
			hidden_tooltip = { 
				set_character_flag = faction_defeated
				character_event = { id = 315911 } 
			}
			prestige = -200
			prisoner = FROM
		}
		FROM = {
			participation_scaled_prestige = 100
			hidden_tooltip = { 
				if = { 
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_gavelkind_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		destroy_faction_revolt_title_effect = yes
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 75
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
}
lower_crown_authority_law = {
	name = CB_NAME_LOWER_CROWN_AUTHORITY_LAW
	war_name = WAR_NAME_LOWER_CROWN_AUTHORITY_LAW
	sprite = 6
	truce_days = 1825
	can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes
	
	can_use = {
		ROOT = {
			vassal_of = FROM
		}
		NOT = { has_dlc = "Zeus" }
	}
	
	can_use_title = {
		holder_scope = { independent = yes }
		OR = {
			tier = king
			tier = emperor
		}
		OR = {
			has_law = crown_authority_1
			has_law = crown_authority_2
			has_law = crown_authority_3
			has_law = crown_authority_4
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		flag_faction_revolt_title_effect = yes
	}
	
	on_invalidation = {
		FROM = { set_character_flag = prewar_liege_@ROOT }
		ROOT = { character_event = { id = 315913 } }
		destroy_faction_revolt_title_effect = yes
	}

	on_success = {
		ROOT = {
			hidden_tooltip = { 
				character_event = { id = 315911 } 
			}
			opinion = {
				modifier = opinion_lowered_crown_authority
				who = FROM
				months = 12
			}
		}
		ROOT = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		destroy_faction_revolt_title_effect = yes
	}

	on_success_title = {
		if = {
			limit = { has_law = crown_authority_1 }
			add_law_w_cooldown = crown_authority_0
		}
		if = {
			limit = { has_law = crown_authority_2 }
			add_law_w_cooldown = crown_authority_1
		}
		if = {
			limit = { has_law = crown_authority_3 }
			add_law_w_cooldown = crown_authority_2
		}
		if = {
			limit = { has_law = crown_authority_4 }
			add_law_w_cooldown = crown_authority_3
		}
	}

	on_fail = {
		ROOT = {
			hidden_tooltip = {
				character_event = { id = 315911 } 
			}
			prestige = -100
		}
		
		FROM = {
			participation_scaled_prestige = 50
			hidden_tooltip = { disband_event_forces = faction_loyalists }
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_lower_CA_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		destroy_faction_revolt_title_effect = yes
	}

	on_reverse_demand = {
		ROOT = {
			hidden_tooltip = { 
				set_character_flag = faction_defeated
				character_event = { id = 315911 } 
			}
			prestige = -200
			prisoner = FROM
		}
		
		FROM = {
			participation_scaled_prestige = 100
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			hidden_tooltip = { 
				if = { 
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_lower_CA_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		destroy_faction_revolt_title_effect = yes
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 75
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		modifier = {
			factor = 0.5
			FROM = {
				OR = {
					has_landed_title = e_gaul
					has_landed_title = e_roman_britannia
				}
			}
		}
		modifier = {
			factor = 0.25
			ROOT = {
				is_roman_culture_trigger = yes
			}
		}			
	}
}
lower_tribal_organization_law = {
	name = CB_NAME_LOWER_TRIBAL_ORGANIZATION_LAW
	war_name = WAR_NAME_LOWER_TRIBAL_ORGANIZATION_LAW
	sprite = 6
	truce_days = 3650
	can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes
	
	can_use = {
		ROOT = {
			vassal_of = FROM
		}
		FROM = {
			is_tribal = yes
		}
	}
	
	can_use_title = {
		holder_scope = { independent = yes }
		OR = {
			tier = duke
			tier = king
			tier = emperor
		}
		OR = {
			has_law = tribal_organization_1
			has_law = tribal_organization_2
			AND = {
				has_law = tribal_organization_3
				holder_scope = { government = tribal_government }
			}
			has_law = tribal_organization_4
			has_law = tribal_organization_5
			has_law = tribal_organization_6
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		flag_faction_revolt_title_effect = yes
	}
	
	on_invalidation = {
		FROM = { set_character_flag = prewar_liege_@ROOT }
		ROOT = { character_event = { id = 315913 } }
		destroy_faction_revolt_title_effect = yes
	}

	on_success = {
		ROOT = {
			hidden_tooltip = { 
				character_event = { id = 315911 } 
			}
			opinion = {
				modifier = opinion_lowered_tribal_organization
				who = FROM
				months = 12
			}
		}
		ROOT = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		destroy_faction_revolt_title_effect = yes
	}

	on_success_title = {
		if = {
			limit = { has_law = tribal_organization_1 }
			add_law_w_cooldown = tribal_organization_0
		}
		if = {
			limit = { has_law = tribal_organization_2 }
			add_law_w_cooldown = tribal_organization_1
		}
		if = {
			limit = { 
				has_law = tribal_organization_3 
				holder_scope = { government = tribal_government }
			}
			add_law_w_cooldown = tribal_organization_2
		}
		if = {
			limit = { has_law = tribal_organization_4 }
			add_law_w_cooldown = tribal_organization_3
		}
		if = {
			limit = { has_law = tribal_organization_5 }
			add_law_w_cooldown = tribal_organization_4
		}
		if = {
			limit = { has_law = tribal_organization_6 }
			add_law_w_cooldown = tribal_organization_5
		}
	}

	on_fail = {
		ROOT = {
			hidden_tooltip = { 
				character_event = { id = 315911 } 
			}
			prestige = -100
		}
		
		FROM = {
			participation_scaled_prestige = 50
			hidden_tooltip = { disband_event_forces = faction_loyalists }
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_lower_TO_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		destroy_faction_revolt_title_effect = yes
	}

	on_reverse_demand = {
		ROOT = {
			hidden_tooltip = { 
				set_character_flag = faction_defeated
				character_event = { id = 315911 } 
			}
			prestige = -200
			prisoner = FROM
		}
		
		FROM = {
			participation_scaled_prestige = 100
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			hidden_tooltip = { 
				if = { 
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_lower_TO_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		destroy_faction_revolt_title_effect = yes
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = { 
					FROM = { 
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
	}
}

coastal_republic = {
	name = CB_NAME_COASTAL_REPUBLIC
	war_name = WAR_NAME_COASTAL_REPUBLIC
	sprite = 1
	truce_days = 3650
	is_permanent = yes
	check_all_titles = yes
	can_ask_to_join_war = no
	
	allow_distant = yes # AI parameter
	
	allowed_to_target_tributaries = no
	
	sort_priority = 700

	can_use = {
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
			NOT = { is_liege_or_above = FROM }
			NOT = { is_vassal_or_below = FROM }
			NOT = { same_liege = FROM }
		}
	}

	can_use_title = {
		tier = BARON
		is_capital = no # Minor Holding
		is_republic = yes
		
		location = {
			port = yes
			
			# Must have a trade post there already
			OR = {
				PREV = {
					holder_scope = {
						NOT = { same_realm = ROOT }
						OR = {
							is_patrician = yes
							is_merchant_republic = yes
						}
					}
				}
				trade_post_owner = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
			}
			
			# Not allowed to use this CB to take cities in the capital province of a rival merchant republic
			FROM = { 
				OR = {
					is_merchant_republic = no
					capital_scope = {
						NOT = { province_id = PREVPREV }
					}
				}
			}
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	is_valid = {
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
		}
	}

	on_success_title = {
		if = {
			limit = {
				NOT = {
					location = {
						trade_post_owner = {
							is_liege_or_above = ROOT
						}
					}
				}
			}
			usurp_title = ROOT
		}
		
		if = {
			limit = {
				location = {
					trade_post_owner = {
						is_liege_or_above = ROOT
					}
				}
			}
			location = {
				trade_post_owner = {
					usurp_title = PREVPREV
				}
			}
		}
		
		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}   

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 50 
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 50
	}
}
coastal_county_republic = {
	name = CB_NAME_COASTAL_COUNTY_REPUBLIC
	war_name = WAR_NAME_COASTAL_COUNTY_REPUBLIC
	sprite = 1
	truce_days = 3650
	is_permanent = yes
	check_all_titles = yes
	can_ask_to_join_war = no
	
	allow_distant = yes # AI parameter
	
	allowed_to_target_tributaries = no
	
	sort_priority = 700

	can_use = {
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
			NOT = { is_liege_or_above = FROM }
			NOT = { is_vassal_or_below = FROM }
			NOT = { same_liege = FROM }
		}
	}

	can_use_title = {
		tier = COUNT
		location = {
			port = yes
			county = {
				any_direct_de_jure_vassal_title = {
					holder_scope = {
						OR = {
							character = ROOT
							is_liege_or_above = ROOT
						}
					}
				}
			}
			any_neighbor_province = {
				OR = {
					AND = {
						has_owner = yes
						owner = {
							OR = {
								character = ROOT
								is_liege_or_above = ROOT
							}
						}
					}
					AND = {
						is_land = no
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											character = ROOT
											is_liege_or_above = ROOT
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										owner = {
											OR = {
												character = ROOT
												is_liege_or_above = ROOT
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	is_valid = {
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
		}
	}

	is_valid_title = {
		tier = COUNT
		location = {
			port = yes
			county = {
				any_direct_de_jure_vassal_title = {
					holder_scope = {
						OR = {
							character = ROOT
							is_liege_or_above = ROOT
						}
					}
				}
			}
		}
	}

	on_success_title = {
		if = {
			limit = {
				any_direct_de_jure_vassal_title = {
					holder_scope = {
						character = ROOT
					}
				}
			}
			usurp_title = ROOT
		}
		
		if = {
			limit = {
				NOT = {
					any_direct_de_jure_vassal_title = {
						holder_scope = {
							character = ROOT
						}
					}
				}
			}
			any_de_jure_vassal_title = {
				limit = {
					holder_scope = {
						is_liege_or_above = ROOT
					}
				}
				holder_scope = {
					usurp_title = PREVPREV
					set_defacto_liege = ROOT
				}
			}
		}
		
		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

weaken_vassal_plot = {
	name = CB_NAME_WEAKEN_VASSAL
	war_name = WAR_NAME_WEAKEN_VASSAL
	sprite = 3
	truce_days = 730
	hostile_against_others = yes

	press_claim = yes
	can_call_allies = no
	can_ask_to_join_war = no

	can_use_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success = {
		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = {
				NOT = { character = ROOT }
			}
			participation_scaled_prestige = 100
		}
		FROM = {
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
	#					is_titular = no
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_2
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_3
					}
				}
			}
		}
	}
	
	on_success_title = {
		FROM = {
			random_vassal = {
				limit = {
					tier = count
					any_demesne_title = {
						tier = count
						dejure_liege_title = {
							ROOT = {
								plot_target_title = {
									title = PREVPREV
								}
							}
						}
					}
				}
				grant_title = PREVPREV
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}
	
	on_invalidation = {
		ROOT = {
			cancel_plot = plot_weaken_fellow_vassal
		}
		
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			imprison = FROM
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}
	
	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}
		end_war = invalid
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
}

decadence_invasion = {
	name = CB_NAME_INVASION
	war_name = WAR_NAME_DEC_INVASION
	sprite = 7
	truce_days = 3650
	hostile_against_others = yes
	can_ask_to_join_war = no
	
	can_use = {
		ROOT = {
			has_character_flag = decadence_invader
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success = {
		any_playable_ruler = {
			limit = {
				ai = no
				NOT = { character = FROM }
				NOT = { dynasty = FROM }
				NOT = {
					any_liege = {
						character = FROM
					}
				}
				OR = {
					FROM = { higher_tier_than = DUKE }
					any_realm_province = {
						any_neighbor_province = {
							owner = {
								any_liege = {
									character = FROM
								}
							}
						}
					}
				}
			}
			narrative_event = { id = 91241 }
		}
		
		FROM = {
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					if = {
						limit = {
							OR = {
								tier = king
								tier = emperor
							}
							NOT = { has_law = crown_authority_0 }
						}
						add_law = crown_authority_0
					}
				}
			}
		}
		
		ROOT = {
			prestige = 200
			piety = 100
			occupy_minors_of_occupied_settlements = FROM
			gain_all_occupied_titles = { who = FROM type = revolt }
			give_nickname = nick_the_conqueror
			participation_scaled_prestige = 200
			participation_scaled_piety = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { 
				participation_scaled_prestige = 200
				participation_scaled_piety = 100
			}
		}
		
		FROM = {
			prestige = -200
			primary_title = {
				holder_scope = {
					any_demesne_title = {
						limit = {
							higher_tier_than = COUNT
							NOT = {
								tier = PREVPREV
							}
						}
						usurp_title_plus_barony_if_unlanded = { target = ROOT type = revolt }
						
						if = {
							limit = {
								NOT = { culture = ROOT }
							}
							hidden_tooltip = { conquest_culture = ROOT }
						}
					}
					any_demesne_title = {
						limit = {
							tier = PREVPREV
						}
						destroy_landed_title = THIS
					}
				}
			}
			
			set_defacto_liege = ROOT
			imprison = ROOT
			
			hidden_tooltip = {
				if = {
					limit = {
						has_nickname = no
					}
					random_list = {
						10 = { give_nickname = nick_the_decadent }
						10 = { give_nickname = nick_the_unready }
						10 = { give_nickname = nick_the_ill_ruler }
					}
				}
			}
		}
		
		hidden_tooltip = {
			ROOT = { 
				disband_event_forces = decadence_revolters
				
				# Powerful vassals can choose independence
				# any_vassal = {
					# limit = {
						# NOT = { character = FROM }
						# higher_tier_than = COUNT
						# prisoner = no
					# }
					# character_event = { id = 91240 }
				# }
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -200
		}
		FROM = {
			prestige = 100
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		hidden_tooltip = {
			ROOT = { disband_event_forces = decadence_revolters }
		}
	}

	on_reverse_demand = {
		ROOT = { set_defacto_liege = FROM }
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 8.0
			}
		}
		FROM = {
			prestige = 200
		}
		ROOT = { 
			imprison = FROM
			disband_event_forces = decadence_revolters
		}
		if = {
			limit = {
				FROM = {
					ai = no
					NOT = { has_character_flag = achievement_decadent_warrior }
				}
			}
			FROM = { set_character_flag = achievement_decadent_warrior }
		}
	}

	on_reverse_demand_title = {
		ROOT = { show_scope_change = no remove_claim = PREV }
	}

	attacker_ai_victory_worth = {
		factor = 100
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 150
	}
}
muslim_invasion = {
	name = CB_NAME_INVASION
	war_name = WAR_NAME_INVASION
	sprite = 8
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	is_holy_war = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	
	allowed_to_target_tributaries = no
	
	sort_priority = 2000

	can_use_gui = {
		ROOT = {
			piety = 1000
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		ROOT = { piety = -1000 }
	}

	can_use = {
		ROOT = {
			religion_group = muslim
			
			# These use 'tribal_invasion' instead:
			NOR = {
				is_nomadic = yes
				AND = {
					primary_title = { is_tribal_type_title = yes }
					has_horde_culture = yes
				}
				AND = {
					mercenary = yes
					NOT = {
						num_of_titles = 2
					}
				}
			}
		}
		
		FROM = { NOT = { religion = ROOT } }
		
		ROOT = {
			NOT = { is_liege_or_above = FROM }
			mercenary = no
		}
	}
	
	can_use_title = {
		# Muslims require the target to have at least 6 counties within the target kingdom
		FROM = {
			num_of_realm_counties = {
				value = 6
				title = PREV
			}
		}
		# The attacker needs at least one county in the target kingdom, or a border
		any_direct_de_jure_vassal_title = {
			any_direct_de_jure_vassal_title = {
				OR = {
					holder_scope = {
						OR = {
							character = ROOT
							is_liege_or_above = ROOT
						}
					}
					location = {
						any_neighbor_province = {
							owner = {
								OR = {
									character = ROOT
									is_liege_or_above = ROOT
								}
							}
						}
					}
				}
			}
		}
	}
	
	is_valid = {
		ROOT = {
			religion_group = muslim
		}
		FROM = { NOT = { religion = ROOT } }
	}
	
	is_valid_title = {
		FROM = {
			any_realm_province = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_success = {
		ROOT = {
			show_scope_change = no
			prestige = 200
			hidden_tooltip = {
				if = {
					limit = {
						has_ambition = obj_strengthen_religion
					}
					change_variable = { which = strengthen_religion value = 1 }
				}
			}
			participation_scaled_prestige = 200
			
			if = {
				limit = {
					uses_decadence = yes
					FROM = { NOT = { uses_decadence = yes } }
				}
				participation_scaled_decadence = -20
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { 
				participation_scaled_prestige = 200 
				if = {
					limit = {
						uses_decadence = yes
						FROM = { NOT = { uses_decadence = yes } }
					}
					participation_scaled_decadence = -20
				}
				hidden_tooltip = {
					if = {
						limit = {
							has_ambition = obj_strengthen_religion
						}
						change_variable = { which = strengthen_religion value = 1 }
					}
				}
			}
		}
		FROM = {
			show_scope_change = no
			prestige = -200
		}
	}
	
	on_success_title = {
		custom_tooltip = { 
			text = other_invasion_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title_destroy_duchies = {
						title = PREV
						enemy = FROM
						is_crusade = no # Even if the title holder is not participating in the war, gain holdings occupied by all Crusade participants
						type = invasion
					}
					
					if = {
						limit = {
							OR = {
								this_has_lame_nickname_trigger = yes
								has_nickname = no
							}
						}
						random_list = {
							10 = { give_nickname = nick_the_holy }
							10 = { give_nickname = nick_the_glorious }
							10 = { give_nickname = nick_the_lionheart }
							10 = { give_nickname = nick_the_great }
							10 = { give_nickname = nick_the_hammer }
							10 = { give_nickname = nick_the_magnificent }
						}
					}
				}
			}
		}
	}

	on_fail = {
		FROM = {
			show_scope_change = no
			prestige = 100
		}
		FROM = {
			show_scope_change = no
			if = {
				limit = {
					has_dlc = "Legacy of Rome"
					is_roman_emperor_trigger = yes
					OR = {
						religion_group = christian
						is_hellenic_group_religion_trigger = yes
					}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
			hidden_effect = {
				if = {
					limit = {
						OR = {
							this_has_lame_nickname_trigger = yes
							has_nickname = no
						}
					}
					random_list = {
						10 = { give_nickname = nick_the_holy }
						10 = { give_nickname = nick_the_glorious }
						10 = { give_nickname = nick_the_lionheart }
						10 = { give_nickname = nick_the_great }
						10 = { give_nickname = nick_the_hammer }
						10 = { give_nickname = nick_the_magnificent }
						10 = { give_nickname = nick_the_avenger }
					}
				}
			}
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		ROOT = {
			show_scope_change = no
			prestige = -200
		}
	}
	
	on_invalidation = {
		ROOT = {
			show_scope_change = no
			piety = 1000
		}
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			if = {
				limit = {
					NOT = {
						any_liege = {
							dynasty = PREV
						}
					}
				}
				decadence = 10
			}
		}
		FROM = {
			show_scope_change = no
			prestige = 200
			hidden_tooltip = {
				if = {
					limit = {
						has_ambition = obj_strengthen_religion
					}
					change_variable = { which = strengthen_religion value = 1 }
				}
			}
			if = {
				limit = { 
					has_dlc = "Legacy of Rome"
					is_roman_emperor_trigger = yes
					OR = {
						religion_group = christian
						is_hellenic_group_religion_trigger = yes
					}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
			hidden_effect = {
				if = {
					limit = {
						OR = {
							this_has_lame_nickname_trigger = yes
							has_nickname = no
						}
					}
					random_list = {
						10 = { give_nickname = nick_the_holy }
						10 = { give_nickname = nick_the_glorious }
						10 = { give_nickname = nick_the_lionheart }
						10 = { give_nickname = nick_the_great }
						10 = { give_nickname = nick_the_hammer }
						10 = { give_nickname = nick_the_magnificent }
						10 = { give_nickname = nick_the_avenger }
					}
				}
			}
		}
		FROM = {
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
			hidden_tooltip = {
				if = {
					limit = {
						has_ambition = obj_strengthen_religion
					}
					change_variable = { which = strengthen_religion value = 1 }
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = 100
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 150
	}
	
	ai_will_do = { 
		factor = 1
		
		modifier = {
			factor = 0.9 # Prefer using CB's without on_add costs
		}
		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_nomadic = no
				NOT = {
					is_tribal = yes
				}
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_tribal = yes
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = tribal
						}
					}
				}
			}
		}
	}
}

cb_faction_independence = {
	name = CB_NAME_INDEPENDENCE
	war_name = WAR_NAME_FACTION_INDEPENDENCE
	sprite = 12
	truce_days = 1095
	major_revolt = yes
	
	can_call_allies = no
	can_ask_to_join_war = yes
	
	is_independence = yes
	
	can_use = {
		ROOT = {
			vassal_of = FROM
		}		
	}

	can_use_gui = {
		ROOT = {
			NOT = {
				trait = loyal
			}
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = { 
					FROM = { 
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
		FROM = {
			any_demesne_title = {
				NOT = { lower_tier_than = ROOT }
				temporary = no
			}
			independent = yes
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		flag_faction_revolt_title_effect = yes
	}
	
	on_invalidation = {
		FROM = { set_character_flag = prewar_liege_@ROOT }
		ROOT = { character_event = { id = 315913 } }
		destroy_faction_revolt_title_effect = yes
	}

	on_success = {		
		if = {
			limit = {
				FROM = {
					independent = yes
				}
			}
			FROM = { set_character_flag = former_liege_@ROOT }
			any_attacker = {
				limit = {
					OR = {
						vassal_of = FROM
						liege_before_war = {
							character = FROM
						}
					}
				}
				set_character_flag = independence_faction_@ROOT
				set_defacto_liege = THIS
				set_character_flag = ai_flag_never_transfer
			}
			any_attacker = {
				limit = {
					OR = {
						vassal_of = FROM
						liege_before_war = {
							character = FROM
						}
					}
					FROM = {
						NAND = { 
							has_landed_title = k_anglia
							has_global_flag = anglia_collapse_factions
						}
					}
					NOT = { government = legion_government }
				}
				hidden_tooltip = {
					prestige = 100
					any_demesne_title = {
						add_weak_pressed_claim = FROM
					}
				}
			}
		}
		
		ROOT = {
			hidden_tooltip = { 
				character_event = { id = 315912 } 
			}
		}
		
		ROOT = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100
				disband_event_forces = faction_revolters
			}
		}

		FROM = {
			
			hidden_tooltip = { disband_event_forces = faction_loyalists }
		
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						NOT = { has_law = crown_authority_0 }
					}
					if = {
						limit = { has_law = crown_authority_1 }
						add_law = crown_authority_0
					}
					if = {
						limit = { has_law = crown_authority_2 }
						add_law = crown_authority_1
					}
					if = {
						limit = { has_law = crown_authority_3 }
						add_law = crown_authority_2
					}
					if = {
						limit = { has_law = crown_authority_4 }
						add_law = crown_authority_3
					}
				}
			}
		}
		
		hidden_tooltip = {
			if = {
				limit = {
					FROM = { has_landed_title = k_anglia }
					has_global_flag = anglia_collapse_factions
				}
				FROM = { character_event = { id = 313107 days = 1 } }
			}
		}
		destroy_faction_revolt_title_effect = yes
	}

	on_fail = {
		ROOT = {
			hidden_tooltip = { 
				character_event = { id = 315911 } 
			}
			prestige = -50
			prisoner = FROM
			add_character_modifier = {
				name = faction_independence_ultimatum_timer
				hidden = yes
				duration = 3650
			}
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		ROOT = {
			participation_scaled_prestige = -50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = -50 
				disband_event_forces = faction_revolters
			}
			add_character_modifier = {
				name = faction_independence_ultimatum_timer
				hidden = yes
				duration = 3650
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		hidden_tooltip = {
			if = {
				limit = {
					FROM = { has_landed_title = k_anglia }
					has_global_flag = anglia_collapse_factions
				}
				FROM = { character_event = { id = 313108 days = 1 } }
			}
		}
		destroy_faction_revolt_title_effect = yes
	}

	on_reverse_demand = {
		ROOT = {
			hidden_tooltip = { 
				set_character_flag = faction_defeated
				character_event = { id = 315911 } 
			}
			prestige = -100
			prisoner = FROM
			if = {
				limit = { is_tribal = no }
				add_character_modifier = {
					name = faction_independence_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
			else = {
				add_character_modifier = {
					name = faction_independence_ultimatum_timer
					hidden = yes
					duration = 1825
				}
			}
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		
		ROOT = {
			participation_scaled_prestige = -100
		}
		
		any_attacker = {
			limit = { 
				NOT = { character = ROOT }
				liege = { character = FROM } 
			}
			prisoner = FROM
			participation_scaled_prestige = -100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
				if = {
					limit = { is_tribal = no }
					add_character_modifier = {
						name = faction_independence_ultimatum_timer
						hidden = yes
						duration = 3650
					}
				}
				else = {
					add_character_modifier = {
						name = faction_independence_ultimatum_timer
						hidden = yes
						duration = 1825
					}
				}
			}
		}
		
		FROM = {
			prestige = 50
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			hidden_tooltip = { 
				if = { 
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		
		hidden_tooltip = {
			if = {
				limit = {
					FROM = { has_landed_title = k_anglia }
					has_global_flag = anglia_collapse_factions
				}
				FROM = { character_event = { id = 313110 days = 1 } }
			}
		}
		destroy_faction_revolt_title_effect = yes
	}

	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}
		hidden_tooltip = {
			if = {
				limit = {
					FROM = { has_landed_title = k_anglia }
					has_global_flag = anglia_collapse_factions
				}
				FROM = { character_event = { id = 313108 days = 1 } }
			}
		}

		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
}
embargo_cb = {
	name = CB_NAME_EMBARGO
	war_name = WAR_NAME_EMBARGO
	sprite = 19
	truce_days = 3650
	
	is_permanent = yes
	can_ask_to_join_war = no
	
	allowed_to_target_tributaries = no
	
	sort_priority = 2000
	
	can_use = {
		ROOT = {
			independent = yes
			NOT = { has_embargo = FROM }
			mercenary = no
		}
		FROM = {
			OR = {
				AND = {
					is_merchant_republic = yes
					any_trade_post = {
						owner = {
							OR = {
								character = ROOT
								is_liege_or_above = ROOT
							}
						}
					}
				}
				AND = {
					OR = {
						is_merchant_republic = yes
						higher_tier_than = DUKE
					}
					any_realm_lord = {
						is_patrician = yes
						any_trade_post = {
							owner = {
								OR = {
									character = ROOT
									is_liege_or_above = ROOT
								}
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			independent = yes
			NOT = { has_embargo = FROM }
		}
		FROM = {
			OR = {
				is_merchant_republic = yes
				AND = {
					higher_tier_than = DUKE
					any_realm_lord = {
						is_merchant_republic = yes
					}
				}
			}
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success = {
		ROOT = {
			embargo = FROM
			if = {
				limit = {
					NOT = { religion = FROM }
				}
				piety = 200
			}
		}
	}

	on_fail = {
		if = {
			limit = {
				NOT = {
					any_attacker = {
						NOT = { character = ROOT } 
						is_merchant_republic = yes
					}
				}
			}
			ROOT = {
				prestige = -100
			}
		}
		
		if = {
			limit = {
				any_attacker = {
					NOT = { character = ROOT } 
					is_merchant_republic = yes
				}
			}
			any_attacker = {
				limit = { 
					NOT = { character = ROOT } 
					is_merchant_republic = yes
				}
				prestige = -100
			}
		}
		
		FROM = {
			prestige = 50
		}
	}

	on_reverse_demand = {
		if = {
			limit = {
				NOT = {
					any_attacker = {
						NOT = { character = ROOT } 
						is_merchant_republic = yes
					}
				}
			}
			
			ROOT = {
				prestige = -200
				transfer_scaled_wealth = {
					to = FROM
					value = 4.0
				}
			}
		}
		
		if = {
			limit = {
				any_attacker = {
					NOT = { character = ROOT } 
					is_merchant_republic = yes
				}
			}
			any_attacker = {
				limit = { 
					NOT = { character = ROOT } 
					is_merchant_republic = yes
				}
				prestige = -200
				transfer_scaled_wealth = {
					to = FROM
					value = 4.0
				}
			}
		}
		
		FROM = {
			prestige = 100
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 50
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 50
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		modifier = {
			factor = 0
			ROOT = {
				opinion = { who = FROM value = 25 }
			}
		}
		modifier = {
			factor = 0.5
			ROOT = {
				opinion = { who = FROM value = 0 }
			}
		}		
		modifier = {
			factor = 0.5
			ROOT = {
				opinion = { who = FROM value = -25 }
			}
		}			
	}		
}
seize_trade_post = {
	name = CB_NAME_SEIZE_TRADE_POST
	war_name = WAR_NAME_SEIZE_TRADE_POST
	sprite = 18
	truce_days = 1825
	is_permanent = yes
#	check_all_titles = yes
	check_all_trade_posts = yes
	can_ask_to_join_war = no
	att_ticking_war_score_multiplier = 5.0
	def_ticking_war_score_multiplier = 5.0
	
	allow_distant = yes
	
	allowed_to_target_tributaries = no
	
	sort_priority = 1900

	can_use = {
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
			NOT = { is_liege_or_above = FROM }

			OR = {
				NOT = { same_realm = FROM }
				
				# We cannot overtly attack much weaker Patricians in the same republic
				NOT = { 
					num_of_trade_post_diff = {
						character = FROM
						value = 3
					}
				}
			}
		}
		FROM = {
			NOT = { is_liege_or_above = ROOT }
		}	
	}

	can_use_title = {
		tier = COUNT
		location = {
			port = yes
		}
		has_trade_post = yes
		trade_post_owner = {
			OR = {
				character = FROM
				is_liege_or_above = FROM
			}
		}
		holder_scope = {
			NOT = { character = FROM }
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
			NOT = { is_liege_or_above = FROM }
		}
		FROM = {
			NOT = { is_liege_or_above = ROOT }
		}
	}
	
	is_valid_title = {
		has_trade_post = yes
		trade_post_owner = {
			OR = {
				character = FROM
				is_liege_or_above = FROM
			}
		}
		holder_scope = {
			NOT = { character = FROM }
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success_title = {		
		seize_trade_post = ROOT
		
		ROOT = {
			participation_scaled_prestige = 50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_fail = {
		ROOT = {
			prestige = -50
		}
		FROM = {
			participation_scaled_prestige = 25
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 25 }
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -100
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 25
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 25
	}

	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		modifier = {
			factor = 0.25
			ROOT = {
				NOT = { same_realm = FROM }
			}
		}					
	}		
}

viking_invasion = {
	name = CB_NAME_VIKING_INVASION
	war_name = WAR_NAME_VIKING_INVASION
	sprite = 20
	truce_days = 1095
	hostile_against_others = no # Vikings share in the spoils...
	is_permanent = yes
	is_holy_war = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	apply_short_occ_mod = no # Do not apply the 'recently_conquered' modifier to Holdings
	
	sort_priority = 3000

	can_use = {
		ROOT = {
			has_opinion_modifier = { who = FROM modifier = preparing_to_invade }
			NOT = { is_liege_or_above = FROM }
		}
	}
	
	can_use_title = {
		is_valid_viking_invasion_target = FROM # Checks that FROM holds the right amount of territory in the kingdom
	}
	
	is_valid_title = {
		FROM = {
			any_realm_province = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success = {
		ROOT = {
			prestige = 500
			piety = 250
			religion_authority = {
				modifier = won_viking_invasion
			}
		}
		ROOT = {
			participation_scaled_prestige = 300
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 300 }
		}
		FROM = {
			prestige = -500
		}
	}
	
	on_success_title = {
		custom_tooltip = { 
			text = tribal_invasion_succ_tip
			hidden_tooltip = {
				FROM = {
					random_realm_province = {
						limit = {
							de_jure_liege_or_above = PREVPREV
							OR = {
								NOT = { culture = ROOT }
								NOT = { religion = ROOT }
							}
						}
						culture = ROOT
						religion = ROOT
					}
				}
				ROOT = {
					occupy_minors_of_occupied_settlements = FROM
					gain_all_occupied_titles = FROM
					vassalize_or_take_under_title_destroy_duchies = {
						title = PREV
						enemy = FROM
					}
					
					# Settle the special invasion forces
					disband_event_forces = prepared_invasion
					any_demesne_title = {
						limit = { tier = BARON }
						remove_holding_modifier = recently_conquered
						refill_holding_levy = yes
					}
				}
				
				if = {
					limit = {
						FROM = { is_liege_or_above = ROOT }
					}
					FROM = { imprison = ROOT }
				}
			}
		}
	}

	on_fail = {
		FROM = {
			prestige = 200
		}
		FROM = {
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		ROOT = {
			prestige = -300
			piety = -100
			hidden_tooltip = {
				disband_event_forces = prepared_invasion
			}
			religion_authority = {
				modifier = lost_viking_invasion
			}
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -500
			piety = -250
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
			hidden_tooltip = {
				disband_event_forces = prepared_invasion
			}
			religion_authority = {
				modifier = lost_viking_invasion
			}
		}
		FROM = {
			prestige = 300
		}
		FROM = {
			if = {
				limit = { 
					has_dlc = "Legacy of Rome"
					is_roman_emperor_trigger = yes
					OR = {
						religion_group = christian
						is_hellenic_group_religion_trigger = yes
					}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
		}
		FROM = {
			participation_scaled_prestige = 250
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 250 }
		}
	}

	attacker_ai_victory_worth = {
		factor = 200
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

pagan_subjugation = {
	name = CB_NAME_PAGAN_SUBJUGATION
	war_name = WAR_NAME_PAGAN_SUBJUGATION
	sprite = 8
	truce_days = 1095
	hostile_against_others = yes
	is_permanent = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals (or below) of selected character. Only valid if is_permanent = yes
	defender_unoccupied_warscore = yes
	
	sort_priority = 2000
	
#	prestige_cost = 100

	can_use_gui = {
		ROOT = {
			is_adult = yes
			is_incapable = no
			prestige = 750
			# NOR = {
				# culture = proto_norse
				# culture = angle
				# culture = oldsaxon
				# culture = oldfrisian
			# }
			NOT = { has_character_modifier = vassalize_timer }
		}
	}

	can_use = {
		ROOT = {
			government = high_tribal_government
			culture_group = germanic
			independent = yes
			is_romanized_germanic_trigger = no
			NOT = { same_realm = FROM }
			NOT = { is_liege_or_above = FROM }
			has_horde_culture = no # Should use tribal invasion instead
			capital_scope = {
				is_in_british_isles_trigger = no
			}
			# Not if can use the Empire-tier version
			NAND = {
				has_ambition = obj_become_high_king
				culture = dane
				capital_scope = {
					empire = {
						OR = {
							title = e_denmark
							title = e_norway
							title = e_sweden
							title = e_geatland
						}
					}
				}
			}
		}
		FROM = {
			is_tribal = yes
			culture_group = ROOT
			NOT = {
				any_war = {
					AND = {
						defender = { character = FROM }
						OR = {
							using_cb = pagan_subjugation
							using_cb = pagan_subjugation_high_kingdom
						}
					}
				}
			}
		}
	}
	
	can_use_title = {
		ROOT = {
			capital_scope = {
				kingdom = {
					title = PREVPREVPREV
				}
			}
		}

		FROM = {
			any_realm_title = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}
	
	is_valid_title = {
		FROM = {
			any_realm_title = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		ROOT = {
			prestige = -200
			add_character_modifier = {
				name = vassalize_timer 
				duration = 1095
			}
		}
	}

	on_success = {
		ROOT = {
			if = {
				limit = { religion_group = pagan_group }
				piety = 50
			}
		}
		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		FROM = {
			if = {
				limit = { religion_group = pagan_group }
				piety = -100
			}
			prestige = -100
		}
	}
	
	on_success_title = {
		custom_tooltip = {  
			text = pagan_subjugation_succ_tip
		}
		ROOT = {
			hidden_tooltip = {
				vassalize_or_take_under_title = {
					title = PREV
					enemy = FROM
				}
			}
		}
	}

	on_fail = {
		FROM = {
			if = {
				limit = { religion_group = pagan_group }
				piety = 50
			}
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		ROOT = {
			if = {
				limit = { religion_group = pagan_group }
				piety = -100
			}
		}
	}
	
	on_reverse_demand = {
		ROOT = {
			if = {
				limit = { religion_group = pagan_group }
				piety = -200
			}
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
		}
		FROM = {
			if = {
				limit = { religion_group = pagan_group }
				piety = 50
			}
		}
		FROM = {
			if = {
				limit = { 
					has_dlc = "Legacy of Rome"
					is_roman_emperor_trigger = yes
					OR = {
						religion_group = christian
						is_hellenic_group_religion_trigger = yes
					}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

peasant_revolt = {
	name = CB_NAME_PEASANT_CONQUEST
	war_name = WAR_NAME_PEASANT_CONQUEST
	sprite = 16
	truce_days = 365
	hostile_against_others = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	is_independence = yes
	
	can_use = {
		ROOT = {
			primary_title = { temporary = yes } # Revolter or adventurer trigger
			war = no
			NOT = { is_liege_or_above = FROM }
		}
	}

	can_use_title = {
		tier = count
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success_title = {
		ROOT = { britannia_flag_proper_post_revolt_government_effect = yes }
		usurp_title_plus_barony_if_unlanded = ROOT
		ROOT = { 
			set_defacto_liege = ROOT 
			character_event = { id = 319005 days = 1 }
		}
		FROM = {
			prestige = -100
		}
	}

	on_fail_title = {
		FROM = {
			prestige = 10
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
			}
		}
		ROOT = { imprison = FROM }
	}

	on_reverse_demand = {
		FROM = {
			prestige = 20
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
				add_character_modifier = { 
					name = crushed_revolt
					days = 1825
				}
			}
		}
		ROOT = { imprison = FROM }
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}
heretic_revolt = {
	name = CB_NAME_HERETIC_UPRISING
	war_name = WAR_NAME_HERETIC_UPRISING
	sprite = 7
	truce_days = 365
	hostile_against_others = yes
	can_ask_to_join_war = no
	check_de_jure_tier = DUKE
	
	can_use = {
		ROOT = { has_character_flag = heretic_revolter }
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success = {
		ROOT = {
			britannia_flag_proper_post_revolt_government_effect = yes
			prestige = 200
			piety = 100
			occupy_minors_of_occupied_settlements = FROM
			gain_all_occupied_titles = FROM
			#clr_character_flag = heretic_revolter
			character_event = { id = 312996 days = 1 }
			character_event = { id = 319005 days = 1 }
		}
		
		FROM = {
			prestige = -500
			piety = -500
			religion_authority = {
				modifier = lost_heretic_revolt
			}		
		}
	}

	on_success_title = {
		
		ROOT = {
			vassalize_or_take_under_title = {
				title = PREV
				enemy = FROM
				same_religion = yes # Only vassalize rulers of my religion
				is_religious = yes
				type = holy_war
			}
		}
		if = {
			limit = {
				controls_religion = no
				holder_scope = {
					OR = {
						character = FROM
						is_liege_or_above = FROM
					}
				}
			}
			usurp_title = { target = ROOT type = holy_war }
		}
		if = {
			limit = {
				has_holder = no
			}
			usurp_title = { target = ROOT type = holy_war }
		}
	}
	
	on_fail = {
		ROOT = {
			imprison = FROM 
			clr_character_flag = heretic_revolter
		}
		FROM = {
			prestige = 50
			piety = 100
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
			}
			religion_authority = {
				modifier = won_heretic_revolt
			}
		}
	}

	on_reverse_demand = {
		ROOT = {
			imprison = FROM 
			clr_character_flag = heretic_revolter
		}
		FROM = {
			prestige = 100
			piety = 200
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
				add_character_modifier = { 
					name = crushed_revolt
					days = 1825
				}
			}
			religion_authority = {
				modifier = won_heretic_revolt
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = 100
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 150
	}
}
# The CB used by "Religious revolter" characters
religious_revolt = {
	name = CB_NAME_HERETIC_UPRISING
	war_name = WAR_NAME_HERETIC_UPRISING
	sprite = 7
	truce_days = 365
	hostile_against_others = yes
	attacker_can_call_allies = no
	defender_can_call_allies = no
	can_ask_to_join_war = no
	check_de_jure_tier = DUKE
	
	can_use = {
		ROOT = { has_character_flag = religious_revolter }
	}
	
	is_valid = {
		FROM = {
			NOT = { religion = ROOT }
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}
 
	on_success = {
		ROOT = {
			britannia_flag_proper_post_revolt_government_effect = yes
			prestige = 200
			piety = 100
			occupy_minors_of_occupied_settlements = FROM
			gain_all_occupied_titles = FROM
			#clr_character_flag = religious_revolter
			character_event = { id = 312996 days = 1 }
			character_event = { id = 319005 days = 1 }
		}
		
		FROM = {
			prestige = -500
			piety = -500
			religion_authority = {
				modifier = lost_religious_revolt
			}		
		}
	}

	on_success_title = {		
		ROOT = {
			vassalize_or_take_under_title = {
				title = PREV
				enemy = FROM
				same_religion = yes # Only vassalize rulers of my religion
				is_religious = yes
				type = holy_war
			}
		}
		if = {
			limit = {
				controls_religion = no
				holder_scope = {
					OR = {
						character = FROM
						is_liege_or_above = FROM
					}
				}
			}
			usurp_title = { target = ROOT type = holy_war }
		}
		if = {
			limit = {
				has_holder = no
			}
			usurp_title = { target = ROOT type = holy_war }
		}
	}
	
	on_fail = {
		ROOT = {
			imprison = FROM
			clr_character_flag = religious_revolter
			hidden_tooltip = {
				add_character_modifier = { 
					name = broken_spirit
					days = -1
				}
			}
		}
		FROM = {
			prestige = 50
			piety = 100
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
			}
			religion_authority = {
				modifier = won_religious_revolt
			}
		}
	}

	on_reverse_demand = {
		ROOT = {
			imprison = FROM
			clr_character_flag = religious_revolter
			hidden_tooltip = {
				add_character_modifier = { 
					name = broken_spirit
					days = -1
				}
			}
		}
		FROM = {
			prestige = 100
			piety = 200
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
				add_character_modifier = { 
					name = crushed_revolt
					days = 1825
				}
			}
			religion_authority = {
				modifier = won_religious_revolt
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = 100
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 150
	}
}
liberation_revolt = {
	name = CB_NAME_LIBERATION_REVOLT
	war_name = WAR_NAME_LIBERATION_REVOLT
	sprite = 16
	truce_days = 365
	hostile_against_others = yes
	check_de_jure_tier = KING # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	press_claim = yes
	can_ask_to_join_war = no
	is_independence = yes
	
	can_use = {
		ROOT = { has_character_flag = nationalist_rebel }
	}

	can_use_title = {
		tier = king
		OR = {
			has_holder = no
			AND = {			# Anglo-Saxon liberation revolt - allowed to revolt to another Anglo-Saxon kingdom, or force the current king out if he is FROM
				empire = { title = e_aengland }
				holder_scope = { 
					OR = {
						is_ingvaeonic_culture_trigger = yes 
						character = FROM
						top_liege = { character = FROM }
					}
				}
			}
		}
	}

	is_valid_title = {
		OR = {
			has_holder = no
			AND = {			# Anglo-Saxon liberation revolt - allowed to revolt to another Anglo-Saxon kingdom, or force the current king out if he is FROM
				empire = { title = e_aengland }
				holder_scope = { 
					OR = {
						is_ingvaeonic_culture_trigger = yes 
						character = FROM
						top_liege = { character = FROM }
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}
	
	on_success = {
	}

	on_success_title = {
		ROOT = {
			prestige = 1000
			give_nickname = nick_the_liberator
		}
		FROM = {
			prestige = -500
		}
		if = {
			limit = {
				OR = {
					has_holder = no 
					holder_scope = {
						character = FROM
						top_liege = { character = FROM }
					}
				}
			}
			ROOT = {
				britannia_flag_proper_post_revolt_government_effect = yes
				occupy_minors_of_occupied_settlements = FROM
				gain_all_occupied_titles = FROM
				character_event = { id = 319005 days = 1 }
			}
			custom_tooltip = {  
				text = liberation_revolt_succ_tip
				hidden_tooltip = {
					ROOT = {
						vassalize_or_take_under_title = {
							title = PREV
							enemy = FROM
						}
						if = {
							limit = {
								num_of_count_titles = 5
								PREV = { 
									OR = {
										has_holder = no 
										holder_scope = {
											character = FROM
										}
									}
								}
							}
							usurp_title = PREV
						}
						reverse_opinion = {
							modifier = opinion_usurped_title
							who = FROM
						}
						PREV = { grant_title = ROOT }
					}
				}
			}
		}
		else = {			# Anglo-Saxon liberation revolt
			custom_tooltip = {  
				text = anglosaxon_liberation_revolt_succ_tip
				hidden_tooltip = {
					ROOT = {				# ROOT takes over the kingdom first and then all vassals are transferred to the holder, so that ROOT gets any usurped titles
						create_title = {
							tier = KING
							landless = yes
							temporary = no
							custom_created = yes
							holder = ROOT
							name = "LIBERATED_KINGDOM"
							base_title = PREV
						}
						vassalize_or_take_under_title = {
							title = PREV
							enemy = FROM
						}
					}
					holder_scope = {
						ROOT = {
							any_vassal = {
								limit = { primary_title = { defacto_liege_title = { tier = KING } } }
								set_defacto_liege = PREVPREV
							}
							any_demesne_title = {
								limit = { tier = KING }
								activate_title = { title = THIS status = no }
								destroy_landed_title = THIS
							}
							set_defacto_liege = PREV
							opinion = {
								modifier = opinion_fought_for_claimant
								who = PREV
								years = 20
							}
						}
					}
				}
			}
		}
	}

	on_fail_title = {
		FROM = {
			prestige = 100
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
			}
		}
		ROOT = {
			imprison = FROM 
			clr_character_flag = nationalist_rebel
		}
	}

	on_reverse_demand = {
		FROM = {
			prestige = 200
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
				add_character_modifier = { 
					name = crushed_revolt
					days = 1825
				}
			}
		}
		ROOT = {
			imprison = FROM 
			clr_character_flag = nationalist_rebel
		}
	}
	

	attacker_ai_victory_worth = {
		factor = 100
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

duchy_adventure = {
	name = CB_NAME_DUCHY_ADVENTURE
	war_name = WAR_DUCHY_ADVENTURE
	sprite = 9
	truce_days = 3650
	hostile_against_others = yes
	check_de_jure_tier = DUKE # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character

	can_use = {
		ROOT = { has_character_flag = duchy_adventurer }
	}

	is_valid = {
		always = yes
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}
	
	on_success = {
		ROOT = { 
			prestige = 250
			hidden_tooltip = {
				clr_character_flag = duchy_adventurer
				give_nickname = nick_the_conqueror
			}
		}
		FROM = {
			prestige = -250 
		}
	}

	on_success_title = {
		custom_tooltip = {
			text = other_invasion_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title = {
						title = PREV
						enemy = FROM
						type = host
					}
				}
			}
		}
	}

	on_fail = {
		FROM = {
			prestige = 100
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
			}
		}
		ROOT = {
			clear_wealth = yes
			imprison = FROM 
			hidden_tooltip = {
				disband_event_forces = yes
				clr_character_flag = duchy_adventurer
			}
		}
	
		ROOT = { prestige = -100 }
	}

	on_reverse_demand = {
		ROOT = {
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		
		FROM = {
			prestige = 200
		}
		
		ROOT = {
			clear_wealth = yes
			imprison = FROM
			prestige = -200
			hidden_tooltip = {
				disband_event_forces = yes
				clr_character_flag = duchy_adventurer
			}
		}
	}
	
	on_attacker_leader_death = {
		ROOT = {
			hidden_tooltip = {
				disband_event_forces = yes
				clr_character_flag = duchy_adventurer
			}
		}
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

kingdom_adventure = { # Used mainly for Muslims adventuring into India
	name = CB_NAME_DUCHY_ADVENTURE
	war_name = WAR_DUCHY_ADVENTURE
	sprite = 9
	truce_days = 3650
	hostile_against_others = yes
	check_de_jure_tier = KING # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character

	can_use = {
		ROOT = {
			OR = {
				has_character_flag = duchy_adventurer
				has_character_flag = rum_creator
			}
		}
	}

	is_valid = {
		always = yes
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}
	
	on_success = {
		ROOT = { 
			prestige = 500
			piety = 250
			hidden_tooltip = {
				clr_character_flag = duchy_adventurer
				clr_character_flag = do_not_disturb
				if = {
					limit = {
						has_nickname = no
					}
					FROM = {
						save_event_target_as = nickname_target
					}
					ROOT = { 
						save_event_target_as = nickname_receiver
					}
					if = {
						limit = {
							NOT = {
								has_character_flag = is_child_of_destiny
							}
						}
						random_list = {
							5 = { give_nickname = nick_the_victorious }
							5 = { give_nickname = nick_the_conqueror }
							5 = { give_nickname = nick_the_dragon }
							10 = { give_nickname = nick_the_rel_group }
							10 = { give_nickname = nick_the_tiger }
							10 = { give_nickname = nick_the_world_burner }
							10 = { 
								give_nickname = nick_the_scourge_of_god
								modifier = {
									factor = 0
									event_target:nickname_target = { religion = ROOT }
								}
							}
						}
					}
				}
			}
		}
		FROM = {
			prestige = -500
			piety = -250			
		}
	}

	on_success_title = {
		custom_tooltip = {
			text = other_invasion_succ_tip
			hidden_tooltip = {
			
				if = { # Special stuff for player Child of Destiny (AI Children do not have this flag)
					limit = {
						ROOT = { has_character_flag = child_of_destiny_outwards_focus }
					}
					FROM = { # Ensure that the Child of Destiny always gets one County in the targeted Kingdom (mainly useful when testing with yesmen, but can also happen in rare occurences where the target is imprisoned)
						random_realm_title = {
							limit = {
								tier = COUNT
								de_jure_liege_or_above = PREVPREV
							}
							usurp_title = { target = ROOT type = host }
						}
					}
					ROOT = {
						liege = { save_event_target_as = old_liege_target}
						if = { # Abandon all old titles if you were a vassal
							limit = {
								independent = no
							}
							any_demesne_title = {
								limit = {
									NOR = {
										title = PREVPREV
										de_jure_liege_or_above = PREVPREV
									}
								}
								grant_title = event_target:old_liege_target
							}
							any_vassal = {
								limit = {
									capital_scope = {
										NOR = {
											title = PREVPREVPREV
											de_jure_liege_or_above = PREVPREVPREV
										}
									}
								}
								set_defacto_liege = event_target:old_liege_target
							}
						}
					}
				}
				
				FROM = { # The adventurer takes ANY demesne title, including the targeted Kingdom, within the area of the targeted kingdom
					any_demesne_title = {
						limit = {
							OR = {
								title = PREVPREV
								de_jure_liege_or_above = PREVPREV
							}
							NOT = { ROOT = { has_character_flag = rum_creator } }
						}
						usurp_title = { target = ROOT type = host }
					}
				}
				
				if = { # Claim the targeted Kingdom if it isn't held by anyone
					limit = {
						has_holder = no
					}
					usurp_title = { target = ROOT type = host }
				}
				
				if = { # Create a Kingdom if the adventurer does not have one by this point
					limit = {
						ROOT = {
							NOR = {
								any_demesne_title = {
									tier = KING
								}
								has_character_flag = rum_creator
							}
						}
					}
					if = {
						limit = {
							ROOT = {
								NOT = {
									has_character_flag = is_child_of_destiny
								}
							}
						}
						ROOT = {
							create_title = {
								tier = KING
								landless = no
								temporary = no
								custom_created = yes
								culture = ROOT
								holder = ROOT
								name = "INDIAN_MUSLIM_KINGDOM"
								base_title = PREV
								copy_title_laws = yes
							}
						}
					}
					else = {
						ROOT = {
							save_event_target_as = target_name
							create_title = {
								tier = KING
								landless = no
								temporary = no
								custom_created = yes
								culture = ROOT
								holder = ROOT
								name = "DESTINY_KINGDOM"
								base_title = PREV
								copy_title_laws = yes
							}
							capital_scope = {
								county = {
									save_event_target_as = coa_target
								}
							}
							primary_title = {
								set_coa = event_target:coa_target
							}
						}
					}
				}
				
				ROOT = { # Preserve Vassals under the targeted kingdom
					vassalize_or_take_under_title = { # Take all vassals held by the target under the title
						title = PREV
						enemy = FROM
						type = host
					}
					set_defacto_liege = ROOT # Always go Independent
				}
				
				hidden_effect = {
					if = {
						limit = {
							ROOT = {
								has_character_flag = is_child_of_destiny
								NOT = {
									religion_group = muslim
								}
							}
						}
						ROOT = {
							any_demesne_title = {
								limit = {
									higher_tier_than = COUNT
								}
								add_law = succ_primogeniture
							}
						}
					}
				}
			}
		}
		
		ROOT = {
			hidden_tooltip = {
				if = {
					limit = {
						has_character_flag = is_child_of_destiny
					}
					character_event = { id = HF.303 days = 3 }
				}
				else = {
					capital_scope = {
						reverse_culture = ROOT
					}
					any_child = {
						limit = {
							is_ruler = no
							ai = yes
							#liege = { character = ROOT }
						}
						culture = ROOT
					}
					any_courtier = {
						limit = {
							is_ruler = no
							ai = yes
						}
						culture = ROOT
					}
				}
				
				if = { # Give bloodline to Child of Destiny
					limit = {
						has_character_flag = is_child_of_destiny
						higher_real_tier_than = DUKE
						NOT = {
							any_owned_bloodline = {
								has_bloodline_flag = created_bloodline
							}
						}
					}
					character_event = { id = HF.304 days = 14 }
				}
			}
		}
	}
	
	on_invalidation = {
		ROOT = {
			clr_character_flag = child_of_destiny_made_player_choice
			clr_character_flag = child_of_destiny_adventure
		}
	}

	on_fail = {
		FROM = {
			prestige = 100
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
			}
		}
		ROOT = {
			clear_wealth = yes
			imprison = FROM 
			hidden_tooltip = {
				disband_event_forces = yes
				clr_character_flag = duchy_adventurer
				if = {
					limit = {
						has_character_flag = is_child_of_destiny
					}
					remove_trait = disinherited
				}
			}
		}
	
		ROOT = { prestige = -100 }
		
		if = {
			limit = {
				ROOT = {
					has_character_flag = is_child_of_destiny
				}
			}
			set_global_flag = child_of_destiny_invasion_fail@ROOT
		}
	}

	on_reverse_demand = {
		ROOT = {
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		
		FROM = {
			prestige = 200
		}
		
		ROOT = {
			clear_wealth = yes
			imprison = FROM
			prestige = -200
			hidden_tooltip = {
				disband_event_forces = yes
				clr_character_flag = duchy_adventurer
				if = {
					limit = {
						has_character_flag = is_child_of_destiny
					}
					remove_trait = disinherited
				}
			}
		}
		
		if = {
			limit = {
				ROOT = {
					has_character_flag = is_child_of_destiny
				}
			}
			set_global_flag = child_of_destiny_invasion_reverse_demand@ROOT
		}
	}
	
	on_attacker_leader_death = {
		ROOT = {
			hidden_tooltip = {
				disband_event_forces = yes
				clr_character_flag = duchy_adventurer
			}
		}
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

# Caliphs can subjugate people of their own religion
caliphal_subjugation = {
	name = CB_NAME_PAGAN_SUBJUGATION
	war_name = WAR_NAME_PAGAN_SUBJUGATION
	sprite = 8
	truce_days = 365
	hostile_against_others = yes
	is_permanent = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	allowed_to_target_tributaries = no
	
	sort_priority = 1000
	
	can_use_gui = {
		ROOT = {
			piety = 200
		}
	}
	
	on_add = {
		ROOT = { piety = -200 }
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	can_use = {
		ROOT = {
			# OR = {
				# ai = yes
				# multiplayer = no
				# NOT = {
					# has_game_rule = {
						# name = multiplayer_invasions
						# value = off
					# }
				# }
			# }
			religion_group = muslim
			OR = {
				has_landed_title = d_sunni
				has_landed_title = d_shiite
				has_landed_title = d_ibadi
				has_landed_title = d_kharijite
				#has_landed_title = d_yazidi
				#has_landed_title = d_hurufi
			}
			is_nomadic = no
			OR = {
				has_horde_culture = no # Should use tribal invasion instead
				has_dlc = "Horse Lords"
			}
			NOT = { has_character_modifier = launched_subjugation }
			mercenary = no
		}
		FROM = {
			religion = ROOT
			NOT = { is_offmap_governor = yes }
		}
	}
	
	can_use_title = {
		FROM = {
			any_realm_province = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}
	
	is_valid_title = {
		FROM = {
			any_realm_province = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}
	
	on_add_title = {
		ROOT = {
			add_character_modifier = { 
				name = launched_subjugation
				days = 3650
				hidden = yes
			}
		}
	}

	on_success = {
		ROOT = {
			prestige = 100
			decadence = -5
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		FROM = {
			prestige = -200
		}
	}
	
	on_success_title = {
		custom_tooltip = {
			text = pagan_subjugation_tip
			hidden_tooltip = {
				ROOT = {
					subjugate_or_take_under_title = { # If the target only has territory within the kingdom, he is simply vassalized
						title = PREV
						enemy = FROM
					}
				}
			}
		}
	}

	on_fail = {
		FROM = {
			prestige = 50
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		ROOT = {
			prestige = -100
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
		}
		FROM = {
			prestige = 100
			if = {
				limit = { 
					has_dlc = "Legacy of Rome"
					is_roman_emperor_trigger = yes
					OR = {
						religion_group = christian
						is_hellenic_group_religion_trigger = yes
					}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	ai_will_do = { 
		factor = 1
		
		modifier = {
			factor = 0.9 # Prefer using CB's without on_add costs
		}
	}
}

muslim_county_conquest = {
	name = CB_NAME_COUNTY_CONQUEST
	war_name = WAR_NAME_COUNTY_CONQUEST
	sprite = 16
	truce_days = 1825
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	
	sort_priority = 700
	
	can_use_gui = {
		ROOT = {
			piety = 50
		}
	}
	
	on_add = {
		ROOT = { piety = -50 }
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}
	
	can_use = {
		ROOT = {
			NOT = { is_liege_or_above = FROM }
			mercenary = no
			is_nomadic = no # Use the 'pagan_county_conquest' CB instead
		}
	}

	can_use_title = {
		tier = count
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
				NOT = { same_realm = ROOT }
			}
		}
		
		ROOT = {
			religion_group = muslim
		}

		NOT = {
			OR = {
				ROOT = {
					has_landed_title = PREV
				}
				holder_scope = {
					is_liege_or_above = ROOT
				}
			}
		}
		
		location = {
			any_neighbor_province = {
				owner = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
			}
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	on_success_title = {
		if = {
			limit = {
				holder_scope = {
					tier = count
					NOT = { num_of_count_titles = 2 }
					lower_tier_than = ROOT
				}
			}

			holder_scope = {
				set_defacto_liege = ROOT
			}
		}

		if = {
			limit = {
				holder_scope = {
					OR = {
						higher_tier_than = count
						num_of_count_titles = 2
						NOT = { lower_tier_than = ROOT }
					}
				}
			}

			usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
			any_de_jure_vassal_title = { # take all baronies under the one we're fighting for
				limit = {
					has_holder = yes
					NOT = {
						de_facto_liege = PREV
					}
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
				}

				usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
			}
		}
		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_fail_title = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	ai_will_do = { 
		factor = 1
		
		modifier = {
			factor = 0.9 # Prefer using CB's without on_add costs
		}
		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_nomadic = no
				NOT = {
					is_tribal = yes
				}
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			FROM = {
				is_nomadic = yes
			}
			ROOT = {
				is_tribal = yes
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = tribal
						}
					}
				}
			}
		}
	}
}

### DE JURE CLAIMS CBs ###
dejure_county_claim = {
	name = CB_NAME_DEJURECLAIM
	war_name = WAR_NAME_DEJURECLAIM
	sprite = 16
	truce_days = 1095
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	
	allowed_to_target_tributaries = no

	infamy_modifier = 0.5
	
	sort_priority = 700
	
	can_use_gui = {
		ROOT = {
			prestige = 200
		}
	}
	
	can_use = {
		ROOT = { 
			NOT = { government = tribal_government } 
			is_from_and_this_top_liege_roman_province_trigger = no
		}
	}

	can_use_title = {
		tier = count
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		
		OR = {
			kingdom = {
				holder = ROOT
			}
			empire = {
				OR = {
					NOT = { title = e_britannia }
					has_global_flag = britannia_empowered_high_council
				}
				OR = {
					NOT = { title = e_aengland }
					has_global_flag = aengland_united
				}
				holder = ROOT
			}
			dejure_liege_title = {		# Duchy only
				holder = ROOT
			}
		}
	
		NOT = {
			OR = {
				ROOT = {
					has_landed_title = PREV
				}
				holder_scope = {
					is_liege_or_above = ROOT
				}
			}
		}
		
		OR = {
			ROOT = { same_realm = FROM }
			location = {
				any_neighbor_province = {
					owner = {
						OR = {
							character = ROOT
							is_liege_or_above = ROOT
						}
					}
				}
			}
			location = { 
				is_isolated_island_trigger = yes 
				any_neighbor_province = {
					is_land = no
					any_neighbor_province = {
						owner = {
							OR = {
								character = ROOT
								is_liege_or_above = ROOT
							}
						}
					}
				}
			}
		}
	
		# Vasconia protection against Germanics
		NAND = { 
			NOT = { year = 580 }
			OR = {
				ROOT = { culture_group = germanic }
				ROOT = { top_liege = { culture_group = germanic } }
			}
			FROM = { culture = vasconian }
			culture = vasconian
			location = {
				region = world_gaul_aquitania_tertia
			}
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success_title = {
		if = {
			limit = {
				holder_scope = {
					tier = count
					NOT = {
						num_of_count_titles = 2
					}
				}
			}

			holder_scope = {
				set_defacto_liege = ROOT
			}
		}

		if = {
			limit = {
				holder_scope = {
					OR = {
						higher_tier_than = count
						num_of_count_titles = 2
					}
				}
			}

			usurp_title_plus_barony_if_unlanded = ROOT
			any_de_jure_vassal_title = { # take all baronies under the one we're fighting for
				limit = {
					has_holder = yes
					NOT = {
						de_facto_liege = PREV
					}
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
				}

				usurp_title_plus_barony_if_unlanded = ROOT
			}
		}
		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = {
				character = ROOT
				NOT = { religion_group = christian }
			}
			piety = 50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_fail_title = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 0.5
		modifier = {
			factor = 1.5
			FROM = {
				culture = oldirish
			}
			ROOT = {
				culture = oldirish
			}
		}
		modifier = {
			factor = 1.5
			FROM = {
				culture_group = germanic
			}
		}
		modifier = {
			factor = 1.5
			FROM = {
				culture = roman
			}
		}
		modifier = {
			factor = 0.1
			ROOT = {
				has_landed_title = e_britannia
			}
			FROM = {
				culture_group = ROOT
			}
		}
		modifier = {
			factor = 0.1
			ROOT = {
				has_landed_title = e_aengland
			}
			FROM = {
				culture_group = ROOT
			}
		}
		modifier = {
			factor = 0.3
			FROM = { 
				lower_tier_than = ROOT 
				culture_group = ROOT
			}
		}
		modifier = {
			factor = 0
			ROOT = { culture = oldfrankish }
			NOT = { year = 470 }
			location = { region = world_hamaland_salland }
		}
		modifier = {
			factor = 0 # AIs will not take the last counties off their liege's direct vassals
			ROOT = {
				same_liege = FROM
			}
			FROM = {
				NOT = {
					any_demesne_title = {
						tier = count
						NOT = { title = PREVPREV }
					}
				}
			}
		}
		# Stop AI from using county-level cbs if it can use duchy invasion instead
		modifier = {
			factor = 0
			dejure_liege_title = {
				ROOT = { 
					OR = {
						can_use_cb = {
							target = FROM
							casus_belli = duchy_invasion
							thirdparty_title = PREV
							only_check_triggers = yes
						}
						can_use_cb = {
							target = FROM
							casus_belli = duchy_invasion_event
							thirdparty_title = PREV
							only_check_triggers = yes
						}
					}
				}
			}
		}
	}
}
dejure_barony_claim = {
	name = CB_NAME_DEJUREBARONYCLAIM
	war_name = WAR_NAME_DEJUREBARONYCLAIM
	sprite = 16
	truce_days = 1095
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	
	allowed_to_target_tributaries = no

	infamy_modifier = 0.5
	
	sort_priority = 650
	
	can_use = {
	}

	can_use_title = {
		tier = baron
		dejure_liege_title = {
			AND = {
				has_holder = yes
				ROOT = {
					has_landed_title = PREV
				}
			}
		}

		NOT = {
			OR = {
				ROOT = {
					has_landed_title = PREV
				}
				holder_scope = {
					is_liege_or_above = ROOT
				}
			}
		}

		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}

		NOT = {
			holder_scope = {
				liege = {
					ROOT = {
						liege = {
							character = PREVPREV
						}
					}
				}
			}
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success_title = {
		usurp_title_plus_barony_if_unlanded = ROOT
		ROOT = {
			participation_scaled_prestige = 75
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 75 }
		}
	}

	on_fail_title = {
		ROOT = {
			prestige = -50
		}
		FROM = {
			participation_scaled_prestige = 25
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 25 }
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -100
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
	
	ai_will_do = { 
		factor = 100
	}
}
other_dejure_barony_claim = {
	name = CB_NAME_DEJUREBARONYCLAIM
	war_name = WAR_NAME_OTHER_DEJUREBARONYCLAIM
	sprite = 16
	truce_days = 1095
	hostile_against_others = yes
	is_permanent = yes
	other_de_jure_claim = yes # Optimization for de jure claims of vassals
	press_claim = yes
	can_ask_to_join_war = no

	allowed_to_target_tributaries = no

	infamy_modifier = 0.3
	
	sort_priority = 650
	
	can_use = {
		NOT = {
			ROOT = {
				character = PREV
			}
		}
	}

	can_use_title = {
		tier = baron

		dejure_liege_title = {
			AND = {
				has_holder = yes
				ROOT = {
					has_landed_title = PREV
				}
			}
		}

		NOT = {
			OR = {
				ROOT = {
					has_landed_title = PREV
				}
				holder_scope = {
					is_liege_or_above = ROOT
				}
			}
		}

		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}

		NOT = {
			holder_scope = {
				liege = {
					ROOT = {
						liege = {
							character = PREVPREV
						}
					}
				}
			}
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success = {
		ROOT = {
			opinion = {
				modifier = pressed_my_claim 
				who = PREV
			}
		}
		ROOT = {
			participation_scaled_prestige = 50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_success_title = {
		usurp_title_plus_barony_if_unlanded = ROOT
	}

	on_fail = {
		prestige = -50
		ROOT = {
			prestige = -50
		}
		FROM = {
			participation_scaled_prestige = 25
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 25 }
		}
	}

	on_reverse_demand = {
		prestige = -50
		transfer_scaled_wealth = {
			to = FROM
			value = 4.0
		}
		ROOT = {
			prestige = -50
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
	
	ai_will_do = { 
		factor = 100
	}
}
other_dejure_county_claim = {
	name = CB_NAME_DEJURECLAIM
	war_name = WAR_NAME_OTHER_DEJURECLAIM
	sprite = 16
	truce_days = 1095
	hostile_against_others = yes
	is_permanent = yes
	other_de_jure_claim = yes # Optimization for de jure claims of vassals
	press_claim = yes
	can_ask_to_join_war = no
	
	allowed_to_target_tributaries = no
	
	sort_priority = 700
	
	can_use_gui = {
		ROOT = {
			prestige = 200
		}
	}

	can_use = {
		NOT = {
			ROOT = {
				character = PREV
			}
		}
		ROOT = { NOT = { government = tribal_government } }
		NOT = { government = tribal_government }
		ROOT = { is_from_and_this_top_liege_roman_province_trigger = no }
	}

	can_use_title = {
		tier = count
		dejure_liege_title = {
			AND = {
				has_holder = yes
				ROOT = {
					has_landed_title = PREV
				}
			}
		}

		NOT = {
			OR = {
				ROOT = {
					has_landed_title = PREV
				}
				holder_scope = {
					is_liege_or_above = ROOT
				}
			}
		}

		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		
		# Vasconia protection against Germanics
		NAND = { 
			NOT = { year = 580 }
			OR = {
				ROOT = { culture_group = germanic }
				ROOT = { top_liege = { culture_group = germanic } }
			}
			FROM = { culture = vasconian }
			culture = vasconian
			location = {
				region = world_gaul_aquitania_tertia
			}
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	on_success = {
		ROOT = {
			opinion = {
				modifier = pressed_my_claim 
				who = PREV
			}
			show_scope_change = no
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_success_title = {
		if = {
			limit = {
				holder_scope = {
					tier = count
					NOT = {
						num_of_count_titles = 2
					}
				}
			}

			holder_scope = {
				show_scope_change = no
				set_defacto_liege = ROOT
			}
		}

		if = {
			limit = {
				holder_scope = {
					OR = {
						higher_tier_than = count
						num_of_count_titles = 2
					}
				}
			}
			show_scope_change = no
			usurp_title_plus_barony_if_unlanded = ROOT
			any_de_jure_vassal_title = { # take all baronies under the one we're fighting for
				limit = {
					has_holder = yes
					NOT = {
						de_facto_liege = PREV
					}
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
				}
				show_scope_change = no

				usurp_title_plus_barony_if_unlanded = ROOT
			}
		}
	}

	on_fail = {
		prestige = -50
		ROOT = {
			show_scope_change = no
			prestige = -100
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		prestige = -100
		transfer_scaled_wealth = {
			to = FROM
			value = 4.0
		}
		ROOT = {
			show_scope_change = no
			prestige = -200
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 0.5
		# modifier = {
			# factor = 0
			# ROOT = {
				# has_landed_title = e_britannia
			# }
			# FROM = {
				# culture_group = ROOT
			# }
		# }
		modifier = {
			factor = 0.1
			ROOT = {
				has_landed_title = e_aengland
			}
			FROM = {
				culture_group = ROOT
			}
		}
		modifier = {
			factor = 0
			ROOT = { culture = oldfrankish }
			NOT = { year = 490 }
			location = { region = world_hamaland_salland }
		}	
	}
}

# 53: Decadence Usurption
cb_decadence_usurption = {
	name = CB_NAME_DECADENCE_USURPTION
	war_name = WAR_NAME_DECADENCE_USURPTION
	sprite = 11
	truce_days = 3650
	is_permanent = yes
	allowed_to_target_tributaries = no
	
	can_use = {
		ROOT = { 
			religion_group = muslim
		}
	
		FROM = {
			religion_group = muslim
			trait = decadent
			dynasty = ROOT
			
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = { 
					ROOT = { 
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
		
		ROOT = {
			mercenary = no
		}
	}
	
	is_valid = {
		FROM = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = { 
					ROOT = { 
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}
	
	on_success = {
		ROOT = {
			participation_scaled_piety = 500
			participation_scaled_prestige = 250
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { 
				participation_scaled_piety = 500
				participation_scaled_prestige = 250
			}
		}
		FROM = {
			prisoner = ROOT
		}
	}
	
	on_success_title = {
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
	}

	on_fail = {
		ROOT = { 
			piety = -250
			prestige = -125
		}
		FROM = { 
			piety = 100
			prestige = 50
		}
	}

	on_reverse_demand = {
		ROOT = {
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
			piety = -500
			prestige = -250
		}
		
		FROM = { 
			piety = 500
			prestige = 250
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 54
rivalry_cb = {
	name = CB_NAME_RIVALRY
	war_name = WAR_NAME_RIVALRY
	sprite = 7
	truce_days = 1095
	is_permanent = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	defender_unoccupied_warscore = yes
	
	sort_priority = 900
	
	can_use = {
		ROOT = {
			is_rival = FROM
		}
		FROM = {
			NOT = {
				has_opinion_modifier = {
					who = ROOT
					modifier = opinion_humiliated_rival
				}
			}
		}
	}
	
	is_valid = {
		ROOT = {
			is_rival = FROM
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}
	
	on_success = {
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { 
				participation_scaled_prestige = 250
			}
		}
		
		ROOT = {
			participation_scaled_prestige = 250
			if = {
				limit = {
					ai = no
					FROM = {
						any_sibling = {
							character = ROOT
						}
					}
				}
				set_character_flag = achievement_sibling_rival_war
			}
			remove_opinion = {
				who = FROM
				modifier = opinion_humiliated_rival
			}
		}
		
		FROM = { 
			prestige = -250
			
			imprison = ROOT
			opinion = {
				modifier = opinion_humiliated_rival
				who = ROOT
				years = 150
			}
		}
	}

	on_fail = {
		ROOT = { 
			prestige = -125
		}
		FROM = { 
			prestige = 50
		}
	}

	on_reverse_demand = {
		FROM = {
			participation_scaled_prestige = 250
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { 
				participation_scaled_prestige = 250
			}
		}
		ROOT = {
			prestige = -250
			imprison = FROM
			opinion = {
				modifier = opinion_humiliated_rival
				who = FROM
				years = 150
			}
		}
		
		FROM = { 
			remove_opinion = {
				who = ROOT
				modifier = opinion_humiliated_rival
			}
			if = {
				limit = {
					ai = no
					ROOT = {
						any_sibling = {
							character = PREVPREV
						}
					}
				}
				set_character_flag = achievement_sibling_rival_war
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 55
tributary_cb = {
	name = CB_NAME_TRIBUTARY
	war_name = WAR_NAME_TRIBUTARY
	sprite = 36
	truce_days = 1095
	is_permanent = yes
	hostile_against_others = yes
	can_ask_to_join_war = no
	display_on_map = no
	allowed_to_target_tributaries = no
	defender_unoccupied_warscore = yes
	
	sort_priority = 810
	
	can_use_gui = {
		ROOT = { 
			OR = {
				prestige = 300 
				hidden_tooltip = { has_character_flag = reestablish_tributary_war }
			}
			relative_realm_size = {
				who = FROM 
				size > 2
			}
		}
	}

	can_use = {
		has_dlc = "Horse Lords"
		
		OR = {
			ROOT = { has_character_flag = reestablish_tributary_war }
			AND = {
				ROOT = {
					mercenary = no
					OR = {
						is_tributary = no
						is_tributary = {
							type = offmap
						}
					}
					NOT = { is_vassal_or_below = FROM }
					NOT = { is_liege_or_above = FROM }
					NOT = {
						rightful_religious_head_scope = {
							character = FROM
						}
					}
					independent = yes
				}
				FROM = {
					independent = yes
					higher_tier_than = BARON
					NOT = {
						is_offmap_governor = yes
					}
					NOR = {
						pays_tribute_to = ROOT
						any_liege = {
							pays_tribute_to = ROOT
						}
						is_tributary = { type = foederati }
						is_tributary = { type = roman_province }
					}
					OR = {
						NOT = { higher_tier_than = ROOT }			# Lower tier
						AND = {
							NOT = { prestige = 400 }				# Not prestigious
							ROOT = { prestige = 800 }
						}
						NOT = { num_of_count_titles_in_realm = 10 }	# Small realm
					}
				}
				
				# The attacker needs a border, or be at most one sea zone away from one of the target's counties
				FROM = {
					any_realm_province = {
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											character = ROOT
											is_liege_or_above = ROOT
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										owner = {
											OR = {
												character = ROOT
												is_liege_or_above = ROOT
											}
										}
									}
								}
							}
						}
					}
				}
				
				# The defender is not in any tributary war
				FROM = {
					is_defending_against_tributary_war = no
				}
				
				# The defender is not a foederati
				FROM = {
					NOT = {
						trait = foederate
					}
				}
				
				# Not if can establish a Subject Kingdom instead
				NOT = {				
					ROOT = { 
						can_use_cb = {
							target = FROM
							casus_belli = tributary_britannia_subject_cb
							only_check_triggers = yes
						}
					}
				}
		
				# Not if can establish a March instead
				NOT = {				
					ROOT = { 
						can_use_cb = {
							target = FROM
							casus_belli = tributary_march_cb
							only_check_triggers = yes
						}
					}
				}
				
				# Not if supposed to use Anglo-Saxon tributary cbs
				NOR = {			
					ROOT = { 
						can_use_cb = {
							target = FROM
							casus_belli = tributary_anglosaxon_cb
							only_check_triggers = yes
						}
					}
					AND = {				
						primary_title = {
							capital_scope = {
								region = world_britannia
							}
							OR = {
								lower_tier_than = DUKE
								title = e_aengland
								empire = { title = e_aengland }
							}
						}
						is_ingvaeonic_culture_trigger = yes
						FROM = {
							primary_title = {
								capital_scope = {
									region = world_britannia
								}
								OR = {
									lower_tier_than = DUKE
									title = e_aengland
									empire = { title = e_aengland }
								}
							}
							is_ingvaeonic_culture_trigger = yes
						}
					}
				}
			}
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		ROOT = { clr_character_flag = reestablish_tributary_war }
		# Chance to surrender early
		if = {
			limit = { 
				NAND = {			# Since you just got asked, no point asking again
					ROOT = { has_landed_title = k_ostrogoths }
					k_ostrogoths = { has_title_flag = subjugating_visigoths }
				}
			}			
			ROOT = { save_event_target_as = tribute_war_suzerain }
			FROM = {
				show_scope_change = no
				save_event_target_as = tribute_war_target
				set_character_flag = surrender_tributary_cb
				character_event = { id = JD.2500 days = 5 tooltip = surrender_tributary_tt }
			}
		}
	}

	is_valid = {
		NOT = {
			ROOT = {
				rightful_religious_head_scope = {
					character = FROM 
				}
			}
		}
	}

	on_success = {
		FROM = {
			show_scope_change = no
			save_event_target_as = target_loser
			prestige = -100
			custom_tooltip = {
				text = "REMOVE_PREVIOUS_SUZERAIN"
				hidden_tooltip = {
					any_suzerain = {
						event_target:target_loser = {
							remove_tributary = PREV
						}
					}
				}
			}
		}

		ROOT = {
			show_scope_change = no
			prestige = 200
			make_tributary = { who = FROM percentage = 0.4 }
		}
		
		if  = {
			limit = {
				ROOT = {
					uses_decadence = yes
				}
			}
			ROOT = {
				decadence = -10
			}
		}
		if  = {
			limit = {
				ROOT = {
					is_nomadic = yes
				}
			}
			ROOT = {
				clan_title = {
					ROOT = {
						any_vassal = {
							limit = { is_nomadic = yes }
							clan_title = {
								clan_opinion = {
									who = PREVPREVPREV
									modifier = won_tributary_war
									years = 5
								}
							}
						}
					}
				}
			}
		}
		
		if  = {
			limit = {
				ROOT = {
					is_tribal = yes
				}
			}
			ROOT = {
				any_vassal = {
					limit = { is_tribal = yes }
					opinion = {
						who = PREV
						modifier = won_tributary_war
						years = 5
					}
				}
			}
		}
		
		if = {
			limit = { 
				ROOT = { 
					has_landed_title = k_ostrogoths
					k_ostrogoths = { has_title_flag = subjugating_visigoths }
				}
			}
			if = {
				limit = {
					FROM = {
						any_realm_province = {
							region = custom_provence
						}
					}
				}
				custom_tooltip = {
					text = vassalize_provence_succ_tip
				}
				hidden_tooltip = {
					k_praetorian_prefecture_of_gaul = { 	# Transfer Provence to PPO Gaul
						holder_scope = { 
							set_character_flag = vassalize_from_war
							character_event = { id = 302817 } 
						} 
					}
				}
			}
			k_ostrogoths = { 
				clr_title_flag = subjugating_visigoths 
				holder_scope = { character_event = { id = 302820 } }
			}
		}		
		
		# Recalculate Aengland variables
		check_recalculate_aengland_variables_effect = yes
	}

	on_fail = {
		ROOT = {
			show_scope_change = no
			prestige = -100
		}
		FROM = {
			show_scope_change = no
			prestige = 100
		}
		if = {
			limit = { 
				ROOT = { 
					has_landed_title = k_ostrogoths
					k_ostrogoths = { has_title_flag = subjugating_visigoths }
				}
			}
			k_ostrogoths = { clr_title_flag = subjugating_visigoths }
		}
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}

		FROM = {
			show_scope_change = no
			prestige = 200
		}
		if = {
			limit = { 
				ROOT = { 
					has_landed_title = k_ostrogoths
					k_ostrogoths = { has_title_flag = subjugating_visigoths }
				}
			}
			k_ostrogoths = { clr_title_flag = subjugating_visigoths }
		}
	}
	
	on_attacker_leader_death = {
		if = {
			limit = {
				NOT = {
					ROOT = { 
						has_landed_title = k_ostrogoths
						k_ostrogoths = { has_title_flag = subjugating_visigoths }
					}
				}
			}
			end_war = invalid
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
		
		modifier = {
			factor = 2
			FROM = {
				trait = proud
			}
		}
		
		modifier = {
			factor = 2
			FROM = {
				trait = brave
			}
		}
		
		modifier = {
			factor = 2
			FROM = {
				trait = greedy
			}
		}
		
		modifier = {
			factor = 3
			FROM = {
				tier = KING
			}
		}

		modifier = {
			factor = 0.85
			ROOT = {
				relative_power = { who = FROM power = 1.2 }
			}
		}

		modifier = {
			factor = 0.85
			ROOT = {
				relative_power = { who = FROM power = 1.5 }
			}
		}

		modifier = {
			factor = 0.8
			ROOT = {
				relative_power = { who = FROM power = 2.0 }
			}
		}

		modifier = {
			factor = 0.8
			ROOT = {
				relative_power = { who = FROM power = 2.5 }
			}
		}

		modifier = {
			factor = 0.8
			ROOT = {
				relative_power = { who = FROM power = 3 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 4 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 5 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 6 }
			}
		}

		modifier = {
			factor = 0.5
			ROOT = {
				relative_power = { who = FROM power = 8 }
			}
		}

		modifier = {
			factor = 0.25
			ROOT = {
				relative_power = { who = FROM power = 10 }
			}
		}

		modifier = {
			factor = 2
			ROOT = {
				distance_from_realm = { who = FROM value = 20 }
			}
		}

		modifier = {
			factor = 2
			ROOT = {
				distance_from_realm = { who = FROM value = 40 }
			}
		}
		
		modifier = {
			factor = 3
			ROOT = {
				distance_from_realm = { who = FROM value = 80 }
			}
		}
		
		modifier = {
			factor = 4
			ROOT = {
				distance_from_realm = { who = FROM value = 120 }
			}
		}
	}

	ai_will_do = {
		factor = 1
		
		modifier = {
			factor = 0.1 # Low prio CB
		}
		modifier = {
			factor = 0.1 # Nomads are the only ones who like using the CB
			ROOT = {
				is_nomadic = no
			}
		}
		
		modifier = {
			factor = 0.1 # Target has almost no money
			FROM = {
				OR = {
					is_nomadic = yes
					is_tribal = yes
				}
			}
		}

		modifier = {
			factor = 4
			ROOT = {
				trait = greedy
			}
		}
		modifier = {
			factor = 5
			ROOT = { 
				is_frankish_culture_trigger = yes
			}
			FROM = {
				OR = {
					culture = armorican
					culture = breton
				}
				primary_title = {
					title = k_broceliande
				}
			}
		}
		modifier = {
			factor = 0.01
			ROOT = { is_seafarer = no }
			FROM = {
				NOR = {
					any_realm_province = {
						any_neighbor_province = {
							owner = {
								OR = {
									character = ROOT
									is_liege_or_above = ROOT
									top_liege = { 
										is_tributary = yes
										suzerain = {
											character = ROOT
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
}

# 56
free_tributary_cb = {
	name = CB_NAME_FREE_TRIBUTARY
	war_name = WAR_NAME_FREE_TRIBUTARY
	sprite = 25
	truce_days = 1095
	is_permanent = yes
	hostile_against_others = yes
	can_ask_to_join_war = no
	is_independence = yes
	
	sort_priority = 1100

	can_use = {
		ROOT = {
			OR = {
				AND = {
					is_tributary = yes
					OR = {
						is_tributary = { type = foederati }
						is_tributary = { type = client_state }
						is_tributary = { type = roman_province }
						is_tributary = { type = anglosaxon_tributary }
						is_tributary = { type = march }
						AND = {
							OR = {
								has_global_flag = britannia_formalized_high_kingship
								NOT = { suzerain = { has_landed_title = e_britannia } }		# In case somehow this happens
							}
							is_tributary = { type = britannia_subject }
						}
						AND = {
							has_dlc = "Horse Lords"
							OR = {
								is_tributary = { type = nomadic }
								is_tributary = { type = default }
							}
						}
						AND = {
							has_dlc = "Jade Dragon"
							OR = {
								is_tributary = { type = permanent }
								is_tributary = { type = offmap }
							}
						}
					}
					suzerain = {
						OR = {
							character = FROM
							any_liege = {
								character = FROM
							}
						}
					}
				}
				any_vassal = {
					is_tributary = yes
					OR = {
						AND = {
							has_dlc = "Horse Lords"
							OR = {
								is_tributary = { type = nomadic }
								is_tributary = { type = default }
							}
						}
						AND = {
							has_dlc = "Jade Dragon"
							OR = {
								is_tributary = { type = permanent }
								is_tributary = { type = offmap }
							}
						}
					}
					suzerain = {
						OR = {
							character = FROM
							any_liege = {
								character = FROM
							}
						}
					}
				}
			}
		}
	}

	can_use_gui = {
		ROOT = { #Cannot use CB if can take decision to stop paying tribute
			conditional_tooltip = {
				trigger = { is_decision_potential = tributary_independence_normal }
				NOT = { is_decision_allowed = tributary_independence_normal }
			}
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				AND = {
					is_tributary = yes
					suzerain = {
						OR = {
							character = FROM
							any_liege = {
								character = FROM
							}
						}
					}
				}
				any_vassal = {
					is_tributary = yes
					suzerain = {
						OR = {
							character = FROM
							any_liege = {
								character = FROM
							}
						}
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success = {
		FROM = {
			show_scope_change = no
			prestige = -100
		}
		

		ROOT = {
			show_scope_change = no
			prestige = 100
			# Flag march independence before it gets removed
			hidden_tooltip = {
				if = {
					limit = { is_tributary = { type = march } }
					set_character_flag = was_a_march
				}
			}
			if = {
				limit = {
					is_tributary = yes
					suzerain = {
						OR = {
							character = FROM
							any_liege = {
								character = FROM
							}
						}
					}
				}
				suzerain = {
					remove_tributary = PREV
				}
			}
			# March independence notification
			hidden_tooltip = {
				if = {
					limit = { has_character_flag = was_a_march }
					clr_character_flag = was_a_march
					character_event = { id = 320935 }
					suzerain = { character_event = { id = 320936 } }
				}
			}
			any_vassal = {
				limit = {
					is_tributary = yes
					suzerain = {
						OR = {
							character = FROM
							any_liege = {
								character = FROM
							}
						}
					}
				}
				suzerain = {
					remove_tributary = PREV
				}
			}
		}
		
		if = {
			limit = {
				ROOT = {
					OR = {
						independent = yes
						liege = { tier = EMPEROR }
					}
					has_character_flag = claiming_iclingas
				}
			}
			ROOT = { character_event = { id = 313071 } }
		}
		if = {
			limit = {
				ROOT = {
					NOR = {
						independent = yes
						liege = { tier = EMPEROR }
					}
					has_character_flag = claiming_iclingas
				}
			}
			ROOT = { character_event = { id = 313072 } }
		}
		
		# Recalculate Aengland variables
		check_recalculate_aengland_variables_effect = yes
	}

	on_fail = {
		ROOT = {
			show_scope_change = no
			prestige = -100
		}
		FROM = {
			show_scope_change = no
			prestige = 100
		}
		if = {
			limit = { ROOT = { has_character_flag = claiming_iclingas } }
			ROOT = { character_event = { id = 313073 } }
		}
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			prestige = -100
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}

		FROM = {
			show_scope_change = no
			prestige = 100
		}
		if = {
			limit = { ROOT = { has_character_flag = claiming_iclingas } }
			ROOT = { character_event = { id = 313073 } }
		}
	}
	
	on_attacker_leader_death = {
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100

		modifier = {
			factor = 1.5
			FROM = {
				trait = proud
			}
		}
		
		modifier = {
			factor = 1.5
			FROM = {
				trait = brave
			}
		}
		
		modifier = {
			factor = 1.5
			FROM = {
				trait = greedy
			}
		}
		
		modifier = {
			factor = 2
			FROM = {
				tier = KING
			}
		}

		modifier = {
			factor = 0.80
			ROOT = {
				relative_power = { who = FROM power = 1.2 }
			}
		}

		modifier = {
			factor = 0.80
			ROOT = {
				relative_power = { who = FROM power = 1.5 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 2.0 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 2.5 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 3 }
			}
		}

		modifier = {
			factor = 0.7
			ROOT = {
				relative_power = { who = FROM power = 4 }
			}
		}

		modifier = {
			factor = 0.7
			ROOT = {
				relative_power = { who = FROM power = 5 }
			}
		}

		modifier = {
			factor = 0.7
			ROOT = {
				relative_power = { who = FROM power = 6 }
			}
		}

		modifier = {
			factor = 0.4
			ROOT = {
				relative_power = { who = FROM power = 8 }
			}
		}

		modifier = {
			factor = 0.1
			ROOT = {
				relative_power = { who = FROM power = 10 }
			}
		}

		modifier = {
			factor = 5
			ROOT = {
				distance_from_realm = { who = FROM value = 20 }
			}
		}

		modifier = {
			factor = 5
			ROOT = {
				distance_from_realm = { who = FROM value = 40 }
			}
		}
		
		modifier = {
			factor = 5
			ROOT = {
				distance_from_realm = { who = FROM value = 80 }
			}
		}
		
		modifier = {
			factor = 5
			ROOT = {
				distance_from_realm = { who = FROM value = 120 }
			}
		}
	}

	ai_will_do = { 
		factor = 1
		
		modifier = {
			factor = 1.5
			always = yes
		}

		modifier = {
			factor = 4
			ROOT = {
				trait = greedy
			}
		}
		
		modifier = {
			factor = 2
			OR = {
				ROOT = {
					is_nomadic = yes
				}
				FROM = {
					is_nomadic = no
				}
			}
		}
		
		modifier = {
			factor = 0
			ROOT = { is_tributary = { type = roman_province } }
		}
		
		modifier = {
			factor = 0
			ROOT = { 
				is_tributary = { type = foederati } 
				has_landed_title = d_north_angles
			}
			NOT = { has_global_flag = angles_bernicia_ultimatum }
		}
		
		modifier = {
			factor = 2
			ROOT = { is_tributary = { type = britannia_subject } }
		}
		
		modifier = {
			factor = 20
			ROOT = { is_tributary = { type = anglosaxon_tributary } }
		}
		
		# Anglo-Saxons like to revolt at the beginning of a new reign
		modifier = {
			factor = 3
			ROOT = { is_tributary = { type = anglosaxon_tributary } }
			FROM = { NOT = { ruled_years = 5 } }
		}
		
		modifier = {
			factor = 1.5
			FROM = { war = yes }
		}
		
		modifier = {
			factor = 1.5
			FROM = { 
				war = yes 
				OR = {
					is_primary_war_attacker = yes
					is_primary_war_defender = yes
				}
			}
		}
		
		modifier = {
			factor = 4
			# Is in a civil war/rebellion
			FROM = { 
				war = yes 
				any_war = {
					OR = {
						AND = {
							attacker = { character = FROM }
							defender = {
								in_revolt = yes
								liege_before_war = { character = FROM }
							}
						}
						AND = {
							defender = { character = FROM }
							attacker = {
								in_revolt = yes
								liege_before_war = { character = FROM }
							}
						}
					}
				}
			}
		}
		
		modifier = {
			factor = 4
			ROOT = {
				OR = {
					is_tributary = { type = anglosaxon_tributary }
					is_tributary = { type = britannia_subject }
				}
				trait = ambitious
			}
		}
		
		modifier = {
			factor = 1.5
			ROOT = {
				relative_power = {
					who = FROM
					power = 0.75
				}
			}
		}
		
		modifier = {
			factor = 3
			ROOT = {
				relative_power = {
					who = FROM
					power = 0.9
				}
			}
		}
	}
}

# 57
cb_install_khan = {
	name = CB_NAME_INSTALLKHAN
	war_name = WAR_NAME_INSTALLKHAN
	sprite = 12
	truce_days = 3650
	
	is_revolt_cb = no
	can_call_vassals = yes
	attacker_can_call_allies = no
	major_revolt = yes

	can_use = {
		has_dlc = "Horse Lords"
		
		ROOT = {
			is_nomadic = yes
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = { 
					FROM = { 
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
			any_demesne_title = {
				tier = count # has some land
			}
		}
		FROM = {
			any_demesne_title = {
				NOT = { lower_tier_than = ROOT }
				temporary = no
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		flag_faction_revolt_title_effect = yes
	}

	on_success = {
		FROM = {
			any_demesne_title = {
				limit = { tier = EMPEROR }
				gain_title = { target = ROOT type = faction_demand }
			}
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		ROOT = {
			participation_scaled_prestige = 250
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 250 }
		}
		destroy_faction_revolt_title_effect = yes
	}

	on_fail = {
		ROOT = {
			show_scope_change = no
			prestige = -100
		}
		destroy_faction_revolt_title_effect = yes
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			prestige = -200
			prisoner = FROM
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 50
			hidden_tooltip = { 
				if = { 
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		destroy_faction_revolt_title_effect = yes
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}
	
	on_defender_leader_death = {
		hidden_tooltip = {
			any_attacker = {
				letter_event = {
					id = 251
				}
			}
		}
		
		end_war = invalid
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 58
nomad_dispute = {
	name = CB_NAME_DISPUTE
	war_name = CB_NAME_DISPUTE
	sprite = 16
	truce_days = 1095
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes
	can_ask_to_join_war = no
	
	allow_distant = yes
	
	allowed_to_target_tributaries = no
	
	sort_priority = 700
	
	can_use = {
		has_dlc = "Horse Lords"

		FROM = {
			is_nomadic = yes
		}
		ROOT = {
			is_nomadic = yes
			same_realm = FROM
			has_feud_with = FROM
		}
		
		ROOT = {
			mercenary = no
		}
	}

	can_use_title = {
		tier = count
		location = {
			NOT = { num_of_settlements = 1 }
		}
		FROM = {
			has_landed_title = PREV
		}
	}

	is_valid_title = {
		location = {
			NOT = { num_of_settlements = 1 }
		}
		FROM = {
			has_landed_title = PREV
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success_title = {
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
		
		ROOT = {
			show_scope_change = no
			participation_scaled_prestige = 100
			participation_scaled_piety = 50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { 
				participation_scaled_prestige = 100 
				participation_scaled_piety = 50
			}
		}
	}

	on_fail_title = {
		ROOT = {
			show_scope_change = no
			prestige = -100
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 100
			participation_scaled_piety = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
				participation_scaled_prestige = 100 
				participation_scaled_piety = 50
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	ai_will_do = {
		factor = 2
	}
	
}

# 59: CB for non-nomads to seize a duchy off a nomad horde
cb_liberate_nomad_duchy = {
	name = CB_NAME_LIBERATE_NOMAD
	war_name = WAR_NAME_LIBERATE_NOMAD
	sprite = 8
	truce_days = 3650
	is_permanent = yes
	check_de_jure_tier = DUKE # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	
	allowed_to_target_tributaries = no

	infamy_modifier = 0.75
	
	sort_priority = 810

	can_use = {
		FROM = {
			is_nomadic = yes
		}
		ROOT = {
			is_nomadic = no
			NOT = { pacifist = yes }
			NOT = { same_realm = FROM }
			mercenary = no
		}
	}
	
	can_use_title = {
		# The attacker needs at least one county in the target kingdom, or a border, or be only two sea zones away from one of your counties
		any_direct_de_jure_vassal_title = {
			OR = {
				holder_scope = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
				location = {
					any_neighbor_province = {
						OR = {
							AND = {
								has_owner = yes
								owner = {
									OR = {
										character = ROOT
										is_liege_or_above = ROOT
									}
								}
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
		FROM = {
			is_nomadic = yes
		}
		ROOT = {
			is_nomadic = no
			NOT = { pacifist = yes }
			NOT = { same_realm = FROM }
			mercenary = no
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}
	
	on_success = {
		ROOT = {
			show_scope_change = no
			participation_scaled_prestige = 200
			if = {
				limit = {
					uses_decadence = yes
				}
				participation_scaled_decadence = -10
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { 
				participation_scaled_prestige = 200
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -10
				}
			}
		}
		
		FROM = {
			show_scope_change = no
			prestige = -200 
		}
	}

	on_success_title = {
		custom_tooltip = {
			text = liberate_nomad_cb_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title = {
						title = PREV
						enemy = FROM
						anti_nomad = yes # Vassalize non-nomadic rulers
						type = invasion
					}
				}
			}
		}
	}

	on_fail = {
		ROOT = { 
			show_scope_change = no
			prestige = -200
		}
	}

	on_reverse_demand = {
		ROOT = {
			show_scope_change = no
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			prestige = -200
		}
		FROM = {
			show_scope_change = no
			participation_scaled_prestige = 300
			if = {
				limit = {
					uses_decadence = yes
				}
				participation_scaled_decadence = -10
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { 
				participation_scaled_prestige = 300
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -10
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	ai_will_do = { 
		factor = 1
		
		modifier = {
			factor = 0
			ROOT = {
				NOT = {
					is_tribal = yes
				}
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
						}
					}
				}
			}
		}
		modifier = {
			factor = 0
			ROOT = {
				is_tribal = yes
			}
			NOT = {
				any_direct_de_jure_vassal_title = {
					any_direct_de_jure_vassal_title = {
						OR = {
							holding_type = castle
							holding_type = city
							holding_type = tribal
						}
					}
				}
			}
		}
	}
}

# 60: The CB used by "Minor Clan" revolters in Horse Lords
cb_minor_clan_revolt = {
	name = CB_NAME_MINOR_CLAN_REVOLT
	war_name = WAR_NAME_MINOR_CLAN_REVOLT
	sprite = 16
	truce_days = 365
	hostile_against_others = no
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	
	attacker_can_call_allies = no
	defender_can_call_allies = no
	can_ask_to_join_war = no
	
	is_independence = yes
	
	can_use = {
		ROOT = {
			primary_title = { temporary = yes } # Revolter or adventurer trigger
			war = no
			NOT = { is_liege_or_above = FROM }
			mercenary = no
		}
	}

	can_use_title = {
		tier = count
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success_title = {
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = revolt }
	
		ROOT = {
			primary_title = {
				set_title_nomad = { title = THIS status = no }
			}
			
			set_government_type = feudal_government
		}
	
		ROOT = {		
			set_government_type = nomadic_government
			set_defacto_liege = FROM
			
			hidden_tooltip = {
				remove_opinion = {
					who = FROM
					modifier = opinion_evil_tyrant
				}
			}
		}
		FROM = {
			prestige = -100
		}
	}

	on_fail_title = {
		FROM = {
			prestige = 10
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
			}
		}
		ROOT = {
			clear_wealth = yes
			imprison = FROM
			hidden_tooltip = {
				add_character_modifier = { 
					name = broken_spirit
					days = -1
				}
			}
		}
	}

	on_reverse_demand = {
		FROM = {
			prestige = 20
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
				add_character_modifier = { 
					name = crushed_revolt
					days = 1825
				}
			}
		}
		ROOT = {
			clear_wealth = yes
			imprison = FROM 
			hidden_tooltip = {
				add_character_modifier = { 
					name = broken_spirit
					days = -1
				}
			}
		}
	}

	on_attacker_leader_death = {
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 61: Nomads can subjugate non-Nomads
nomad_subjugation = {
	name = CB_NAME_PAGAN_SUBJUGATION
	war_name = WAR_NAME_PAGAN_SUBJUGATION
	sprite = 8
	truce_days = 365
	is_permanent = yes
	can_ask_to_join_war = yes
	allowed_to_target_tributaries = no
	defender_unoccupied_warscore = yes
	
	sort_priority = 1100
	
	can_use_gui = {
		#higher_tier_than between ROOT and FROM would be better but its tooltip doesn't say anything about comparing character tiers
		OR = {
			ROOT = {
				higher_tier_than = king
			}
			NOT = {
				FROM = {
					tier = emperor
				}
			}
		}
		FROM = {
			is_nomadic = no
			OR = {
				AND = {
					is_tribal = yes
					ROOT = {
						population = 2500
					}
				}
				ROOT = {
					population = 10000
				}
				has_opinion_modifier = {
					modifier = declared_independence_nomad
					who = FROM
				}
			}
		}
		ROOT = {
			OR = {
				prestige = 500
				has_opinion_modifier = {
					modifier = declared_independence_nomad
					who = FROM
				}
			}
		}
	}
	
	can_use = {
		ROOT = {
			is_nomadic = yes
			NOT = { same_realm = FROM }
			NOT = { is_liege_or_above = FROM }
			mercenary = no
			OR = {
				NOT = { has_character_modifier = launched_subjugation }
				has_opinion_modifier = {
					modifier = declared_independence_nomad
					who = FROM
				}
			}
		}
		
		FROM = {
			in_revolt = no
			is_nomadic = no # Nomads cannot be subjugated
			NOT = {
				any_war = {
					AND = {
						defender = { character = PREVPREV }
						OR = {
							using_cb = nomad_subjugation
							using_cb = pagan_subjugation
						}
					}
				}
			}
		}
		
		OR = {
			ROOT = {
				ai = no
			}
			FROM = {
				any_realm_title = {
					tier = COUNT
					count = 5
				}
			}
		}
	}
	
	on_add = {
		ROOT = {
			if = {
				limit = {
					NOT = {
						has_opinion_modifier = {
							modifier = declared_independence_nomad
							who = FROM
						}
					}
				}
				prestige = -500
				add_character_modifier = { 
					name = launched_subjugation
					years = 100
					hidden = yes
				}
			}
		}
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success = {
		hidden_tooltip = {
			ROOT = {
				if = {
					limit = {
						has_nickname = no
					}
					FROM = {
						save_event_target_as = nickname_target
					}
					ROOT = { 
						save_event_target_as = nickname_receiver
					}
					random_list = {
						2 = { give_nickname = nick_the_eastern_wind }
						5 = { give_nickname = nick_the_despoiler }
						5 = { 
							give_nickname = nick_the_bane_of_realmname
							modifier = {
								factor = 0
								event_target:nickname_target = { is_nomadic = yes }
							}
							modifier = {
								factor = 0
								event_target:nickname_target = { culture = ROOT }
							}
						}
						5 = { 
							give_nickname = nick_the_culture_marauder
							modifier = {
								factor = 0
								event_target:nickname_target = { is_nomadic = yes }
							}
							modifier = {
								factor = 0
								event_target:nickname_target = { culture = ROOT }
							}
						}
						100 = { }
					}
				}
			}
		}
		ROOT = {
			piety = 100
		}
		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		FROM = {
			piety = -100
			prestige = -100
			
			if = {
				limit = {
					is_organized_pagan_religion_trigger = yes
					controls_religion = no
				}
				religion = ROOT # Reformed pagans are forced to convert back
			}
			
			custom_tooltip = {
				text = tribal_subjugation_tip
			}
				
			hidden_tooltip = {
				opinion = {
					modifier = opinion_subjugated 
					who = ROOT
				}
				any_vassal = {
					opinion = {
						modifier = opinion_subjugated 
						who = ROOT
					}
				}
					
				any_demesne_title = {
					limit = {
						higher_tier_than = ROOT
						NOT = { controls_religion = yes }
					}
					ROOT = { grant_title_no_opinion = { target = PREV type = invasion } }
					add_pressed_claim = PREV
				}
				
				any_demesne_title = {
					limit = {
						tier = ROOT
						NOT = { controls_religion = yes }
					}
					ROOT = { grant_title_no_opinion = { target = PREV type = invasion } }
					add_pressed_claim = PREV
				}

				if = {
					limit = {
						NOT = {
							any_demesne_title = {
								controls_religion = yes
							}
						}
					}
					set_defacto_liege = ROOT
					break = yes
				}
				any_vassal = {
					set_defacto_liege = ROOT
				}
				any_demesne_title = {
					limit = {
						NOT = { controls_religion = yes }
					}
					ROOT = {
						grant_title_no_opinion = { target = PREV type = invasion }
					}
				}
			}
		}
	}
	
	on_fail = {
		FROM = {
			piety = 50
		}
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		ROOT = {
			piety = -100
		}
	}
	
	on_invalidation = {
		if = {
			limit = {
				NOT = {
					has_opinion_modifier = {
						modifier = declared_independence_nomad
						who = FROM
					}
				}
			}
			ROOT = {
				remove_character_modifier = launched_subjugation
			}
		}
	}

	on_reverse_demand = {
		ROOT = {
			piety = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
		}
		FROM = {
			piety = 100
		}
		FROM = {
			if = {
				limit = { 
					has_dlc = "Legacy of Rome"
					is_roman_emperor_trigger = yes
					OR = {
						religion_group = christian
						is_hellenic_group_religion_trigger = yes
					}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	ai_will_do = { 
		factor = 2
	}
} 

# 62:
nomad_invasion = {
	name = CB_NAME_INVASION
	war_name = WAR_NAME_INVASION
	sprite = 8
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	is_holy_war = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	
	allowed_to_target_tributaries = no
	
	sort_priority = 1000

	can_use_gui = {
		ROOT = {
			prestige = 100
			population_factor = 0.9 # 90% of max
		}
	}
	
	on_add = {
		ROOT = { prestige = -100 }
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	can_use = {
		ROOT = {
			is_nomadic = yes
		}
		
		ROOT = {
			NOT = { same_realm = FROM }
		}
		
		OR = { # This ensures that the AI doesn't declare this type of war against someone who only holds a few counties within the targeted title...
			ROOT = {
				ai = no
			}
			FROM = {
				num_of_realm_counties = {
					value = 5
					title = PREV
				}
			}
		}
	}
	
	is_valid_title = {
		FROM = {
			any_realm_province = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}

	on_success = {
		ROOT = {
			prestige = 200
		}
		ROOT = {
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		FROM = {
			prestige = -200
		}
		hidden_tooltip = {
			ROOT = {
				occupy_minors_of_occupied_settlements = FROM
				gain_all_occupied_titles = { who = FROM type = invasion }
				
				if = {
					limit = {
						has_nickname = no
					}
					FROM = {
						save_event_target_as = nickname_target
					}
					ROOT = { 
						save_event_target_as = nickname_receiver
					}
					random_list = {
						5 = { give_nickname = nick_the_great }
						5 = { give_nickname = nick_the_victorious }
						5 = { give_nickname = nick_the_conqueror }
						5 = { give_nickname = nick_the_brave }
						10 = { give_nickname = nick_the_dragon }
						10 = { give_nickname = nick_the_terrible }
						10 = { give_nickname = nick_the_eastern_wind }
						25 = { give_nickname = nick_the_despoiler }
						25 = { 
							give_nickname = nick_the_culture_marauder
							modifier = {
								factor = 0
								event_target:nickname_target = { is_nomadic = yes }
							}
							modifier = {
								factor = 0
								event_target:nickname_target = { culture = ROOT }
							}
						}
						50 = { 
							give_nickname = nick_the_bane_of_realmname
							modifier = {
								factor = 0
								event_target:nickname_target = { is_nomadic = yes }
							}
							modifier = {
								factor = 0
								event_target:nickname_target = { culture = ROOT }
							}
						}
						50 = { 
							give_nickname = nick_the_slayer_of_culture
							modifier = {
								factor = 0
								event_target:nickname_target = { culture = ROOT }
							}
						}
						50 = { 
							give_nickname = nick_the_scourge_of_god
							modifier = {
								factor = 0
								event_target:nickname_target = { religion = ROOT }
							}
						}
					}
				}
			}
		}
	}
	
	on_success_title = {
		custom_tooltip = {
			text = tribal_invasion_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title_destroy_duchies = {
						title = PREV
						enemy = FROM
						is_crusade = yes # Even if the title holder is not participating in the war, gain holdings occupied by all Crusade participants
						type = invasion
					}
				}
			}
		}
	}

	on_fail = {
		FROM = {
			prestige = 100
			
			hidden_tooltip = {
				if = {
					limit = {
						has_nickname = no
					}
					random_list = {
						10 = { give_nickname = nick_the_great }
						10 = { give_nickname = nick_the_hammer }
						10 = { give_nickname = nick_the_avenger }
						10 = { give_nickname = nick_the_lion }
						10 = { give_nickname = nick_the_bold }
					}
				}
			}
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		ROOT = {
			prestige = -200
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			prestige = 200
			hidden_tooltip = {
				if = {
					limit = {
						has_nickname = no
					}
					random_list = {
						10 = { give_nickname = nick_the_great }
						10 = { give_nickname = nick_the_hammer }
						10 = { give_nickname = nick_the_avenger }
						10 = { give_nickname = nick_the_lion }
						10 = { give_nickname = nick_the_bold }
					}
				}
			}
			
			if = {
				limit = { 
					has_dlc = "Legacy of Rome"
					is_roman_emperor_trigger = yes
					OR = {
						religion_group = christian
						is_hellenic_group_religion_trigger = yes
					}
				}
				hidden_tooltip = { character_event = { id = LoR.30 days = 12 } }
			}
		}
		FROM = {
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = 200
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	ai_will_do = { 
		factor = 2
		
		modifier = {
			factor = 0.9 # Prefer using CB's without on_add costs
		}
	}
}

# 63: Nomads can grab entire duchies, if they have the Prestige
nomad_expansion = {
	name = CB_NAME_NOMAD_EXPANSION
	war_name = WAR_NAME_NOMAD_EXPANSION
	sprite = 8
	truce_days = 3650
	is_permanent = yes
	is_holy_war = yes
	check_de_jure_tier = DUKE # this scans all de jure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	
	allowed_to_target_tributaries = no
	
	sort_priority = 800

	can_use_gui = {
		ROOT = {
			prestige = 300
		}
	}
	
	on_add = {
		ROOT = { prestige = -300 }
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	can_use = {
		ROOT = {
			is_nomadic = yes
			NOT = { same_realm = FROM }
			mercenary = no
		}
	}
	
	can_use_title = {
		# The attacker needs at least one county in the target duchy, or a border
		any_direct_de_jure_vassal_title = {
			OR = {
				holder_scope = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
				location = {
					any_neighbor_province = {
						has_owner = yes
						owner = {
							OR = {
								character = ROOT
								is_liege_or_above = ROOT
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			is_nomadic = yes
			NOT = { same_realm = FROM }
		}
	}
	
	on_success = {
		ROOT = {
			if = {
				limit = {
					has_nickname = no
				}
				FROM = {
						save_event_target_as = nickname_target
					}
				ROOT = { 
					save_event_target_as = nickname_receiver
				}
				random_list = {
					5 = { give_nickname = nick_the_eastern_wind }
					5 = { give_nickname = nick_the_despoiler }
					5 = {
						give_nickname = nick_the_culture_marauder
						modifier = {
							factor = 0
							event_target:nickname_target = { is_nomadic = yes }
						}
						modifier = {
							factor = 0
							event_target:nickname_target = { culture = ROOT }
						}
					}
					5 = { 
						give_nickname = nick_the_bane_of_realmname
						modifier = {
							factor = 0
							event_target:nickname_target = { is_nomadic = yes }
						}
						modifier = {
							factor = 0
							event_target:nickname_target = { culture = ROOT }
						}
					}
					5 = { 
						give_nickname = nick_the_slayer_of_culture
						modifier = {
							factor = 0
							event_target:nickname_target = { culture = ROOT }
						}
					}
					5 = { 
						give_nickname = nick_the_scourge_of_god
						modifier = {
							factor = 0
							event_target:nickname_target = { religion = ROOT }
						}
					}
					100 = { }
				}
			}
		}
		ROOT = {
			participation_scaled_prestige = 100
			if = {
				limit = {
					uses_decadence = yes
				}
				participation_scaled_decadence = -10
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { 
				participation_scaled_prestige = 200
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -10
				}
			}
		}
		FROM = { prestige = -200 }
	}

	on_success_title = {
		custom_tooltip = {
			text = pagan_subjugation_tip
			hidden_tooltip = {
				ROOT = {
					subjugate_or_take_under_title = {
						title = PREV
						enemy = FROM
#						same_religion = yes # Only vassalize rulers of my religion
					}
				}
			}
		}
	}

	on_fail = {
		ROOT = { 
			prestige = -200
		}
	}

	on_reverse_demand = {
		ROOT = {
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			prestige = -200
		}
		FROM = {
			participation_scaled_prestige = 300
			if = {
				limit = {
					uses_decadence = yes
				}
				participation_scaled_decadence = -10
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { 
				participation_scaled_prestige = 300
				if = {
					limit = {
						uses_decadence = yes
					}
					participation_scaled_decadence = -10
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	ai_will_do = { 
		factor = 2
	}
}

#64
increase_council_power_war = { # Started from faction
	name = CB_NAME_INCREASE_COUNCIL_POWER
	war_name = WAR_NAME_INCREASE_COUNCIL_POWER
	sprite = 6
	truce_days = 3650
	can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes
	
	can_use = {
		ROOT = {
			vassal_of = FROM
		}
	}
	
	can_use_title = {
		higher_tier_than = BARON
		OR = {
			has_law = law_voting_power_0
			has_law = banish_voting_power_0
			has_law = execution_voting_power_0
			has_law = revoke_title_voting_power_0
			has_law = grant_title_voting_power_0
			has_law = imprison_voting_power_0
			has_law = war_voting_power_0
		}
		is_primary_holder_title = yes
	}
	
	is_valid = {
		FROM = {
			in_revolt = no
			liege_before_war = {
				in_revolt = no
				liege_before_war = {
					in_revolt = no
				}
			}
		}
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = { 
					FROM = { 
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
	}
	
	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		flag_faction_revolt_title_effect = yes
	}
	
	on_invalidation = {
		FROM = { set_character_flag = prewar_liege_@ROOT }
		ROOT = { character_event = { id = 315913 } }
		destroy_faction_revolt_title_effect = yes
	}

	on_success = {
		ROOT = {
			hidden_tooltip = { 
				character_event = { id = 315911 } 
			}
			opinion = {
				modifier = opinion_increased_council_power
				who = FROM
				months = 12
			}
		}
		ROOT = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		destroy_faction_revolt_title_effect = yes
	}

	on_success_title = {
		increase_council_power_effect = yes
		increase_vassal_freedom_effect = yes
	}

	on_fail = {
		ROOT = {
			hidden_tooltip = { 
				character_event = { id = 315911 } 
			}
			prestige = -100
		}
		
		FROM = {
			participation_scaled_prestige = 50
			hidden_tooltip = { disband_event_forces = faction_loyalists }
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_council_power_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		destroy_faction_revolt_title_effect = yes
	}

	on_reverse_demand = {
		ROOT = {
			hidden_tooltip = { 
				set_character_flag = faction_defeated
				character_event = { id = 315911 } 
			}
			prestige = -200
			prisoner = FROM
		}
		
		FROM = {
			participation_scaled_prestige = 100
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			hidden_tooltip = { 
				if = { 
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_council_power_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		destroy_faction_revolt_title_effect = yes
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

# 55
nomad_humiliate_cb = {
	name = CB_NAME_HUMILIATE
	war_name = WAR_NAME_HUMILIATE
	sprite = 1
	truce_days = 3650
	is_permanent = yes
	hostile_against_others = yes
	can_ask_to_join_war = no
	display_on_map = no
	allowed_to_target_tributaries = no
	
	defender_unoccupied_warscore = yes
	
	sort_priority = 815
	
	can_use = {
		has_dlc = "Horse Lords"

		FROM = {
			is_nomadic = yes
		}
		
		ROOT = {
			is_nomadic = yes
			mercenary = no
			OR = {
				AND = {
					same_realm = FROM
					has_feud_with = FROM
				}
				FROM = {
					is_nomadic = yes
					independent = yes
				}
			}
		}
		
		# The attacker needs a border, or be at most two sea zones away from one of the target's counties
		FROM = {
			any_realm_province = {
				any_neighbor_province = {
					OR = {
						AND = {
							has_owner = yes
							owner = {
								OR = {
									character = ROOT
									is_liege_or_above = ROOT
								}
							}
						}
						AND = {
							is_land = no
							any_neighbor_province = {
								OR = {
									AND = {
										has_owner = yes
										owner = {
											OR = {
												character = ROOT
												is_liege_or_above = ROOT
											}
										}
									}
									AND = {
										is_land = no
										any_neighbor_province = {
											owner = {
												OR = {
													character = ROOT
													is_liege_or_above = ROOT
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
	}

	on_success = {
		ROOT = {
			prestige = 300
			steal_population_scaled = {
				target = FROM
				percentage = 0.25
			}
		}
		FROM = {
			prestige = -300
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			prestige = 100
		}
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}

		FROM = {
			prestige = 200
		}
	}
	
	on_attacker_leader_death = {
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
		
		modifier = {
			factor = 2
			FROM = {
				trait = proud
			}
		}
		
		modifier = {
			factor = 2
			FROM = {
				trait = brave
			}
		}
		
		modifier = {
			factor = 2
			FROM = {
				trait = greedy
			}
		}
		
		modifier = {
			factor = 3
			FROM = {
				tier = KING
			}
		}

		modifier = {
			factor = 0.85
			ROOT = {
				relative_power = { who = FROM power = 1.2 }
			}
		}

		modifier = {
			factor = 0.85
			ROOT = {
				relative_power = { who = FROM power = 1.5 }
			}
		}

		modifier = {
			factor = 0.8
			ROOT = {
				relative_power = { who = FROM power = 2.0 }
			}
		}

		modifier = {
			factor = 0.8
			ROOT = {
				relative_power = { who = FROM power = 2.5 }
			}
		}

		modifier = {
			factor = 0.8
			ROOT = {
				relative_power = { who = FROM power = 3 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 4 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 5 }
			}
		}

		modifier = {
			factor = 0.75
			ROOT = {
				relative_power = { who = FROM power = 6 }
			}
		}

		modifier = {
			factor = 0.5
			ROOT = {
				relative_power = { who = FROM power = 8 }
			}
		}

		modifier = {
			factor = 0.25
			ROOT = {
				relative_power = { who = FROM power = 10 }
			}
		}

		modifier = {
			factor = 2
			ROOT = {
				distance_from_realm = { who = FROM value = 20 }
			}
		}

		modifier = {
			factor = 2
			ROOT = {
				distance_from_realm = { who = FROM value = 40 }
			}
		}
		
		modifier = {
			factor = 3
			ROOT = {
				distance_from_realm = { who = FROM value = 80 }
			}
		}
		
		modifier = {
			factor = 4
			ROOT = {
				distance_from_realm = { who = FROM value = 120 }
			}
		}
	}

	ai_will_do = {
		factor = 1
		
		modifier = {
			factor = 0.1 # Low prio CB
		}
		
		modifier = {
			factor = 0.1 # Target has almost no money
			FROM = {
				OR = {
					is_nomadic = yes
					is_tribal = yes
				}
			}
		}

		modifier = {
			factor = 4
			ROOT = {
				trait = greedy
			}
		}
	}
}

#64
powerful_vassal_takeover_war = { # Started from faction
	name = CB_NAME_POWERFUL_VASSAL_TAKEOVER
	war_name = WAR_NAME_POWERFUL_VASSAL_TAKEOVER
	sprite = 6
	truce_days = 3650
	can_call_allies = no
	can_ask_to_join_war = no
	major_revolt = yes
	
	can_use_gui = {
		check_if_crusader_trigger = yes
	}

	can_use = {
		ROOT = {
			vassal_of = FROM
		}
	}
	
	can_use_title = {
		higher_tier_than = BARON
		is_primary_holder_title = yes
	}
	
	is_valid = {
		FROM = {
			in_revolt = no
			has_character_flag = powerful_vassal_takeover_target
		}
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = { 
					FROM = { 
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
	}

	on_add = {
		hidden_tooltip = { fire_haruspicy_event_effect = yes }
		flag_faction_revolt_title_effect = yes
	}

	on_success = {
		any_attacker = {
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
		destroy_faction_revolt_title_effect = yes
	}

	on_success_title = { #This is the target title of the faction
		increase_council_power_effect = yes
		increase_vassal_freedom_effect = yes
		increase_vassal_freedom_effect = yes
		if = {
			limit = { has_law = succession_voting_power_0 }
			add_law_w_cooldown = succession_voting_power_1
		}
		if = { 
			limit = { #Should not be changed from Imperial Elective
				NOT = {	has_law = succ_byzantine_elective }
			}
			custom_tooltip = {
				text = overthrow_text
				hidden_tooltip = {
					if = {
						limit = {							
							has_feudal_elective_succession_law = no
							has_law = law_voting_power_1
							has_law = banish_voting_power_1
							has_law = execution_voting_power_1
							has_law = revoke_title_voting_power_1
							has_law = grant_title_voting_power_1
							has_law = imprison_voting_power_1
							has_law = war_voting_power_1						
						}
						add_law_w_cooldown = succ_feudal_elective
					}
					if = {
						limit = {
							NOT = { has_law = succ_gavelkind }
							has_feudal_elective_succession_law = no
							NAND = {
								has_law = succ_feudal_elective
								has_law = law_voting_power_1
								has_law = banish_voting_power_1
								has_law = execution_voting_power_1
								has_law = revoke_title_voting_power_1
								has_law = grant_title_voting_power_1
								has_law = imprison_voting_power_1
								has_law = war_voting_power_1						
							}
						}
						add_law_w_cooldown = succ_gavelkind
					}
				}
			}
		}
		holder_scope = {
			clr_character_flag = powerful_vassal_takeover_target
			most_popular_vassal = {
				limit = {
					higher_tier_than = BARON
					is_feudal = yes
					prisoner = no
					NOR = {
						is_inaccessible_trigger = yes
						trait = incapable
						trait = eunuch
					}
					age = 16
					#can_hold_title = PREVPREV
					OR = {
						is_female = no
						AND = {
							is_female = yes
							ROOT = { has_law = true_cognatic_succession }
						}
					}
				}
				usurp_title = {
					target = PREVPREV
					type = faction_demand
				}
				save_event_target_as = new_title_holder
				hidden_tooltip = {
					any_attacker = {
						limit = { NOT = { character = PREV } }
						set_character_flag = helped_win_war
					}
				}
				character_event = { id = 8226 days = 1 }
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		
		FROM = {
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_powerful_vassal_takeover_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		FROM = { 
			hidden_tooltip = { 
				disband_event_forces = faction_loyalists
				clr_character_flag = powerful_vassal_takeover_target
			}
		}
		destroy_faction_revolt_title_effect = yes
	}

	on_reverse_demand = {
		ROOT = {
			prestige = -200
			prisoner = FROM
		}

		
		FROM = {
			participation_scaled_prestige = 100
			hidden_tooltip = { 
				if = { 
					limit = { NOT = { has_opinion_modifier = { modifier = opinion_traitor who = ROOT } } } #Allow free revocation of a title.
					opinion = {
						who = ROOT
						modifier = opinion_traitor
					}
				}
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_powerful_vassal_takeover_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		FROM = { 
			hidden_tooltip = { 
				disband_event_forces = faction_loyalists
				clr_character_flag = powerful_vassal_takeover_target
			}
		}
		destroy_faction_revolt_title_effect = yes
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

### SUCCESSION CRISIS CBs - POSSIBLY OBSOLETE? ###
succession_on_liege = {
	name = CB_NAME_SUCCESSION
	war_name = WAR_NAME_SUCCESSION
	sprite = 13
	truce_days = 1095
	hostile_against_others = yes
	press_claim = yes
	can_call_vassals = yes

	allow_whitepeace = no
	
	can_use = {
	}

	is_valid_title = {
		FROM = {
			has_landed_title = PREV
		}
	}
	
	on_success = {
		FROM = {
			prestige = -100
			any_demesne_title = {
				limit = {
					tier = FROM
				}
				usurp_title_plus_barony_if_unlanded = ROOT
			}
		}
		ROOT = {
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
	}
	
	on_success_title = {
		if = {
			limit = {
				OR = {
					tier = king
					tier = emperor
				}
#				is_titular = no
				NOT = { has_law = crown_authority_0 }
			}
			if = {
				limit = { has_law = crown_authority_1 }
				add_law = crown_authority_0
			}
			if = {
				limit = { has_law = crown_authority_2 }
				add_law = crown_authority_1
			}
			if = {
				limit = { has_law = crown_authority_3 }
				add_law = crown_authority_2
			}
			if = {
				limit = { has_law = crown_authority_4 }
				add_law = crown_authority_3
			}
		}
	}
	
	on_fail = {
		ROOT = {
			prestige = -50
		}
		FROM = {
			prestige = 50
		}
	}

	on_reverse_demand = {
		ROOT = {
			imprison = FROM
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_reverse_demand_title = {
		ROOT = {
			remove_claim = PREV
		}
	}
	
	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 150
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
}
other_succession = {
	name = CB_NAME_SUCCESSION
	war_name = WAR_NAME_OTHER_SUCCESSION
	sprite = 14
	truce_days = 1095
	hostile_against_others = yes
	press_claim = yes
	can_call_vassals = yes

	allow_whitepeace = no
	
	can_use = {
	}

	can_use_title = {
		OR = {
			ROOT = { is_female = no }
			NOT = { has_law = agnatic_succession }
			AND = {
				lower_tier_than = KING
				is_primary_holder_title = no
			}
		}
	}

	is_valid_title = {

		FROM = {
			has_landed_title = PREV
		}
	}

	on_success = {
		ROOT = {
			opinion = {
				modifier = pressed_my_claim 
				who = PREV
			}
		}
		prestige = 50
		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_success_title = {
		usurp_title_plus_barony_if_unlanded = ROOT
		if = {
			limit = {
				OR = {
					tier = king
					tier = emperor
				}
#				is_titular = no
				NOT = { has_law = crown_authority_0 }
			}
			if = {
				limit = { has_law = crown_authority_1 }
				add_law = crown_authority_0
			}
			if = {
				limit = { has_law = crown_authority_2 }
				add_law = crown_authority_1
			}
			if = {
				limit = { has_law = crown_authority_3 }
				add_law = crown_authority_2
			}
			if = {
				limit = { has_law = crown_authority_4 }
				add_law = crown_authority_3
			}
		}
	}

	on_success_posttitle = {
		hidden_tooltip = {
			if = {
				limit = {
					top_liege = {
						ROOT = {
							NOT = {
								top_liege = {
									character = PREVPREV
								}
							}
						}
					}
				}

				ROOT = {
					set_defacto_liege = PREV
				}
			}

			if = {
				limit = {
					top_liege = {
						ROOT = {
							NOT = {
								top_liege = {
									character = PREVPREV
								}
							}
						}
					}
				}

				ROOT = {
					set_defacto_liege = ROOT
				}
			}
		}
	}
	
	on_fail = {
		prestige = -50
		FROM = {
			prestige = 50
		}
	}

	on_reverse_demand = {
		prestige = -200

		ROOT = {
			imprison = FROM
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_reverse_demand_title = {
		ROOT = {
			remove_claim = PREV
		}
	}
	
	on_defender_leader_death = {
		hidden_tooltip = {
			any_attacker = {
				letter_event = {
					id = 251
				}
			}
		}
		
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
}
other_succession_on_liege = {
	name = CB_NAME_SUCCESSION
	war_name = WAR_NAME_OTHER_SUCCESSION
	sprite = 15
	truce_days = 1095
	hostile_against_others = yes
	press_claim = yes
	can_call_vassals = yes

	allow_whitepeace = no
	
	can_use = {
	}

	can_use_title = {
		OR = {
			ROOT = { is_female = no }
			NOT = { has_law = agnatic_succession }
			AND = {
				lower_tier_than = KING
				is_primary_holder_title = no
			}
		}
	}

	is_valid_title = {
		FROM = {
			has_landed_title = PREV
		}
	}
	
	on_success = {
		ROOT = {
			opinion = {
				modifier = pressed_my_claim 
				who = PREV
			}
		}
		
		# If the claimant has the wrong government type, take care of that first.
		if = {
			limit = {
				FROM = {
					primary_title = {
						higher_tier_than = ROOT
					}
					is_feudal = yes
				}
				ROOT = {
					is_ruler = yes
					OR = {
						is_theocracy = yes
						is_republic = yes
					}
				}
			}
			ROOT = { abdicate = yes }
		}
		
		FROM = {
			any_demesne_title = {
				limit = {
					tier = FROM
				}
				usurp_title_plus_barony_if_unlanded = ROOT
			}
		}
		
		ROOT = {
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_success_title = {
		if = {
			limit = {
				OR = {
					tier = king
					tier = emperor
				}
#				is_titular = no
				NOT = { has_law = crown_authority_0 }
			}
			if = {
				limit = { has_law = crown_authority_1 }
				add_law = crown_authority_0
			}
			if = {
				limit = { has_law = crown_authority_2 }
				add_law = crown_authority_1
			}
			if = {
				limit = { has_law = crown_authority_3 }
				add_law = crown_authority_2
			}
			if = {
				limit = { has_law = crown_authority_4 }
				add_law = crown_authority_3
			}
		}
	}

	on_success_posttitle = {
		hidden_tooltip = {
			if = {
				limit = {
					top_liege = {
						ROOT = {
							NOT = {
								top_liege = {
									character = PREVPREV
								}
							}
						}
					}
				}

				ROOT = {
					set_defacto_liege = PREV
				}
			}

			if = {
				limit = {
					top_liege = {
						ROOT = {
							NOT = {
								top_liege = {
									character = PREVPREV
								}
							}
						}
					}
				}

				ROOT = {
					set_defacto_liege = ROOT
				}
			}
		}
	}
	
	on_fail = {
		prestige = -50
		FROM = {
			prestige = 50
		}
	}

	on_reverse_demand = {
		prestige = -200
		imprison = FROM

		ROOT = {
			imprison = FROM
		}
		FROM = {
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_reverse_demand_title = {
		ROOT = {
			remove_claim = PREV
		}
	}
	
	on_defender_leader_death = {
		hidden_tooltip = {
			any_attacker = {
				letter_event = {
					id = 251
				}
			}
		}
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 95
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 95
	}
}
