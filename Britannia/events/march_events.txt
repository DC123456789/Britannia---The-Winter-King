#########################################################
#
# 	MARCH EVENTS
#
# 	Id 320900 - 320999 reserved	
#
#########################################################

# Creation of the Breton March
narrative_event = {
	id = 320900
	title = "EVTNAME320900"
	desc = "EVTDESC320900"
	major = yes
	hide_new = yes
	
	picture = "GFX_evt_castle_gate"
	
	is_triggered_only = yes
	
	immediate = {
		liege = { save_event_target_as = ROOT_liege }
		
		grant_title = k_breton_march
		k_breton_march = { set_title_flag = is_march }
		set_defacto_liege = THIS
		event_target:ROOT_liege = {
			make_tributary = { who = ROOT tributary_type = march }
			hidden_tooltip = {
				any_vassal = {
					limit = {
						primary_title = {
							OR = {
								AND = {
									tier = DUKE
									capital_scope = {
										region = custom_breton_march
									}
								}
								AND = {
									tier = COUNT
									location = {
										region = custom_breton_march
									}
								}
							}
						}
					}
					set_defacto_liege = ROOT
				}
			}
		}
		
		if = {
			limit = { liege = { can_create_germanic_title_trigger = yes } }
			d_nantes = { de_jure_liege = k_breton_march }
			d_rennes = { de_jure_liege = k_breton_march }
			d_bretagne = { de_jure_liege = k_breton_march }
			d_penthievre = { de_jure_liege = k_breton_march }
			d_cornouaille = { de_jure_liege = k_breton_march }
			
			set_global_flag = germanic_breton_march
			if = {
				limit = { 
					has_global_flag = western_roman_empire_fallen
					NOT = { has_global_flag = franks_defeated }
				}
				k_breton_march = { de_jure_liege = e_franks }
			}
			else = {
				k_breton_march = { de_jure_liege = e_gaul }
			}
		}
		else = {
			# Alternative de jure if formed by a Romanized Germanic			
			if = {
				limit = { liege = { has_landed_title = e_visigoths } }
				k_breton_march = { de_jure_liege = e_visigoths }
			}
			else_if = {
				limit = { liege = { has_landed_title = e_gaul } }		# Shouldn't ever happen, but maybe?
				k_breton_march = { de_jure_liege = e_gaul }
			}
			else_if = {
				limit = { liege = { has_landed_title = e_roman_britannia } }		# Shouldn't ever happen, but maybe?
				k_breton_march = { de_jure_liege = e_roman_britannia }
			}
			else = {
				k_breton_march = { de_jure_liege = 0 }
			}
			
			k_breton_march = {
				any_title = {		# Should really be random_title, but that apparently doesn't exist
					limit = {
						OR = {
							title = d_redonia
							title = d_namnetia
							title = d_broerec
							title = d_domnonea
							title = d_poher
							title = d_finis_terrae
						}
						can_drift_into_march = yes
					}
					de_jure_liege = k_breton_march
					set_title_flag = under_march_k_breton_march
				}
			}
		}		
		
		set_global_flag = breton_march_created
	}
	
	option = {
		name = "EVTOPTA320900"
		trigger = {
			NOR = {
				culture = armorican
				culture = breton
			}			
		}
	}
	
	option = {
		name = "EVTOPTB320900"
		trigger = {
			OR = {
				culture = armorican
				culture = breton
			}
		}
	}
}

# Creation of the Duchy of Vasconia
narrative_event = {
	id = 320901
	title = "EVTNAME320901"
	desc = "EVTDESC320901"
	major = yes
	hide_new = yes
	
	picture = "GFX_evt_castle_river"
	
	is_triggered_only = yes
	
	immediate = {
		liege = { save_event_target_as = ROOT_liege }		
		grant_title = k_vasconia
		k_vasconia = { set_title_flag = is_march }
		set_defacto_liege = THIS
		event_target:ROOT_liege = {
			make_tributary = { who = ROOT tributary_type = march }
			hidden_tooltip = {
				any_vassal = {
					limit = {
						primary_title = {
							OR = {
								AND = {
									tier = DUKE
									capital_scope = {
										region = custom_vasconia_gaul
									}
								}
								AND = {
									tier = COUNT
									location = {
										region = custom_vasconia_gaul
									}
								}
							}
						}
					}
					set_defacto_liege = ROOT
				}
			}
		}
		
		d_saintes = { de_jure_liege = k_aquitaine }
		d_angouleme = { de_jure_liege = k_aquitaine }
		d_perigord = { de_jure_liege = k_aquitaine }
		d_agen = { de_jure_liege = k_aquitaine }
		if = {
			limit = { liege = { can_create_germanic_title_trigger = yes } }
			# In case they were re-assigned to Aquitaine earlier
			d_bordeaux = { de_jure_liege = k_vasconia }
			d_fezensac = { de_jure_liege = k_vasconia }
			d_comminges = { de_jure_liege = k_vasconia }
			d_bigorre = { de_jure_liege = k_vasconia }
			d_marsan = { de_jure_liege = k_vasconia }
			d_bazas = { de_jure_liege = k_vasconia }
			d_bearn = { de_jure_liege = k_vasconia }
			d_dax = { de_jure_liege = k_vasconia }
			d_vasconia_citerior = { de_jure_liege = k_vasconia }
			
			set_global_flag = germanic_vasconia
			if = {
				limit = { 
					has_global_flag = western_roman_empire_fallen
					NOT = { has_global_flag = franks_defeated }
				}
				k_vasconia = { de_jure_liege = e_franks }
			}
			else = {
				k_vasconia = { de_jure_liege = e_gaul }
			}
			k_vasconia = {
				set_name = ""
				adjective = ""
			}
		}
		else = {
			# Alternative de jure if formed by a Romanized Germanic			
			if = {
				limit = { liege = { has_landed_title = e_visigoths } }
				k_vasconia = { de_jure_liege = e_visigoths }
			}
			else_if = {
				limit = { liege = { has_landed_title = e_gaul } }		# Shouldn't ever happen, but maybe?
				k_vasconia = { de_jure_liege = e_gaul }
			}
			else_if = {
				limit = { liege = { has_landed_title = e_roman_britannia } }		# Shouldn't ever happen, but maybe?
				k_vasconia = { de_jure_liege = e_roman_britannia }
			}
			else = {
				k_vasconia = { de_jure_liege = 0 }
			}
			
			k_vasconia = {
				any_title = {
					limit = {
						OR = {
							title = d_viviscia
							title = d_elusatia
							title = d_auscia
							title = d_lactoratia
							title = d_convenia
							title = d_consorannia
							title = d_bigerria
							title = d_aturensia
							title = d_vasatia
							title = d_benearia
							title = d_iluronensia
							title = d_boiatia
							title = d_tarbellia
						}
						can_drift_into_march = yes
					}
					de_jure_liege = k_vasconia
					set_title_flag = under_march_k_vasconia
				}
			}
			
			# Give to Aquitaine so we don't have the awkward situation where Germanic duchies are under the wrong different empire
			d_bordeaux = { de_jure_liege = k_aquitaine }
			d_fezensac = { de_jure_liege = k_aquitaine }
			d_comminges = { de_jure_liege = k_aquitaine }
			d_bigorre = { de_jure_liege = k_aquitaine }
			d_marsan = { de_jure_liege = k_aquitaine }
			d_bazas = { de_jure_liege = k_aquitaine }
			d_bearn = { de_jure_liege = k_aquitaine }
			d_dax = { de_jure_liege = k_aquitaine }
			d_vasconia_citerior = { de_jure_liege = k_aquitaine }
			
			k_vasconia = {
				set_name = "Vasconia"
				adjective = "Vasconian"
			}
		}		
		
		set_global_flag = vasconia_created
	}
	
	option = {
		name = "EVTOPTA320901"
		trigger = {
			NOT = { culture_group = basque }			
		}
	}
	
	option = {
		name = "EVTOPTB320901"
		trigger = {
			culture_group = basque
		}
	}
}

# 320902 TODO Creation of the Welsh March

# 320903 TODO Creation of the Pictish March

# 320904 TODO Creation of the Limes Caledonicus

# 320910 TODO Welsh March -> Earldom of Wales

# 320911 TODO Pictish March -> Earldom of Pictland


# March de jure removal
# TODO Update with other marches
character_event = {
	id = 320919
	desc = "You're not supposed to see this..."	
	picture = "GFX_evt_castle_hill"	
	hide_window = yes
	
	only_playable = yes
	
	trigger = {
		has_landed_title = k_nuncio_britanniae
		OR = {
			k_breton_march = { 
				has_holder = no
				has_title_flag = is_march
				has_global_flag = breton_march_created
			}
			k_vasconia = { 
				has_holder = no
				has_title_flag = is_march
				has_global_flag = vasconia_created
			}
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		if = {
			limit = {
				k_breton_march = { 
					has_holder = no
					has_title_flag = is_march
					has_global_flag = breton_march_created
				}
			}
			if = {
				limit = { 
					has_global_flag = western_roman_empire_fallen
					NOT = { has_global_flag = franks_defeated }
				}
				k_breton_march = { de_jure_liege = e_franks }
			}
			else = {
				k_breton_march = { de_jure_liege = e_gaul }
			}
			
			# Needs to be before, as otherwise k_breton_march won't have any more de jure duchies remaining
			k_breton_march = {
				any_direct_de_jure_vassal_title = {
					clear_title_flag = under_march_k_breton_march
				}
			}
			
			if = {
				limit = { has_global_flag = germanic_breton_march }
				if = {
					limit = { has_global_flag = saxon_nantes }
					d_nantes = { de_jure_liege = k_saxon_gaul }
				}
				else = {
					d_nantes = { de_jure_liege = k_orleans }
				}
				if = {
					limit = { has_global_flag = saxon_rennes }
					d_rennes = { de_jure_liege = k_saxon_gaul }
				}
				else = {
					d_rennes = { de_jure_liege = k_orleans }
				}
				if = {
					limit = { has_global_flag = saxon_bretagne }
					d_bretagne = { de_jure_liege = k_saxon_gaul }
				}
				else = {
					d_bretagne = { de_jure_liege = k_orleans }
				}
				if = {
					limit = { has_global_flag = saxon_penthievre }
					d_penthievre = { de_jure_liege = k_saxon_gaul }
				}
				else = {
					d_penthievre = { de_jure_liege = k_orleans }
				}
				if = {
					limit = { has_global_flag = saxon_cornouaille }
					d_cornouaille = { de_jure_liege = k_saxon_gaul }
				}
				else = {
					d_cornouaille = { de_jure_liege = k_orleans }
				}
			}
			else = {
				k_breton_march = {
					any_direct_de_jure_vassal_title = {
						return_march_duchy_to_original_de_jure_liege_effect = yes
					}
				}
			}
			
			clr_global_flag = breton_march_created
			clr_global_flag = germanic_breton_march
		}
		if = {
			limit = {
				k_vasconia = { 
					has_holder = no
					has_title_flag = is_march
					has_global_flag = vasconia_created
				}
			}
			if = {
				limit = { 
					has_global_flag = western_roman_empire_fallen
					NOT = { has_global_flag = franks_defeated }
				}
				k_vasconia = { de_jure_liege = e_franks }
			}
			else = {
				k_vasconia = { de_jure_liege = e_gaul }
			}
			
			# Needs to be before, as otherwise k_vasconia won't have any more de jure duchies remaining
			k_vasconia = {
				any_direct_de_jure_vassal_title = {
					clear_title_flag = under_march_k_vasconia
				}
			}
			
			if = {
				limit = { NOT = { has_global_flag = germanic_vasconia } }
				k_vasconia = {
					any_direct_de_jure_vassal_title = {
						set_title_flag = target_duchy
						return_march_duchy_to_original_de_jure_liege_effect = yes
					}
				}
			}
			k_vasconia = {
				set_name = ""
				adjective = ""
			}
			
			clr_global_flag = vasconia_created
			clr_global_flag = germanic_vasconia
		}
	}
}

# Romanized Breton March duchy de jure shift event
# TODO Romanized Welsh March duchy de jure shifts
# TODO Romanized Pictish March duchy de jure shifts
character_event = {
	id = 320920
	desc = "You're not supposed to see this..."	
	picture = "GFX_evt_castle_gate"
	hide_window = yes
	
	only_playable = yes
	
	trigger = {
		is_alternate_start = no
		OR = {
			AND = {
				has_landed_title = k_breton_march
				NOT = { has_global_flag = germanic_breton_march }
				k_breton_march = {
					OR = {
						d_redonia = { can_drift_into_march = yes }
						d_namnetia = { can_drift_into_march = yes }
						d_broerec = { can_drift_into_march = yes }
						d_domnonea = { can_drift_into_march = yes }
						d_poher = { can_drift_into_march = yes }
						d_finis_terrae = { can_drift_into_march = yes }
					}
				}
			}
			AND = {
				has_landed_title = k_vasconia
				NOT = { has_global_flag = germanic_vasconia }
				k_vasconia = {
					OR = {
						d_viviscia = { can_drift_into_march = yes }
						d_elusatia = { can_drift_into_march = yes }
						d_auscia = { can_drift_into_march = yes }
						d_lactoratia = { can_drift_into_march = yes }
						d_convenia = { can_drift_into_march = yes }
						d_consorannia = { can_drift_into_march = yes }
						d_bigerria = { can_drift_into_march = yes }
						d_aturensia = { can_drift_into_march = yes }
						d_vasatia = { can_drift_into_march = yes }
						d_benearia = { can_drift_into_march = yes }
						d_iluronensia = { can_drift_into_march = yes }
						d_boiatia = { can_drift_into_march = yes }
						d_tarbellia = { can_drift_into_march = yes }
					}
				}
			}
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		if = {
			limit = { is_tributary = { type = march } }
			suzerain = { primary_title = { save_event_target_as = march_suzerain_title } }
		}
		
		if = {
			limit = {
				has_landed_title = k_breton_march
				NOT = { has_global_flag = germanic_breton_march }
				k_breton_march = {
					OR = {
						d_redonia = { can_drift_into_march = yes }
						d_namnetia = { can_drift_into_march = yes }
						d_broerec = { can_drift_into_march = yes }
						d_domnonea = { can_drift_into_march = yes }
						d_poher = { can_drift_into_march = yes }
						d_finis_terrae = { can_drift_into_march = yes }
					}
				}
			}
			k_breton_march = { 
				save_event_target_as = kingdom_to_de_jure_drift_to
				any_title = {		# Should really be random_title, but that apparently doesn't exist
					limit = {
						OR = {
							title = d_redonia
							title = d_namnetia
							title = d_broerec
							title = d_domnonea
							title = d_poher
							title = d_finis_terrae
						}
						can_drift_into_march = yes
					}
					save_event_target_as = duchy_to_de_jure_drift
				}
			}
		}
		else_if = {
			limit = {
				has_landed_title = k_vasconia
				NOT = { has_global_flag = germanic_vasconia }
				k_vasconia = {
					OR = {
						d_viviscia = { can_drift_into_march = yes }
						d_elusatia = { can_drift_into_march = yes }
						d_auscia = { can_drift_into_march = yes }
						d_lactoratia = { can_drift_into_march = yes }
						d_convenia = { can_drift_into_march = yes }
						d_consorannia = { can_drift_into_march = yes }
						d_bigerria = { can_drift_into_march = yes }
						d_aturensia = { can_drift_into_march = yes }
						d_vasatia = { can_drift_into_march = yes }
						d_benearia = { can_drift_into_march = yes }
						d_iluronensia = { can_drift_into_march = yes }
						d_boiatia = { can_drift_into_march = yes }
						d_tarbellia = { can_drift_into_march = yes }
					}
				}
			}
			k_vasconia = { 
				save_event_target_as = kingdom_to_de_jure_drift_to
				any_title = {		# Should really be random_title, but that apparently doesn't exist
					limit = {
						OR = {
							title = d_viviscia
							title = d_elusatia
							title = d_auscia
							title = d_lactoratia
							title = d_convenia
							title = d_consorannia
							title = d_bigerria
							title = d_aturensia
							title = d_vasatia
							title = d_benearia
							title = d_iluronensia
							title = d_boiatia
							title = d_tarbellia
						}
						can_drift_into_march = yes
					}
					save_event_target_as = duchy_to_de_jure_drift
				}
			}
		}
		
		event_target:duchy_to_de_jure_drift = { 
			de_jure_liege = event_target:kingdom_to_de_jure_drift_to 
			set_title_flag = under_march_@event_target:kingdom_to_de_jure_drift_to
		}
		
		any_player = {
			character_event = { id = 320921 }
		}		
	}
}

# Player notification event (major events don't interact properly with event targets)
# TODO Update with possible march titles
narrative_event = {
	id = 320921
	title = "EVTNAME320921"
	desc = {
		trigger = {
			FROM = { is_tributary = { type = march } }
		}
		text = EVTDESC320921_march
	}
	desc = {
		trigger = {
			NOT = { FROM = { is_tributary = { type = march } } }
		}
		text = EVTDESC320921_not_march
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_redonia } } 
		picture = GFX_evt_fields_landscape
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_namnetia } } 
		picture = GFX_evt_castle_river
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_broerec } } 
		picture = GFX_evt_forest_light
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_domnonea } } 
		picture = GFX_evt_dusk_forest
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_poher } } 
		picture = GFX_evt_forest
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_finis_terrae } } 
		picture = GFX_evt_somerset_coast
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_viviscia } } 
		picture = GFX_evt_rivers_landscape
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_elusatia } } 
		picture = GFX_evt_lord_overlooking_bridge
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_auscia } } 
		picture = GFX_evt_river_town
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_lactoratia } } 
		picture = GFX_evt_castle_river
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_convenia } } 
		picture = GFX_evt_highlands_landscape
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_consorannia } } 
		picture = GFX_evt_castle_grass_hill
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_bigerria } } 
		picture = GFX_evt_hills_woodland
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_aturensia } } 
		picture = GFX_evt_castle_gate
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_vasatia } } 
		picture = GFX_evt_fields_landscape
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_benearia } } 
		picture = GFX_evt_castle_river
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_iluronensia } } 
		picture = GFX_evt_castle_hill
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_boiatia } } 
		picture = GFX_evt_coastal_village
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_tarbellia } } 
		picture = GFX_evt_lord_overlooking_bridge
	}
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTA320921"
	}
}

# Romanized Germanic march duchy de jure removal event
# TODO Add other marches
character_event = {
	id = 320922
	desc = "You're not supposed to see this..."	
	picture = "GFX_evt_castle_gate"
	hide_window = yes
	
	only_playable = yes
	
	trigger = {
		is_alternate_start = no
		OR = {
			AND = {
				NOT = { has_global_flag = germanic_breton_march }
				k_breton_march = {
					any_direct_de_jure_vassal_title = {
						can_drift_out_of_breton_march = yes		
					}
				}
			}
			AND = {
				NOT = { has_global_flag = germanic_vasconia }
				k_vasconia = {
					any_direct_de_jure_vassal_title = {
						can_drift_out_of_vasconia = yes		
					}
				}
			}
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		if = {
			limit = {
				NOT = { has_global_flag = germanic_breton_march }
				k_breton_march = {
					any_direct_de_jure_vassal_title = {
						can_drift_out_of_breton_march = yes		
					}
				}
			}
			k_breton_march = { 
				save_event_target_as = kingdom_to_de_jure_drift_out_of
			}
			
			event_target:kingdom_to_de_jure_drift_out_of = {
				random_direct_de_jure_vassal_title = {
					limit = { can_drift_out_of_breton_march = yes }
					save_event_target_as = duchy_to_de_jure_drift
				}
			}
		}
		else_if = {
			limit = {
				NOT = { has_global_flag = germanic_vasconia }
				k_vasconia = {
					any_direct_de_jure_vassal_title = {
						can_drift_out_of_vasconia = yes		
					}
				}
			}
			k_vasconia = { 
				save_event_target_as = kingdom_to_de_jure_drift_out_of
			}
			
			event_target:kingdom_to_de_jure_drift_out_of = {
				random_direct_de_jure_vassal_title = {
					limit = { can_drift_out_of_vasconia = yes }
					save_event_target_as = duchy_to_de_jure_drift
				}
			}
		}
		
		event_target:duchy_to_de_jure_drift = { 
			return_march_duchy_to_original_de_jure_liege_effect = yes
			clr_title_flag = under_march_@event_target:kingdom_to_de_jure_drift_out_of
		}
		
		any_player = {
			character_event = { id = 320923 }
		}
		
	}
}

# Player notification event (major events don't interact properly with event targets)
# TODO Add other marches
narrative_event = {
	id = 320923
	title = "EVTNAME320923"
	desc = EVTDESC320923
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_redonia } } 
		picture = GFX_evt_fields_landscape
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_namnetia } } 
		picture = GFX_evt_castle_river
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_broerec } } 
		picture = GFX_evt_forest_light
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_domnonea } } 
		picture = GFX_evt_dusk_forest
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_poher } } 
		picture = GFX_evt_forest
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_finis_terrae } } 
		picture = GFX_evt_somerset_coast
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_viviscia } } 
		picture = GFX_evt_rivers_landscape
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_elusatia } } 
		picture = GFX_evt_lord_overlooking_bridge
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_auscia } } 
		picture = GFX_evt_river_town
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_lactoratia } } 
		picture = GFX_evt_castle_river
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_convenia } } 
		picture = GFX_evt_highlands_landscape
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_consorannia } } 
		picture = GFX_evt_castle_grass_hill
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_bigerria } } 
		picture = GFX_evt_hills_woodland
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_aturensia } } 
		picture = GFX_evt_castle_gate
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_vasatia } } 
		picture = GFX_evt_fields_landscape
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_benearia } } 
		picture = GFX_evt_castle_river
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_iluronensia } } 
		picture = GFX_evt_castle_hill
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_boiatia } } 
		picture = GFX_evt_coastal_village
	}
	picture = { 
		trigger = { event_target:duchy_to_de_jure_drift = { title = d_tarbellia } } 
		picture = GFX_evt_lord_overlooking_bridge
	}
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTA320923"
	}
}

# Notification event for granting title to march
diploresponse_event = {
	id = 320925

	is_triggered_only = yes
	major = no
	is_friendly = yes

	trigger = {
		ai = no
	}

	desc = "EVTDESC320925"

	option = {
		name = "OK"
	}
}

# Notification event for transferring vassal to march
diploresponse_event = {
	id = 320926

	is_triggered_only = yes
	major = no
	is_friendly = yes

	trigger = {
		ai = no
	}

	desc = "EVTDESC320926"

	option = {
		name = "OK"
	}
}

diploresponse_event = {
	id = 320927

	is_triggered_only = yes
	major = no
	is_friendly = yes

	trigger = {
		ai = no
	}

	desc = "EVTDESC320927"

	option = {
		name = "OK"
	}
}

# Receive demand to revoke march
letter_event = {
	id = 320930
	desc = "EVTDESC320930"
	picture = "GFX_evt_emissary"
	
	only_rulers = yes
	
	is_triggered_only = yes
	
	option = {			# Accept
		name = "Yes"
		prestige = -50
		reverse_opinion = {
			modifier = opinion_approves
			who = FROMFROM
			years = 10
		}
		FROMFROM = { 
			character_event = { id = 320931 }
		}
		tooltip = {
			FROMFROM = { 
				remove_tributary = ROOT 
			}
			any_demesne_title = {
				limit = {
					has_title_flag = is_march
				}
				show_scope_change = no
				destroy_landed_title = THIS
			}
			set_defacto_liege = FROMFROM
		}
		hidden_tooltip = {
			opinion = {
				modifier = opinion_revoked_my_title
				who = FROMFROM
				years = 20
			}
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { has_character_flag = will_give_up_march }
			}
		}
	}
	
	option = {			# Reject
		name = "No"
		# Can't resist if you're a prisoner
		trigger = {
			OR = {
				prisoner = no
				NOT = { host = { character = FROMFROM } }
			}
		}
		prestige = 50
		reverse_opinion = {
			modifier = opinion_furious
			who = FROMFROM
			years = 10
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				has_character_flag = will_give_up_march
			}
		}
		FROMFROM = { character_event = { id = 320932 } }
		war = {
			casus_belli = free_tributary_cb_liege_claim
			target = FROMFROM					
		}
	}
	
	after = {
		clr_character_flag = will_give_up_march
	}
}

# March revokation accepted
diploresponse_event = {
	id = 320931
	desc = "EVTDESC320931"

	is_triggered_only = yes
	major = no
	is_friendly = yes

	trigger = {
		#ai = no
	}

	option = {
		name = "OK"
		FROM = {
			show_scope_change = no
			remove_tributary = FROM
			hidden_tooltip = {
				any_vassal = {
					limit = { defacto_liege_title = { has_title_flag = is_march } }
					set_defacto_liege = ROOT
				}
			}
			any_demesne_title = {
				limit = {
					has_title_flag = is_march
				}
				show_scope_change = no
				destroy_landed_title = THIS
			}
			set_defacto_liege = ROOT
		}
		hidden_tooltip = { k_nuncio_britanniae = { holder_scope = { character_event = { id = 320919 } } } }		# De jure effects
	}
}

# March revokation refused
diploresponse_event = {
	id = 320932
	desc = "EVTDESC320932"

	is_triggered_only = yes
	major = no
	is_hostile = yes

	trigger = {
		ai = no
	}

	option = {
		name = "OK"
	}
}

# Event when march becomes independent
character_event = {
	id = 320935
	title = "EVTNAME320935"
	desc = "EVTDESC320935"
	
	picture = "GFX_evt_castle_gate"
	only_independent = yes
	
	trigger = {
		any_demesne_title = {
			has_title_flag = is_march
			NOT = { has_title_flag = is_independent_march }
		}
		NOR = { 
			is_tributary = { type = march } 
			any_war = {
				defender = {
					character = ROOT
				}
				using_cb = tributary_march_cb
			}
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		any_demesne_title = {
			limit = {
				has_title_flag = is_march
				NOT = { has_title_flag = is_independent_march }
			}
			set_title_flag = is_independent_march
		}
	}
	
	option = {
		name = "EVTOPTA320935"
		custom_tooltip = {
			text = EVTOPTA320935TT
		}
	}
}

# Notification event for former suzerain when march becomes independent
character_event = {
	id = 320936
	title = "EVTNAME320936"
	desc = "EVTDESC320936"
	
	picture = "GFX_evt_castle_hill"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTA320936"
		custom_tooltip = {
			text = EVTOPTA320936TT
		}
	}
}

# March has been independent for long enough, becomes a proper title
character_event = {
	id = 320937
	title = "EVTNAME320937"
	desc = "EVTDESC320937"
	
	picture = "GFX_evt_royal_court"
	only_independent = yes
	
	is_triggered_only = yes
	
	trigger = {
		any_demesne_title = {
			has_title_flag = is_march
			had_title_flag = {
				flag = is_independent_march
				years >= 35
			}
		}
		NOT = { is_tributary = { type = march } }
	}
	
	immediate = {
		any_demesne_title = {
			limit = {
				has_title_flag = is_march
				# had_title_flag = {
					# flag = is_independent_march
					# years >= 35
				# }
			}
			clr_title_flag = is_march
			clr_title_flag = is_independent_march
		}
	}
	
	option = {
		name = "EVTOPTA320937"
		custom_tooltip = {
			text = EVTOPTA320937TT
		}
	}
}

# Clear flag from marches that are re-vassalized
character_event = {
	id = 320938
	desc = "You're not supposed to see this..."	
	picture = "GFX_evt_castle_hill"	
	hide_window = yes
	
	only_playable = yes
	
	trigger = {
		any_demesne_title = {
			has_title_flag = is_march
			has_title_flag = is_independent_march
		}
		is_tributary = { type = march }
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		clr_title_flag = is_independent_march
	}
}

# If a march's suzerain is lower than king tier and no longer independent, the march is re-assigned to the liege
character_event = {
	id = 320940
	desc = "You're not supposed to see this..."	
	picture = "GFX_evt_castle_hill"	
	hide_window = yes
	
	only_playable = yes
	
	trigger = {
		is_tributary = { type = march }
		suzerain = {
			lower_tier_than = KING
			independent = no
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		suzerain = {
			remove_tributary = ROOT
			top_liege = {
				make_tributary = {
					who = ROOT
					tributary_type = march
				}
			}
		}
	}
}


# AI creation of marches
# TODO Need to add other marches
character_event = {
	id = 320945
	desc = "You're not supposed to see this..."
	
	picture = "GFX_evt_castle_gate"
	
	hide_window = yes
	only_independent = yes
	is_triggered_only = yes
	
	trigger = {
		are_dejure_changes_allowed_trigger = yes
		ai = yes
		is_tribal = no
		higher_tier_than = DUKE
		independent = yes
		OR = {
			AND = {
				NOR = {
					culture_group = imperiale
					culture_group = celtic
				}
				breton_march_province_control_with_resistance_trigger = yes
				NOT = {
					any_tributary = {
						has_landed_title = k_breton_march
					}
				}
				OR = {
					k_breton_march = { has_holder = no }
					has_landed_title = k_breton_march
				}
			}
			AND = {
				NOR = {
					culture_group = imperiale
					culture_group = basque
				}
				vasconia_province_control_with_resistance_trigger = yes
				NOT = {
					any_tributary = {
						has_landed_title = k_vasconia
					}
				}
				OR = {
					k_vasconia = { has_holder = no }
					has_landed_title = k_vasconia
				}
			}
		}
	}
	
	immediate = {
		# Breton March
		if = {
			limit = {			
				NOR = {
					culture_group = imperiale
					culture_group = celtic
				}
				breton_march_province_control_with_resistance_trigger = yes
				NOT = {
					any_tributary = {
						has_landed_title = k_breton_march
					}
				}
				OR = {
					k_breton_march = { has_holder = no }
					has_landed_title = k_breton_march
				}
			}
			any_vassal = {
				limit = {
					higher_tier_than = BARON
					NOR = {
						culture_group = imperiale
						culture_group = celtic
					}
					any_realm_province = {
						#OR = {
							region = custom_breton_march
							#any_neighbor_province = {
								#region = custom_breton_march
							#}
						#}
					}
				}
				score_value = {
					value = 1
					march_suitability_score = yes
				}
				count = 1
				set_character_flag = grant_breton_march
				character_event = { id = 320946 }
			}
		}
		# Vasconia
		else_if = {
			limit = {			
				NOR = {
					culture_group = imperiale
					culture_group = basque
				}
				vasconia_province_control_with_resistance_trigger = yes
				NOT = {
					any_tributary = {
						has_landed_title = k_vasconia
					}
				}
				OR = {
					k_vasconia = { has_holder = no }
					has_landed_title = k_vasconia
				}
			}
			any_vassal = {
				limit = {
					higher_tier_than = BARON
					NOR = {
						culture_group = imperiale
						culture_group = celtic
					}
					any_realm_province = {
						region = custom_vasconia_gaul
					}
				}
				score_value = {
					value = 1
					march_suitability_score = yes
				}
				count = 1
				set_character_flag = grant_vasconia
				character_event = { id = 320946 }
			}
		}
	}
}

# Bounce event to ensure correct scopes
character_event = {
	id = 320946
	desc = "You're not supposed to see this..."	
	picture = "GFX_evt_castle_gate"
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { has_character_flag = grant_breton_march }
			clr_character_flag = grant_breton_march
			character_event = { id = 320900 }
		}
		else_if = {
			limit = { has_character_flag = grant_vasconia }
			clr_character_flag = grant_vasconia
			character_event = { id = 320901 }
		}
		else_if = {
			limit = { has_character_flag = grant_welsh_march }
			clr_character_flag = grant_welsh_march
			character_event = { id = 320902 }
		}
		else_if = {
			limit = { has_character_flag = grant_pictish_march }
			clr_character_flag = grant_pictish_march
			character_event = { id = 320903 }
		}
		else_if = {
			limit = { has_character_flag = grant_limes_caledonicus }
			clr_character_flag = grant_limes_caledonicus
			character_event = { id = 320904 }
		}
	}
}
