#########################################################
#
# 	MARCH EVENTS
#
# 	Id 320900 - 320999 reserved	
#
#########################################################

# Creation of the Breton March
narrative_event = {
	id = 320900
	title = "EVTNAME320900"
	desc = "EVTDESC320900"
	major = yes
	hide_new = yes
	
	picture = "GFX_evt_castle_gate"
	
	is_triggered_only = yes
	
	immediate = {
		liege = { save_event_target_as = ROOT_liege }
		if = {
			limit = { liege = { can_create_germanic_title_trigger = yes } }
			d_nantes = { de_jure_liege = k_breton_march }
			d_rennes = { de_jure_liege = k_breton_march }
			d_bretagne = { de_jure_liege = k_breton_march }
			d_penthievre = { de_jure_liege = k_breton_march }
			d_cornouaille = { de_jure_liege = k_breton_march }
			
			if = {
				limit = { 
					has_global_flag = western_roman_empire_fallen
					NOT = { has_global_flag = franks_defeated }
				}
				k_breton_march = { de_jure_liege = e_franks }
			}
			else = {
				k_breton_march = { de_jure_liege = e_gaul }
			}
		}
		else = {
			# Alternative de jure if formed by a Romanized Germanic
			
			# TODO Trigger these only when the march takes full control of the duchy?
			# d_namnetia = { de_jure_liege = k_breton_march }
			# d_redonia = { de_jure_liege = k_breton_march }
			# d_broerec = { de_jure_liege = k_breton_march }
			# d_domnonea = { de_jure_liege = k_breton_march }
			# d_finis_terrae = { de_jure_liege = k_breton_march }
			# d_poher = { de_jure_liege = k_breton_march }
			
			if = {
				limit = { liege = { has_landed_title = e_visigoths } }
				# TODO Need to apply this when e_visigoths is formed as well, 
				# and remove it if e_visigoths is destroyed
				k_breton_march = { de_jure_liege = e_visigoths }
			}
			else = {
				k_breton_march = { de_jure_liege = 0 }
			}
		}		
		
		set_global_flag = breton_march_created
		
		grant_title = k_breton_march
		set_defacto_liege = THIS
		event_target:ROOT_liege = {
			make_tributary = { who = ROOT tributary_type = march }
			hidden_tooltip = {
				any_vassal = {
					limit = {
						primary_title = {
							OR = {
								AND = {
									tier = DUKE
									capital_scope = {
										region = custom_breton_march
									}
								}
								AND = {
									tier = COUNT
									location = {
										region = custom_breton_march
									}
								}
							}
						}
					}
					set_defacto_liege = ROOT
				}
			}
		}
	}
	
	option = {
		name = "EVTOPTA320900"
	}
}

# 320901 TODO Creation of the Duchy of Vasconia

# 320902 TODO Creation of the Welsh March

# 320903 TODO Creation of the Pictish March

# 320904 TODO Creation of the Limes Caledonicus

# 320910 TODO Welsh March -> Earldom of Wales

# 320911 TODO Pictish March -> Earldom of Pictland

# 320920 TODO AI creation of marches

# Notification event for granting title to march
diploresponse_event = {
	id = 320925

	is_triggered_only = yes
	major = no
	is_friendly = yes

	trigger = {
		ai = no
	}

	desc = "EVTDESC320925"

	option = {
		name = "OK"
	}
}

# Notification event for transferring vassal to march
diploresponse_event = {
	id = 320926

	is_triggered_only = yes
	major = no
	is_friendly = yes

	trigger = {
		ai = no
	}

	desc = "EVTDESC320926"

	option = {
		name = "OK"
	}
}

diploresponse_event = {
	id = 320927

	is_triggered_only = yes
	major = no
	is_friendly = yes

	trigger = {
		ai = no
	}

	desc = "EVTDESC320927"

	option = {
		name = "OK"
	}
}

# Receive demand to revoke march
letter_event = {
	id = 320930
	desc = "EVTDESC320930"
	picture = "GFX_evt_emissary"
	
	only_rulers = yes
	
	is_triggered_only = yes
	
	option = {			# Accept
		name = "Yes"
		prestige = -50
		reverse_opinion = {
			modifier = opinion_approves
			who = FROMFROM
			years = 10
		}
		FROMFROM = { 
			character_event = { id = 320931 }
		}
		tooltip = {
			FROMFROM = { 
				remove_tributary = ROOT 
			}
			any_demesne_title = {
				limit = {
					has_title_flag = is_march
				}
				show_scope_change = no
				destroy_landed_title = THIS
			}
			set_defacto_liege = FROMFROM
		}
		hidden_tooltip = {
			opinion = {
				modifier = opinion_revoked_my_title
				who = FROMFROM
				years = 20
			}
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				NOT = { has_character_flag = will_give_up_march }
			}
		}
	}
	
	option = {			# Reject
		name = "No"
		# Can't resist if you're a prisoner
		trigger = {
			OR = {
				prisoner = no
				NOT = { host = { character = FROMFROM } }
			}
		}
		prestige = 50
		reverse_opinion = {
			modifier = opinion_furious
			who = FROMFROM
			years = 10
		}
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				has_character_flag = will_give_up_march
			}
		}
		FROMFROM = { character_event = { id = 320932 } }
		war = {
			casus_belli = free_tributary_cb_liege_claim
			target = FROMFROM					
		}
	}
	
	after = {
		clr_character_flag = will_give_up_march
	}
}

# March revokation accepted
diploresponse_event = {
	id = 320931
	desc = "EVTDESC320931"

	is_triggered_only = yes
	major = no
	is_friendly = yes

	trigger = {
		#ai = no
	}

	option = {
		name = "OK"
		FROM = {
			show_scope_change = no
			remove_tributary = FROM
			hidden_tooltip = {
				any_vassal = {
					limit = { defacto_liege_title = { has_title_flag = is_march } }
					set_defacto_liege = ROOT
				}
			}
			any_demesne_title = {
				limit = {
					has_title_flag = is_march
				}
				show_scope_change = no
				destroy_landed_title = THIS
			}
			set_defacto_liege = ROOT
		}
	}
}

# March revokation refused
diploresponse_event = {
	id = 320932
	desc = "EVTDESC320932"

	is_triggered_only = yes
	major = no
	is_hostile = yes

	trigger = {
		ai = no
	}

	option = {
		name = "OK"
	}
}

# TODO Succession handling events?

# TODO Events for making march titles permanent