###################################
#
# Britannia Storyline and Historical Events
#
# Ids 311180 - 311189
# Ids 312090 - 312160
# Ids 312174 - 312199
# Ids 313260 - 313269
#
###################################



### UTHER'S DEATH and ARTHUR'S RETURN ###

# Autumn 480 AD. Uther Pendragon health is worsening...
character_event = {
	id = 312098
	desc = "You're not supposed to see this..."
	picture = GFX_evt_throne_room
	
	only_rulers = yes
	hide_window = yes

	trigger = {
		character = 1
		has_landed_title = k_dumnonia
		year = 480
		month = 8
		NOT = { has_character_flag = utherillness }
	}
	
	mean_time_to_happen = {
		months = 1
	}

	immediate = {
		hidden_tooltip = {
			ROOT = {
				set_character_flag = utherillness
				add_trait = pneumonic
				#remove_trait = strong
				#remove_trait = brave
				health = -2
			}
		}
	}
	
	option = {
		name = "OK"
	}
}
# January 481 AD. If Uther still alive, he becomes incapable...
character_event = {
	id = 312099
	desc = "You're not supposed to see this..."
	picture = GFX_evt_throne_room
	
	ai = yes
	only_rulers = yes
	only_men = yes
	hide_window = yes

	trigger = {
		character = 1
		has_landed_title = k_dumnonia
		has_character_flag = utherillness
		is_alive = yes
		year = 481
		month = 1
		NOT = { has_character_flag = utherincapable }
	}
	
	mean_time_to_happen = {
		months = 1
	}

	immediate = {
		hidden_tooltip = {
			ROOT = {
				set_character_flag = utherincapable
				#add_trait = weak
				if = { 
					limit = { is_ai = yes }
					add_trait = incapable
				}	
				health = -2		# This should kill him
			}
		}
	}
	
	option = {
		name = "OK"
	}
}
# Uther Pendragon is dead. Arthur is back to Dumnonia. News spreading...
long_character_event = {		# Arthur's event
	id = 3121000
	title = "EVTNAME3121000"
	desc = "EVTDESC3121000"
	picture = GFX_evt_council
	only_rulers = yes
	
	is_triggered_only = yes
	
	immediate = {
		set_character_flag = returned
		# Remove claims on Dumnonia on anyone who shouldn't have one
		any_character = {
			limit = {
				has_claim = k_dumnonia
				NOR = {
					dynasty = 1
					dynasty = 3
					dynasty = 237
				}
			}
			remove_claim = k_dumnonia
		}
	}

	option = {
		name = "EVTOPTA3121000"
		d_centdumnonia = { gain_title = ROOT }
		c_durnovaria = { gain_title = ROOT }
		c_vindocladia = { gain_title = ROOT }
		c_dunum = { gain_title = ROOT }
		c_arthur_company = {
			destroy_landless_count_level_title_effect = yes
		}
		set_defacto_liege = k_dumnonia
		set_global_flag = arthur_returned
		give_nickname = nick_pendragon
		hidden_tooltip = {
			remove_title = job_marshal
			remove_title = job_chancellor
			remove_title = job_treasurer
			remove_title = job_spymaster
			remove_title = job_spiritual
			k_dumnonia = {
				holder_scope = {
					set_character_flag = mordred
					ROOT = { set_defacto_liege = PREV }
				}
			}
			any_playable_ruler = {
				limit = {
					NOT = { has_character_flag = mordred }
					NOT = { has_character_flag = arthur }
				}
				character_event = { id = 312100 }
			}
			event_target:mordred_pendragon = {
				character_event = { id = 312101 }
			}
		}
	}
}
character_event = {	# Everyone except Mordred get this...
	id = 312100
	title = "EVTNAME312100"
	desc = "EVTDESC312100"
	picture = GFX_evt_council
	only_rulers = yes
	
	is_triggered_only = yes

	option = {
		name = "EVTOPTA312100"
		trigger = {
			top_liege = { has_landed_title = k_dumnonia }
		}
	}
	option = {
		name = "EVTOPTB312100"
		trigger = {
			top_liege = {
				OR = {
					culture_group = celtic
					culture_group = imperiale
					is_romanized_germanic_trigger = yes
				}
				NOT = { has_landed_title = k_dumnonia }
				capital_scope = {
					region = world_britannia
					NOT = { region = world_britannia_cymry_henogledd }
				}
			}
		}
	}
	option = {
		name = "EVTOPTC312100"
		trigger = {
			top_liege = {
				culture_group = germanic
				is_romanized_germanic_trigger = no
				NOT = { has_landed_title = k_dumnonia }
				capital_scope = {
					region = world_britannia
					NOT = { region = world_britannia_cymry_henogledd }
				}
			}
		}
	}
	option = {
		name = "EVTOPTD312100"
		trigger = {
			top_liege = {
				NAND = {
					OR = {
						culture_group = celtic
						culture_group = imperiale
						culture_group = germanic
					}
					capital_scope = {
						region = world_britannia
						NOT = { region = world_britannia_cymry_henogledd }
					}
				}
			}
		}
	}
}
character_event = {	# Event for King Mordred
	id = 312101
	title = "EVTNAME312101"
	desc = "EVTDESC312101"
	picture = GFX_evt_council
	only_rulers = yes
	
	is_triggered_only = yes

	option = {
		name = "EVTOPTA312101"
		trigger = {
			has_character_flag = mordred
			has_landed_title = k_dumnonia
		}
	}
}

### ARTHUR REGENCY CHAIN ###
character_event = {	# Regent decides to give power to Arthur
	id = 312103
	picture = GFX_evt_council
	
	min_age = 15
	
	desc = {
		text = EVTDESC312103
		trigger = { NOT = { has_global_flag = arthur_regent } }
	}
	
	desc = {
		text = EVTDESC312103_1
		trigger = { has_global_flag = arthur_regent }
	}

	trigger = {
		NOT = { character = 3 }
		liege = {
			has_landed_title = k_dumnonia
			has_regent = yes
			regent = {
				character = ROOT
			}
			character = 5
		}
		event_target:arthur_pendragon = {
			is_alive = yes
			NOT = { trait = incapable }
			prisoner = no
			OR = {
				is_landed = no
				any_liege = {
					character = 5
				}
			}
		}
		NOT = { has_character_flag = refused_arthur_regent }
		had_global_flag = { flag = arthur_returned days = 10 }
	}
	
	mean_time_to_happen = {
		months = 2
	}
	
	immediate = {
		save_event_target_as = old_dumnonia_regent
	}
	
	option = {
		name = EVTPOTA312103
		ai_chance = {
			factor = 100
		}
		event_target:arthur_pendragon = {
			character_event = { id = 312104 days = 1 }
		}
	}
	
	option = {
		name = EVTPOTB312103
		ai_chance = {
			factor = 0
		}
		set_character_flag = refused_arthur_regent
	}
}
character_event = {	# Arthur accepts regency
	id = 312104
	picture = GFX_evt_council
	
	desc = {
		text = EVTDESC312104
		trigger = { NOT = { has_global_flag = arthur_regent } }
	}
	
	desc = {
		text = EVTDESC312104_1
		trigger = { has_global_flag = arthur_regent }
	}

	is_triggered_only = yes
	
	option = {
		name = EVTPOTA312104
		k_dumnonia = {
			holder_scope = {
				save_event_target_as = mordred_pendragon
			}
		}
		if = {
			limit = { is_landed = no }
			event_target:mordred_pendragon = {
				ROOT = {
					move_character = PREV
				}
			}
		}
		if = {
			limit = { 
				is_landed = yes 
				NOT = { 
					liege = {
						has_landed_title = k_dumnonia
					}
				}
			}
			event_target:mordred_pendragon = {
				set_defacto_vassal = ROOT
			}
		}
		hidden_tooltip = {
			event_target:mordred_pendragon = {
				character_event = { id = 312105 days = 1 }
				any_realm_lord = {
					limit = {
						NOT = { has_landed_title = k_dumnonia }
						NOT = { 
							event_target:old_dumnonia_regent = {
								character = PREV
							} 
						}
					}
					character_event = { id = 312106 days = 1 }
				}
			}
			character_event = { id = 3121033 days = 5 }
			clear_event_target = old_dumnonia_regent
		}
		hidden_tooltip = {
			event_target:mordred_pendragon = {
				if = {
					limit = {
						has_character_modifier = in_seclusion
					}
					remove_character_modifier = in_seclusion
					set_character_flag = was_in_seclusion
				}
			}
			if = {
				limit = {
					has_character_modifier = in_seclusion
				}
				remove_character_modifier = in_seclusion
				force_host = event_target:mordred_pendragon
				set_character_flag = was_in_seclusion
			}
		}
		if = {
			limit = { is_councillor = yes }
			give_minor_title = title_regent
		}
		if = {
			limit = {
				NOT = { has_minor_title = title_regent }
				is_councillor = no
				event_target:mordred_pendragon = {
					job_marshal = {
						NOT = { character = 20 }		# Owain
					}
				}
			}
			give_job_title = job_marshal
			give_minor_title = title_regent
		}
		if = {
			limit = {
				NOT = { has_minor_title = title_regent }
				is_councillor = no
				event_target:mordred_pendragon = {
					job_marshal = {
						character = 20		# Owain
					}
				}
			}
			give_job_title = job_treasurer
			give_minor_title = title_regent
		}
		hidden_tooltip = {
			if = {
				limit = {
					has_character_flag = was_in_seclusion
				}
				add_character_modifier = {
					name = in_seclusion
					duration = -1
				}
				clr_character_flag = was_in_seclusion
			}
			event_target:mordred_pendragon = {
				if = {
					limit = {
						has_character_flag = was_in_seclusion
					}
					add_character_modifier = {
						name = in_seclusion
						duration = -1
					}
					clr_character_flag = was_in_seclusion
				}
			}
		}
	}
}
character_event = {	# Notify Mordred
	id = 312105
	picture = GFX_evt_council
	
	desc = {
		text = EVTDESC312105
		trigger = { NOT = { has_global_flag = arthur_regent } }
	}
	
	desc = {
		text = EVTDESC312105_1
		trigger = { has_global_flag = arthur_regent }
	}

	is_triggered_only = yes
	
	option = {
		name = EVTPOTA312105
	}
}
character_event = {	# Notify other vassals
	id = 312106
	picture = GFX_evt_council
	
	desc = {
		text = EVTDESC312106
		trigger = { NOT = { has_global_flag = arthur_regent } }
	}
	
	desc = {
		text = EVTDESC312106_1
		trigger = { has_global_flag = arthur_regent }
	}


	is_triggered_only = yes
	
	option = {
		name = EVTPOTA312106
	}
}
character_event = {	# Set Flag
	id = 3121033
	desc = "You're not supposed to see this..."
	picture = GFX_evt_council
	
	hide_window = yes

	is_triggered_only = yes
	
	immediate = {
		set_global_flag = arthur_regent
	}
	
	option = {
		name = "OK"
	}
}


### DERFEL CADARN ###
character_event = {	# Beginning of Wolftail event chain (Bounce event)
	id = 312107
	desc = "You're not supposed to see this..."
	picture = GFX_evt_council
	
	capable_only = yes
	
	hide_window = yes
	only_men = yes
	
	trigger = {
		character = 10
		age = 20
		in_command = no
		#is_landed = no
		NOT = {
			trait = incapable
			trait = infirm
			is_maimed_trigger = yes
			trait = blinded
		}
		martial = 20
		d_wolftails = { has_holder = no }
		NOT = { has_character_flag = given_wolftails }
		event_target:arthur_pendragon = {
			same_realm = ROOT
			is_alive = yes
			OR = {
				higher_tier_than = DUKE
				liege = {
					AND = {
						higher_tier_than = duke
						has_regent = yes
						regent = {
							character = PREVPREV
						}
					}
				}
			}
		}
		NOT = { has_global_flag = wolftails_created }
	}
	
	mean_time_to_happen = {
		months = 3
	}
	
	immediate = {
		set_character_flag = wolftails_start
		event_target:arthur_pendragon = {
			character_event = { id = 3121070 days = 1 }
		}
	}
	
	option = {
		name = OK
	}
}
character_event = {	# Arthur grants Derfel the Wolftails
	id = 3121070
	title = EVTNAME3121070
	desc = EVTDESC3121070
	picture = GFX_evt_warrior_banners
	
	is_triggered_only = yes
	
	immediate = {
		set_character_flag = received_wolftails
		set_global_flag = wolftails_created
	}
	
	option = {
		name = EVTOPTA3121070
		ai_chance = {
			factor = 100
		}
		add_friend = FROM
		FROM = {
			set_character_flag = given_wolftails
			activate_title = {
				title = d_wolftails
				status = yes
			}
			d_wolftails = { 
				grant_title = FROM 
			}
			event_target:arthur_pendragon = {
				if = {
					limit = {
						independent = no
						liege = {
							regent = {
								character = PREVPREV
							}
						}
					}
					liege = {
						set_defacto_vassal = FROM
					}
					FROM = { character_event = { id = 3121071 days = 1 } }
					break = yes
				}
				set_defacto_vassal = FROM
				FROM = { character_event = { id = 3121071 days = 1 } }
			}
		}
	}
	
	option = {
		name = EVTOPTB3121070
		ai_chance = {
			factor = 0
		}
	}
}

character_event = {	# Derfel receives the Wolftails
	id = 3121071
	title = EVTNAME3121071
	desc = EVTDESC3121071
	picture = GFX_evt_warrior_banners
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA3121071
		add_friend = FROM
		prestige = 350
		add_trait = inspiring_leader
		add_trait = rough_terrain_leader
		add_trait = brave
		if = {
			limit = {
				liege = {
					NOT = { character = 3 }
				}
			}
			hidden_tooltip = {
				liege = {
					character_event = { id = 3121072 days = 1 }
				}
			}
		}
	}
}

character_event = {	# Notify liege (i.e. Mordred)
	id = 3121072
	title = EVTNAME3121072
	picture = GFX_evt_warrior_banners
	
	desc = {
		text = EVTDESC3121072
		trigger = {
			character = 5
		}
	}
	
	desc = {
		text = EVTDESC3121072_1
		trigger = {
			NOT = { character = 5 }
		}
	}
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA3121072
	}
}
	
character_event = {	# After 550 AD the Wolftails become a free company again
	id = 312108
	desc = "You're not supposed to see this..."
	picture = GFX_evt_warrior_banners
	
	only_rulers = yes
	only_men = yes
	min_age = 15
	capable_only = yes
	ai = yes
	
	trigger = {
		has_landed_title = k_dumnonia
		year = 550
		war = no
		in_command = no
		d_wolftails = { holder_scope = { liege = { character = ROOT } } }
	}

	mean_time_to_happen = {
		days = 365
	}
	
	immediate = {
		d_wolftails = { 
			holder_scope = {
				d_wolftails = { set_defacto_liege = PREV }
			}
		}
	}
	
	option = {
		name = "OK"
	}
}
character_event = {	# If Derfel becomes King of Anglia, Anglia turns into Icenia
	id = 312109
	desc = "You're not supposed to see this..."
	picture = GFX_evt_council
	
	only_rulers = yes
	only_men = yes
	min_age = 15
	capable_only = yes
	ai = yes
	
	trigger = {
		has_landed_title = k_anglia
		character = 10
		OR = {
			has_landed_title = k_icenia
			k_icenia = { has_holder = no }
		}
	}

	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		ROOT = {
			k_icenia = {
				gain_title = PREV
			}
		}
		k_anglia = { destroy_landed_title = k_anglia }
	}
	
	option = {
		name = "OK"
	}
}

### ARTHUR and SAGRAMOR ###
character_event = {	# Sagramor becomes Arthur's vassal if Arthur becomes King or Regent
	id = 312110
	title = EVTNAME312110
	picture = GFX_evt_warband_on_hill
	
	desc = {
		text = EVTDESC312110
		trigger = {
			event_target:arthur_pendragon = {
				NOT = { higher_tier_than = DUKE }
			}
		}
	}
	
	desc = {
		text = EVTDESC312110_1
		trigger = {
			event_target:arthur_pendragon = {
				higher_tier_than = DUKE
			}
		}
	}
	
	only_rulers = yes
	only_men = yes
	only_independent = yes
	
	trigger = {
		character = 21
		has_landed_title = c_brotherhood_horsemen
		independent = yes
		event_target:arthur_pendragon = {
			is_alive = yes
			OR = {
				higher_tier_than = DUKE
				liege = {
					AND = {
						higher_tier_than = duke
						has_regent = yes
						regent = {
							character = PREVPREV
						}
					}
				}
			}
		}
		NOT = { has_global_flag = horsemen_vassalized }
	}

	mean_time_to_happen = {
		days = 5
	}
	
	immediate = {
		set_global_flag = horsemen_vassalized
	}
	
	option = {
		name = EVTOPTA312110
		ai_chance = {
			factor = 100
		}
		any_independent_ruler = {
			any_realm_character = {
				limit = {
					OR = {
						character = 3
						regent = {
							character = 3
						}
					}
				}
				set_defacto_vassal = ROOT
			}
		}
		hidden_tooltip = {
			event_target:arthur_pendragon = {
				character_event = { id = 3121101 days = 1 }
			}
		}
		if = {
			limit = {
				liege = {
					NOT = { character = 3 }
				}
			}
			hidden_tooltip = {
				liege = {
					character_event = { id = 3121102 days = 1 }
				}
			}
		}
		add_trait = loyal
	}
	option = {
		name = EVTOPTB312110
		ai_chance = {
			factor = 0
		}
	}
}
character_event = {	# Notify Arthur
	id = 3121101
	title = EVTNAME3121101
	picture = GFX_evt_warband_on_hill
	
	is_triggered_only = yes
	
	desc = {
		text = EVTDESC3121101
		trigger = {
			NOT = { higher_tier_than = DUKE }
		}
	}
	
	desc = {
		text = EVTDESC3121101_1
		trigger = {
			higher_tier_than = DUKE
		}
	}
	
	option = {
		name = EVTOPTA3121101
	}
}
character_event = {	# Notify Mordred
	id = 3121102
	title = EVTNAME3121102
	desc = EVTDESC3121102
	picture = GFX_evt_warband_on_hill
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTA3121102
	}
}

character_event = {	# Reset Arthur's dynasty to Pendragon if it changes
	id = 312111
	desc = "You're not supposed to see this..."
	picture = GFX_evt_council
	
	hide_window = yes
	
	is_triggered_only = yes

	trigger = {
		father = {
			character = 3
			trait = bastard
		}
	}
	
	immediate = {
		father = {
			any_dynasty_member = {
				limit = { father_even_if_dead = { character = 3 } }
				dynasty = 1
			}
			any_child = {
				limit = { NOT = { trait = bastard } }
				dynasty = 1
			}
			dynasty = 1
		}
	}
	
	option = {
		name = "OK"
	}
}

character_event = {	# Arthur becomes a legitimized bastard if he becomes king
	id = 312112
	title = "EVTNAME312112"
	desc = "EVTDESC312112"
	picture = GFX_evt_council
	
	only_rulers = yes
	only_men = yes

	trigger = {
		character = 3
		trait = bastard
		has_landed_title = k_dumnonia
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	option = {
		name = "EVTOPTA312112"
		remove_trait = bastard
		add_trait = legit_bastard
		recalc_succession = yes
		prestige = 300
	}
}

### ARTHUR - GUINEVERE AND DERFEL - CEINWYN MARRIAGE ###
long_character_event = {	
	id = 312130
	desc = "EVTDESC312130"
	picture = GFX_evt_council
	
	only_rulers = yes
	has_character_flag = arthur	

	trigger = {
		NOT = { has_global_flag = arthur_married }
		#has_global_flag = arthur_returned
		is_married = no
		is_landed = yes
		OR = {
			top_liege = {
				has_landed_title = k_dumnonia
				regent = {
					character = ROOT
				}
				character = 5 		#Either, Mordred is King and independent, and Arthur is regent
			}
			ROOT = { has_landed_title = k_dumnonia }	#or, King Arthur	
			year = 490			# For now - until we figure something out for if Mordred gets deposed somehow
		}
	}
	
	mean_time_to_happen = {
		days = 30
	}
	
	immediate = {
		fertility = 0.55
		remove_trait = forbid_marriage	#Arthur
		any_lover = {
			remove_lover = 3
		}
		any_consort = {
			remove_consort = yes
		}	
		hidden_tooltip = {
			event_target:guinevere = {
				remove_trait = forbid_marriage
				remove_spouse = yes
				remove_consort = yes
				any_lover = {
					remove_lover = 26	#Guinevere
				}
				fertility = 0.35
			}
			event_target:derfel_cadarn = {
				remove_trait = forbid_marriage
				remove_spouse = yes
				any_consort = {
					remove_consort = yes
				}
				any_lover = {
					remove_lover = 10 	#Derfel
				}
			}
			event_target:ceinwyn_seren = {
				remove_trait = forbid_marriage
				remove_spouse = yes
				remove_consort = yes
				any_lover = {
					remove_lover = 27	#Ceinwyn
				}
				fertility = 0.45
			}
			event_target:lancelot_dulac = {
				remove_trait = forbid_marriage
				remove_spouse = yes
				any_consort = {
					remove_consort = yes
				}	
				any_lover = {
					remove_lover = 31 	#Lancelot
				}
			}
		}
	}
	
	option = {
		name = "EVTOPTA312130"
		ai_chance = {
			factor = 95
		}
		tooltip = {
			add_spouse = 26		#Guinevere
			add_lover = 26		#Guinevere
		}
		event_target:guinevere = {
			show_portrait = yes
		}
		hidden_tooltip = {
			event_target:guinevere = {
				host = {
					character_event = { id = 312131 }
				}
			}
		}
		event_target:ceinwyn_seren = {
			show_scope_change = no
			custom_tooltip = {
				text = "§Y[ceinwyn_seren.GetBestName]§! will run off with §YDerfel Cadarn§!."
			}
			hidden_tooltip = {
				host = {
					character_event = { id = 312133 days = 1 }
				}
			}
		}
	}
	
	option = {
		name = "EVTOPTB312130"
		ai_chance = {
			factor = 5
		}
		event_target:ceinwyn_seren = {
			show_portrait = yes
		}
		tooltip = {
			add_spouse = 27 	#Ceinwyn
		}
		if = {
			limit = {
				liege = {
					NOT = { character = ROOT }
					regent = {
						character = ROOT
					}
				}
			}
			liege = {
				show_scope_change = no
				event_target:ceinwyn_seren = {
					show_scope_change = no
					host = {
						show_scope_change = no
						custom_tooltip = {
							text = EVTOPTB312130_TOOLTIP
						}
					}
				}
			}
		}
		hidden_tooltip = {
			event_target:ceinwyn_seren = {
				character_event = { id = 312135 }
			}
		}
		custom_tooltip = {
			text = "§Y[lancelot_dulac.GetBestName]§! will fall in love with and marry §Y[guinevere.GetBestName]§!."
		}
		hidden_tooltip = {
			event_target:guinevere = {
				host = {
					character_event = { id = 312139 days = 1 }
				}
			}
		}
		event_target:derfel_cadarn = {
			show_scope_change = no
			tooltip = {
				add_lover = 6
			}
			hidden_tooltip = {
				character_event = { id = 312174 days = 1 }
			}
		}
	}
	
	after = {
		set_global_flag = arthur_married
	}
}

# Notify Guinevere's host (marriage with Arthur)
character_event = {
	id = 312131
	desc = {
		text = EVTDESC312131
		trigger = {
			ROOT = { NOT = { character = 26 } }
		}
	}
	desc = {
		text = EVTDESC312131_1		# Special text for Guinevere
		trigger = {
			ROOT = { character = 26 }
		}
	}
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = {
			text = "EVTOPTA312131"
			trigger = {
				ROOT = { NOT = { character = 26 } }
			}
		}
		name = {
			text = "EVTOPTA312131_1"
			trigger = {
				ROOT = { character = 26 }
			}
		}
		event_target:guinevere = {
			add_spouse = 3
			add_lover = 3
		}
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		name = "EVTOPTB312131"
		trigger = {
			ROOT = { character = 26 }
		}
		hidden_tooltip = {
			FROM = { character_event = { id = 312132 } }
		}
		ai_chance = {
			factor = 0
		}
	}
}

# Guinevere refuses
character_event = {
	id = 312132
	desc = EVTDESC312132
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTA312132"
		add_trait = depressed
	}
}

# Notify Ceinwyn's host (marriage with Derfel)
character_event = {
	id = 312133
	desc = {
		text = EVTDESC312133
		trigger = {
			ROOT = { NOT = { character = 27 } }
		}
	}
	desc = {
		text = EVTDESC312133_1		# Special text for Ceinwyn herself
		trigger = {
			ROOT = { character = 27 }
		}
	}
	picture = GFX_evt_lovers
	
	is_triggered_only = yes
	
	option = {
		name = {
			text = "EVTOPTA312133"
			trigger = {
				ROOT = {
					NOR = { 
						character = 27 
						character = 16
					} 
				}
			}
		}
		name = {
			text = "EVTOPTA312133_1"
			trigger = {
				ROOT = { character = 27 }
			}
		}
		name = {
			text = "EVTOPTA312133_2"		# Special text for Gorfyddyd
			trigger = {
				ROOT = { character = 16 }
			}
		}
		tooltip = {
			event_target:ceinwyn_seren = {
				add_spouse = 10
				add_lover = 10
			}
		}
		hidden_tooltip = {
			event_target:derfel_cadarn = {
				if = {
					limit = { NOT = { top_liege = { character = ROOT } } }
					character_event = { id = 312134 }
				}
				else = {
					add_spouse = 27
					add_lover = 27
				}
			}
		}
	}
}

# Notify Derfel's host (marriage with Ceinwyn)
character_event = {
	id = 312134
	desc = {
		text = EVTDESC312134
		trigger = {
			ROOT = { NOT = { character = 10 } }
		}
	}
	desc = {
		text = EVTDESC312134_1		# Special text for Derfel himself
		trigger = {
			ROOT = { character = 10 }
		}
	}
	picture = GFX_evt_lovers
	
	is_triggered_only = yes
	
	option = {
		name = {
			text = "EVTOPTA312134"
			trigger = {
				ROOT = { NOT = { character = 10 } }
			}
		}
		name = {
			text = "EVTOPTA312134_1"
			trigger = {
				ROOT = { character = 10 }
			}
		}
		event_target:derfel_cadarn = {
			add_spouse = 27
			add_lover = 27
		}
	}
}

# Bounce event from Ceinwyn to get the relation
character_event = {
	id = 312135
	desc = "You're not supposed to see this..."
	picture = GFX_evt_council
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		host = { character_event = { id = 312136 } }
	}
}

# Notify Ceinywn's host (marriage with Arthur)
character_event = {
	id = 312136
	desc = {
		text = EVTDESC312136
		trigger = {
			ROOT = { NOT = { character = 27 } }
		}
	}
	desc = {
		text = EVTDESC312136_1		# Special text for Ceinwyn
		trigger = {
			ROOT = { character = 27 }
		}
	}
	picture = GFX_evt_council
	hide_FROM = yes
	show_FROMFROM = yes
	
	is_triggered_only = yes
	
	option = {
		name = {
			text = "EVTOPTA312136"
			trigger = {
				ROOT = { NOT = { character = 27 } }
			}
		}
		name = {
			text = "EVTOPTA312136_1"
			trigger = {
				ROOT = { character = 27 }
			}
		}
		event_target:ceinwyn_seren = {
			show_scope_change = no
			add_spouse = 3
		}
		FROMFROM = {
			show_scope_change = no
			liege = {
				show_scope_change = no
				if = {
					limit = { 
						NOT = { character = PREV } 
						regent = {
							character = PREVPREV
						}
					}
					custom_tooltip = {
						text = EVTOPTA312136_TOOLTIP
					}
					hidden_tooltip = {
						character_event = { id = 312137 }
					}
				}
			}
		}
		ai_chance = {
			factor = 100
		}
	}
	
	option = {
		name = "EVTOPTB312136"
		ai_chance = {
			factor = 0
		}
		hidden_tooltip = {
			FROMFROM = { character_event = { id = 312138 } }
		}
	}
}

# Notify Arthur's liege (i.e. Mordred)
character_event = {
	id = 312137
	desc = EVTDESC312137
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTA312137"
		custom_tooltip = {
			text = EVTOPTA312137_TOOLTIP
			opinion = {
				modifier = in_non_aggression_pact
				years = 10
				who = FROM
			}
			FROM = {
				opinion = {
					modifier = in_non_aggression_pact
					years = 10
					who = ROOT
				}
			}
		}
	}
}

# Ceinwyn refuses
character_event = {
	id = 312138
	desc = EVTDESC312138
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTA312138"
	}
}

# Notify Guinevere's host (marriage with Lancelot)
character_event = {
	id = 312139
	desc = {
		text = EVTDESC312139
		trigger = {
			ROOT = { NOT = { character = 26 } }
		}
	}
	desc = {
		text = EVTDESC312139_1		# Special text for Guinevere
		trigger = {
			ROOT = { character = 26 }
		}
	}
	picture = GFX_evt_lovers
	
	is_triggered_only = yes
	
	option = {
		name = {
			text = "EVTOPTA312139"
			trigger = {
				ROOT = { NOT = { character = 26 } }
			}
		}
		name = {
			text = "EVTOPTA312139_1"
			trigger = {
				ROOT = { character = 26 }
			}
		}
		event_target:guinevere = {
			tooltip = {
				add_spouse = 31
				add_lover = 31
			}
			hidden_tooltip = {
				event_target:lancelot_dulac = {
					character_event = { id = 312172 }
				}
			}
		}
	}
}

# Bounce event from Lancelot to get the relation
character_event = {
	id = 312172
	desc = "You're not supposed to see this..."
	picture = GFX_evt_council
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		host = { character_event = { id = 312173 } }
	}
}

# Notify Lancelot's host (marriage with Guinevere)
character_event = {
	id = 312173
	desc = {
		text = EVTDESC312173
		trigger = {
			ROOT = { NOT = { character = 31 } }
		}
	}
	desc = {
		text = EVTDESC312173_1		# Special text for Lancelot himself
		trigger = {
			ROOT = { character = 31 }
		}
	}
	picture = GFX_evt_lovers
	
	is_triggered_only = yes
	
	option = {
		name = {
			text = "EVTOPTA312173"
			trigger = {
				ROOT = { NOT = { character = 31 } }
			}
		}
		name = {
			text = "EVTOPTA312173_1"
			trigger = {
				ROOT = { character = 31 }
			}
		}
		event_target:lancelot_dulac = {
			add_spouse = 26
			add_lover = 26
		}
	}
}

# Bounce event from Derfel to get the relation
character_event = {
	id = 312174
	desc = "You're not supposed to see this..."
	picture = GFX_evt_council
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		host = { character_event = { id = 312175 } }
	}
}

# Notify Derfel's host (falls in love with Nimue)
character_event = {
	id = 312175
	desc = {
		text = EVTDESC312175
		trigger = {
			ROOT = { NOT = { character = 10 } }
		}
	}
	desc = {
		text = EVTDESC312175_1		# Special text for Derfel himself
		trigger = {
			ROOT = { character = 10 }
		}
	}
	picture = GFX_evt_lovers
	
	is_triggered_only = yes
	
	option = {
		name = {
			text = "EVTOPTA312175"
			trigger = {
				ROOT = { NOT = { character = 10 } }
			}
		}
		name = {
			text = "EVTOPTA312175_1"
			trigger = {
				ROOT = { character = 10 }
			}
		}
		event_target:derfel_cadarn = {
			add_lover = 6
		}
		hidden_tooltip = {
			event_target:nimue = {
				remove_lover = 2 	#Merlin
				host = {
					if = {
						limit = { NOT = { character = ROOT } }
						character_event = { id = 312176 }
					}
				}
			}
		}
	}
}

# Notify Nimue's host (falls in love with Derfel)
character_event = {
	id = 312176
	desc = {
		text = EVTDESC312176
		trigger = {
			ROOT = { NOT = { character = 6 } }
		}
	}
	desc = {
		text = EVTDESC312176_1		# Special text for Nimue herself
		trigger = {
			ROOT = { character = 6 }
		}
	}
	picture = GFX_evt_lovers
	
	is_triggered_only = yes
	
	option = {
		name = {
			text = "EVTOPTA312176"
			trigger = {
				ROOT = { NOT = { character = 6 } }
			}
		}
		name = {
			text = "EVTOPTA312176_1"
			trigger = {
				ROOT = { character = 6 }
			}
		}
		if = {
			limit = {
				any_lover = {
					character = 2	#Merlin
				}
				remove_lover = 2
			}
		}
		tooltip = {
			event_target:nimue = {
				add_lover = 10
			}
		}
	}
}
# Decline of Dumnonia
narrative_event = {
	id = 312115
	title = "EVTNAME312115"
	major = yes
	picture = "GFX_evt_council"
	
	is_triggered_only = yes
	
	desc = {
		text = EVTDESC312115_uther_death
		trigger = {
			ROOT = { character = 1 }
			NOR = {
				has_global_flag = uther_deposed_dumnonia
				has_global_flag = mordred_deposed_dumnonia
				has_global_flag = arthur_deposed_dumnonia
				has_global_flag = generic_deposed_dumnonia
			}
		}
	}
	
	desc = {
		text = EVTDESC312115_arthur_death
		trigger = {
			ROOT = { character = 3 }
			NOR = {
				has_global_flag = uther_deposed_dumnonia
				has_global_flag = mordred_deposed_dumnonia
				has_global_flag = arthur_deposed_dumnonia
				has_global_flag = generic_deposed_dumnonia
			}
		}
	}
	
	desc = {
		text = EVTDESC312115_mordred_death
		trigger = {
			ROOT = { character = 5 }
			NOR = {
				has_global_flag = uther_deposed_dumnonia
				has_global_flag = mordred_deposed_dumnonia
				has_global_flag = arthur_deposed_dumnonia
				has_global_flag = generic_deposed_dumnonia
			}
		}
	}
	
	desc = {
		text = EVTDESC312115_generic_death
		trigger = {
			ROOT = {
				NOR = {
					character = 1
					character = 3
					character = 5
				}
				father_even_if_dead = { character = 1 } 
			}
			NOR = {
				has_global_flag = uther_deposed_dumnonia
				has_global_flag = mordred_deposed_dumnonia
				has_global_flag = arthur_deposed_dumnonia
				has_global_flag = generic_deposed_dumnonia
			}
		}
	}
	
	desc = {
		text = EVTDESC312115_uther_deposed
		trigger = {
			has_global_flag = uther_deposed_dumnonia
		}
	}
	
	desc = {
		text = EVTDESC312115_mordred_deposed
		trigger = {
			has_global_flag = mordred_deposed_dumnonia
		}
	}
	
	desc = {
		text = EVTDESC312115_arthur_deposed
		trigger = {
			has_global_flag = arthur_deposed_dumnonia
		}
	}
	
	desc = {
		text = EVTDESC312115_generic_deposed
		trigger = {
			has_global_flag = generic_deposed_dumnonia
		}
	}
	
	trigger = {
		has_global_flag = pendragon_dumnonia
		OR = {
			has_global_flag = uther_deposed_dumnonia
			has_global_flag = mordred_deposed_dumnonia
			has_global_flag = arthur_deposed_dumnonia
			AND = {
				has_landed_title = k_dumnonia
				OR = {
					character = 1
					character = 3
					character = 5
					father_even_if_dead = { character = 1 }
				}
				NOT = {		# Checks if the heir to Dumnonia is Mordred Jr. or any of Uther's children
					any_character = {
						OR = {
							character = 1
							character = 3
							character = 5
							father_even_if_dead = { character = 1 }
						}
						any_heir_title = {
							title = k_dumnonia
						}
					}
				}
			}
		}
	}
	
	immediate = {
		clr_global_flag = pendragon_dumnonia
		set_global_flag = glevum_created
		set_global_flag = belgae_created
		if = {
			limit = { NOT = { has_global_flag = celemion_renamed } }
			d_eastdumnonia = { de_jure_liege = k_belgae }
		}
		d_gradawc = { de_jure_liege = k_belgae }
		if = {
			limit = { 
				NOR = { 
					has_global_flag = belgae_renamed 
					AND = {
						has_global_flag = meonware_conquered
						NOT = { has_global_flag = meonware_destroyed }
					}
				} 
			}
			d_the_belgae = { de_jure_liege = k_belgae }
		}
		if = {
			limit = { NOT = { has_global_flag = glevum_renamed } }
			d_centgwent = { de_jure_liege = k_glevum }
		}
		d_corinium = { de_jure_liege = k_glevum }
		d_baddon = { de_jure_liege = k_glevum }
	}
	
	option = {
		name = "EVTOPTA312115"
		trigger = {
			has_landed_title = k_dumnonia
		}
	}
	
	option = {
		name = "EVTOPTB312115"
		trigger = {
			NOT = { has_landed_title = k_dumnonia }
			OR = {
				has_landed_title = d_eastdumnonia
				has_landed_title = d_gradawc
				has_landed_title = d_the_belgae
				has_landed_title = d_centgwent
				has_landed_title = d_corinium
				has_landed_title = d_baddon
			}
		}
	}
	
	option = {
		name = "EVTOPTC312115"
		trigger = {
			capital_scope = { region = world_britannia }
			NOR = {
				has_landed_title = k_dumnonia
				has_landed_title = d_eastdumnonia
				has_landed_title = d_gradawc
				has_landed_title = d_the_belgae
				has_landed_title = d_centgwent
				has_landed_title = d_corinium
				has_landed_title = d_baddon
			}
			OR = {
				is_brythonic_culture_trigger = yes
				culture_group = imperiale
				is_romanized_germanic_trigger = yes
			}
		}
	}
	
	option = {
		name = "EVTOPTD312115"
		trigger = {
			culture_group = germanic
			is_romanized_germanic_trigger = no
			capital_scope = { region = world_britannia }
			NOR = {
				has_landed_title = k_dumnonia
				has_landed_title = d_eastdumnonia
				has_landed_title = d_gradawc
				has_landed_title = d_the_belgae
				has_landed_title = d_centgwent
				has_landed_title = d_corinium
				has_landed_title = d_baddon
			}
		}
	}
	
	option = {
		name = "EVTOPTE312115"
		trigger = {
			NOR = {
				has_landed_title = k_dumnonia
				has_landed_title = d_eastdumnonia
				has_landed_title = d_gradawc
				has_landed_title = d_the_belgae
				has_landed_title = d_centgwent
				has_landed_title = d_corinium
				has_landed_title = d_baddon
				AND = {
					capital_scope = { region = world_britannia }
					OR = {
						is_brythonic_culture_trigger = yes
						culture_group = imperiale
						culture_group = germanic
					}
				}
			}
		}
	}
}

# Bounce event for deposition
character_event = {
	id = 312116
	desc = "You're not supposed to see this..."
	picture = "GFX_evt_council"
	
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = pendragon_dumnonia
		FROM = { title = k_dumnonia }
		NOR = {
			character = 1
			character = 3
			character = 5
			father_even_if_dead = { character = 1 }
		}
	}
	
	immediate = {
		k_dumnonia = {
			holder_scope = {
				character_event = { id = 312117 days = 1 }
			}
		}
		if = {
			limit = { FROMFROM = { character = 1 } }
			set_global_flag = uther_deposed_dumnonia
			break = yes
		}
		if = {
			limit = { FROMFROM = { character = 3 } }
			set_global_flag = arthur_deposed_dumnonia
			break = yes
		}
		if = {
			limit = { FROMFROM = { character = 5 } }
			set_global_flag = mordred_deposed_dumnonia
			break = yes
		}
		set_global_flag = generic_deposed_dumnonia
	}
	
	option = {
		name = "OK"
	}
}

# Second bounce
character_event = {
	id = 312117
	desc = "You're not supposed to see this..."
	picture = "GFX_evt_council"
	
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = { FROMFROMFROM = { character = 1 } }
			set_global_flag = uther_deposed_dumnonia
		}
		if = {
			limit = { FROMFROMFROM = { character = 3 } }
			set_global_flag = mordred_deposed_dumnonia
		}
		if = {
			limit = { FROMFROMFROM = { character = 5 } }
			set_global_flag = arthur_deposed_dumnonia
		}
		character_event = { id = 312115 }
	}
	
	option = {
		name = "OK"
	}
}

# Death of Arthur (if High King and not King of Dumnonia)
narrative_event = {
	id = 312118
	title = "EVTNAME312118"
	desc = "EVTDESC312118"
	major = yes
	picture = "GFX_evt_council"
	
	is_triggered_only = yes
	
	trigger = {
		character = 3
		has_landed_title = e_britannia
		OR = {
			NOT = { has_global_flag = pendragon_dumnonia }
			NOT = { has_landed_title = k_dumnonia }
			current_heir = {
				OR = {
					character = 1
					character = 5
					father_even_if_dead = { character = 1 }
				}
			}
		}
	}
	
	option = {
		name = "EVTOPTA312118"
		trigger = {
			has_landed_title = e_britannia
		}
	}
	
	option = {
		name = "EVTOPTB312118"
		trigger = {
			capital_scope = { region = world_britannia }
			OR = {
				is_brythonic_culture_trigger = yes
				culture_group = imperiale
				is_romanized_germanic_trigger = yes
			}
		}
	}
	
	option = {
		name = "EVTOPTC312118"
		trigger = {
			culture_group = germanic
			is_romanized_germanic_trigger = no
			capital_scope = { region = world_britannia }
		}
	}
	
	option = {
		name = "EVTOPTD312118"
		trigger = {
			NAND = {
				capital_scope = { region = world_britannia }
				OR = {
					is_brythonic_culture_trigger = yes
					culture_group = imperiale
					culture_group = germanic
				}
			}
		}
	}
}

### MAINTENANCE EVENTS ###

# Aelle loses his health bonus in 490
character_event = {
	id = 312090
	desc = "You're not supposed to see this..."
	picture = GFX_evt_throne_room
	
	hide_window = yes
	
	only_rulers = yes
	only_men = yes
	min_age = 45

	trigger = {
		character = 80
		is_alive = yes
		year = 490
		NOT = { has_character_flag = aelle_health_reduced }
	}
	
	mean_time_to_happen = {
		months = 1
	}

	immediate = {
		set_character_flag = aelle_health_reduced
		health = -3
	}
	
	option = {
		name = "OK"
	}
}

# Continually lower Aelle's health as he grows older
character_event = {
	id = 312091
	desc = "You're not supposed to see this..."
	picture = GFX_evt_throne_room
	
	hide_window = yes
	
	only_rulers = yes
	only_men = yes
	min_age = 50

	trigger = {
		character = 80
		is_alive = yes
		year = 495
		NOT = { year = 515 }
		#NOT = { 
			had_character_flag = {
				flag = aelle_health_reduced 
				days = 1825
			}
		#}
	}
	
	mean_time_to_happen = {
		months = 1
	}

	immediate = {
		set_character_flag = aelle_health_reduced
		health = -2
	}
	
	option = {
		name = "OK"
	}
}


##########################
### HISTORICAL EVENTS ###
##########################

# 480 AD - Death of Julius Nepos - bounce event
narrative_event = { 
	id = 312120
	title = "EVTNAME312120"
	desc = "EVTDESC312120"
	major = yes
	hide_new = yes
	
	picture = "GFX_evt_roman_emperor_dead"
	
	only_rulers = yes
	
	hide_window = yes
	
	trigger = {
		OR = {
			has_landed_title = e_western_roman_empire
			year = 482
		}
		NOT = { has_global_flag = western_roman_empire_fallen }
		year = 480
	}
	
	mean_time_to_happen = {
		days = 90
		modifier = {
			factor = 3
			NOT = { month = 2 }
			NOT = { year = 481 }
		}
		modifier = {
			factor = 0.1
			year = 481
		}
		modifier = {
			factor = 0.001
			year = 482
		}
	}
	
	immediate = {
		set_global_flag = western_roman_empire_fallen
		k_gaul = {
			holder_scope = {
				add_pressed_claim = e_gaul
			}
		}
		k_benoic = { de_jure_liege = e_armorica }
		k_broceliande = { de_jure_liege = e_armorica }
		k_basque_vasconia = { de_jure_liege = e_aquitania }
		if = {
			limit = { NOT = { has_global_flag = franks_defeated } }
			k_franks = { de_jure_liege = e_franks }
			k_ripuarian_franks = { de_jure_liege = e_franks }
			k_neustria = { de_jure_liege = e_franks }
			k_orleans = { de_jure_liege = e_franks }
			k_aquitaine = { de_jure_liege = e_franks }
			k_vasconia = { de_jure_liege = e_franks }
			k_provence = { de_jure_liege = e_franks }
		}
		k_visigoths = { de_jure_liege = 0 }
		k_burgundy = { de_jure_liege = 0 }
		k_praetorian_prefecture_of_gaul = { de_jure_liege = 0 }
		k_saxon_gaul = { de_jure_liege = e_aengland }
		if = {
			limit = { 
				has_global_flag = burgundy_subjugated 
				NOT = { has_global_flag = franks_defeated }
			}
			k_burgundy = { de_jure_liege = e_franks }
		}
		if = {
			limit = { has_global_flag = frisia_subjugated }
			k_frisia = { de_jure_liege = e_franks }
		}
		if = {
			limit = { has_global_flag = saxony_subjugated }
			k_saxony = { de_jure_liege = e_franks }
		}
		if = {
			limit = { has_global_flag = alemannia_subjugated }
			k_alemannia = { de_jure_liege = e_franks }
		}
		if = {
			limit = { e_western_roman_empire = { has_holder = yes } }
			e_western_roman_empire = { holder_scope = { character_event = { id = 312121 } } }
			break = yes
		}
		character_event = { id = 312121 }		# Fallback in case the WRE somehow has no holder (should be impossible)
	}
}
# Actual narrative event
narrative_event = { 
	id = 312121
	title = "EVTNAME312120"
	desc = "EVTDESC312120"
	major = yes
	#hide_new = yes
	#hide_from = yes
	
	picture = "GFX_evt_roman_emperor_dead"
	
	is_triggered_only = yes
	
	immediate = {
		e_eastern_roman_empire = {
			holder_scope = {
				save_event_target_as = eastern_emperor
			}
		}
		e_western_roman_empire = {
			holder_scope = {
				any_tributary = {
					limit = {
						is_tributary = {
							type = roman_province
						}
					}
					suzerain = {
						remove_tributary = PREV
					}
					convert_to_proper_subroman_government_effect = yes
					any_realm_lord = {
						limit = { government = imperial_government }
						convert_to_proper_subroman_government_effect = yes
					}
				}
			}
			set_title_landless = {
				title = THIS
				status = no
			}
			holder_scope = {
				any_artifact = {
					limit = { artifact_type = crown_wre }
					transfer_artifact = {
						from = PREV
						to = event_target:eastern_emperor
					}
				}
				death = {
					death_reason = death_murder
				}
			}
			destroy_landed_title = THIS
		}
	}
	
	option = {								# King of Soissons
		name = "EVTOPTA312120"
		trigger = {
			has_landed_title = k_gaul
		}
		prestige = 250
	}
	
	option = {								# Vassals of Soissons
		name = "EVTOPTB312120"				
		trigger = {
			NOT = { has_landed_title = k_gaul }
			top_liege = { has_landed_title = k_gaul }
		}	
	}
	option = {								# Other Rulers
		name = "EVTOPTC312120"				
		trigger = {
			NOT = { 
				OR = {
					has_landed_title = k_gaul
					top_liege = { has_landed_title = k_gaul }
				}
			}
		}	
	}
}

# Make sure Burgundy and Visigoths stay empire-less
character_event = { 
	id = 312122
	desc = "You're not supposed to see this..."
	picture = "GFX_evt_roman_emperor_dead"
	
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = western_roman_empire_fallen
		NOT = { k_visigoths = { de_jure_liege = 0 } }
	}
	
	# mean_time_to_happen = {
		# days = 1
	# }
	
	immediate = {
		k_visigoths = { de_jure_liege = 0 }
		if = {
			limit = { NOT = { has_global_flag = burgundy_subjugated } }
			k_burgundy = { de_jure_liege = 0 }
		}
		k_praetorian_prefecture_of_gaul = { de_jure_liege = 0 }
	}
}



### PLAGUE OF JUSTINIAN ###
# 547 AD - The Plague Arrives in Britain
narrative_event = {
	id = 312140
	title = "EVTNAME312140"
	desc = "EVTDESC312140"
	major = yes
	hide_new = yes
	hide_from = yes
	picture = "GFX_evt_plague_doctor"
	
	is_triggered_only = yes
	
	trigger = {
		disease = bubonic_plague
		NOT = { has_global_flag = justinian_plague_message }
	}
	
	immediate = {
		set_global_flag = justinian_plague_message
		set_global_flag = black_death_broadcasted
		any_player = {
			chronicle = {
				entry = CHRONICLE_PLAGUE_ARRIVES
				picture = GFX_evt_plague_spreading
			}
		}
	}
	
	option = {
	 	name = "EVTOPTA312140"
		ai_chance = {
			factor = 1
		}
	}
	
	option = {
		name = "EVTOPTB312140"
		trigger = {
			religion_group = christian
			NOT = { trait = cynical }
		}
		piety = 20
		if = {
			limit = {
				trait = tolerant
			}
			remove_trait = tolerant
		}
		if = {
			limit = {
				NOT = { trait = zealous }
			}
			add_trait = zealous
		}
		ai_chance = {
			factor = 1
		}
	}
	
	option = {
		name = "EVTOPTC312140"
		trigger = {
			OR = {
				religion_group = pagan_group
			}
			NOT = { trait = cynical }
		}
		piety = 20
		if = {
			limit = {
				trait = tolerant
			}
			remove_trait = tolerant
		}
		if = {
			limit = {
				NOT = { trait = zealous }
			}
			add_trait = zealous
		}
		ai_chance = {
			factor = 1
		}
	}
	
	option = {
		name = "EVTOPTD312140"
		trigger = {
			is_ruler = yes
			higher_tier_than = BARON
			scaled_wealth = 2.0
		}
		piety = -10
		if = {
			limit = {
				trait = zealous
			}
			remove_trait = zealous
		}
		if = {
			limit = {
				NOT = { trait = zealous }
				NOT = { trait = cynical }
			}
			add_trait = cynical
		}
		if = {
			limit = {
				trait = slothful
			}
			remove_trait = slothful
		}
		if = {
			limit = {
				NOT = { trait = diligent }
				NOT = { trait = slothful }
			}
			add_trait = diligent
		}
		scaled_wealth = -2.5
		custom_tooltip = { text = EVTOPTD312140TT }
		capital_scope = {
			add_province_modifier = {
				name = plague_prevention
				duration = 7300
			}
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0
				NOT = {
					NOT = { trait = zealous }
					OR = {
						trait = cynical
						trait = tolerant
					}
					OR = {
						trait = diligent
						trait = quick
						trait = genius
						trait = scholar
						learning = 15
					}
				}
			}
			modifier = {
				factor = 0.5
				religion_group = christian
			}
			modifier = {
				factor = 0.5
				NOT = { learning = 10 }
			}
			modifier = {
				factor = 2.0
				learning = 20
			}
		}
	}

	option = { # Monks & Mystics - Hermetics Scrying reaction
		name = EVTOPTA_SSI_006

		set_character_flag = negative_event_flag
		calculate_scrying_outcome_effect = yes
		remove_scrying_omen_modifiers_effect = yes
		tooltip_info = yes
		trigger = {
			has_power_omen_modifier_trigger = yes
		}
	}
}



### ANGLO-SAXON DEFEAT ###
narrative_event = {
	id = 312150
	title = "EVTNAME312150"
	desc = "EVTDESC312150"
	major = yes
	hide_new = yes
	hide_from = yes
	picture = "GFX_evt_people_captured"
	
	only_playable = yes
	
	trigger = {
		has_landed_title = k_nuncio_britanniae
		NOT = { has_global_flag = anglo_saxons_defeated }
		OR = {
			year = 475
			has_global_flag = anglian_east_invasion_450
		}
		OR = {
			year = 495
			has_global_flag = anglian_east_invasion_469
		}
		OR = {
			year = 550
			has_global_flag = west_saxon_invasion_534
		}
		OR = {
			year = 570
			has_global_flag = west_saxon_invasion_552
		}
		OR = {
			year = 580
			has_global_flag = anglian_north_invasion_547
		}
		OR = {
			year = 590
			has_global_flag = anglian_north_invasion_559
		}
		OR = {
			year = 590
			has_global_flag = iclingas_invasion_560
		}
		OR = {
			year = 620
			has_global_flag = iclingas_invasion_580
		}
		# Note: we don't have to bother considering the Hwiccas invasion because they can't trigger if there aren't 
		# any Ingvaeonic-ruled provinces in Britannia
		d_angles = {
			OR = {
				has_holder = no
				holder_scope = {
					war = no
				}
			}
		}
		d_west_saxons = {
			OR = {
				has_holder = no
				holder_scope = {
					war = no
				}
			}
		}
		d_north_angles = {
			OR = {
				has_holder = no
				holder_scope = {
					OR = {
						is_landed = yes
						war = no 
					}
				}
			}
		}
		d_iclingas = {
			OR = {
				has_holder = no
				holder_scope = {
					OR = {
						is_landed = yes
						war = no 
					}
				}
			}
		}
		NOT = {
			any_province = {
				region = world_britannia
				owner = {
					top_liege = {
						OR = {
							AND = {
								culture_group = germanic
								is_romanized_germanic_trigger = no
							}
							primary_title = {
								higher_tier_than = COUNT
								OR = {
									title = e_aengland
									empire = { title = e_aengland }
								}
							}
						}
					}
				}
			}
		}
	}
	
	mean_time_to_happen = {
		days = 1
	}
	
	immediate = {
		set_global_flag = anglo_saxons_defeated
	}
	
	option = {
	 	name = "EVTOPTA312150"
		trigger = {
			any_realm_province = {
				region = world_britannia
			}
			OR = {
				is_brythonic_culture_trigger = yes
				culture_group = imperiale
				is_romanized_germanic_trigger = yes
			}
		}
	}
	
	option = {
		name = "EVTOPTB312150"
		trigger = {
			any_realm_province = {
				region = world_britannia
			}
			culture_group = germanic
			is_romanized_germanic_trigger = no
		}
	}
	
	option = {
		name = "EVTOPTC312150"
		trigger = {
			NOT = {
				any_realm_province = {
					region = world_britannia
				}
			}
			is_ingvaeonic_culture_trigger = yes
		}
	}
	
	option = {
		name = "EVTOPTD312150"
		trigger = {
			NOT = {
				any_realm_province = {
					region = world_britannia
				}
			}
			is_north_germanic_trigger = yes
		}
	}
	
	option = {
		name = "EVTOPTE312150"
		trigger = {
			NOR = {
				any_realm_province = {
					region = world_britannia
				}
				is_north_germanic_trigger = yes
				is_ingvaeonic_culture_trigger = yes
			}
		}
	}
}

### FIRST ANGLO-SAXON CATHOLIC KING ###
character_event = {
	id = 312155
	title = "EVTNAME312155"
	desc = "EVTDESC312155"
	picture = "GFX_evt_kneeling_cross"
	
	major = yes
	
	min_age = 15
	capable_only = yes
	prisoner = no
	only_rulers = yes
	only_men = yes
	
	trigger = {
		is_ingvaeonic_culture_trigger = yes
		capital_scope = { region = world_britannia }
		higher_real_tier_than = DUKE
		religion = catholic
		NOT = { has_global_flag = first_saxon_catholic_king }		
	}

	mean_time_to_happen = {
		months = 2
	}
	
	immediate = {
		set_global_flag = first_saxon_catholic_king
	}
	
	option = {
		name = "EVTOPTA312155"
		trigger = {
			is_ingvaeonic_culture_trigger = yes
			NOT = { religion_group = christian }
		}
	}
	option = {
		name = "EVTOPTB312155"
		trigger = {
			is_ingvaeonic_culture_trigger = yes
			religion_group = christian
		}
	}
	option = {
		name = "EVTOPTC312155"
		trigger = {
			is_ingvaeonic_culture_trigger = no
			NOT = { religion_group = christian }
		}
	}
	option = {
		name = "EVTOPTD312155"
		trigger = {
			is_ingvaeonic_culture_trigger = no
			religion_group = christian
		}
	}
}



### BEDE THE VENERABLE ###
# 715 AD - Bede
character_event = {
	id = 311185
	desc = "You're not supposed to see this..."
	
	only_rulers = yes
	ai = yes
	
	trigger = {
		year = 715
		has_landed_title = b_jarrow
		is_ingvaeonic_culture_trigger = yes
		religion_group = christian
		41 = {	# Old Tyne
			is_ingvaeonic_culture_trigger = yes
			religion_group = christian
		}
		liege = {
			is_ingvaeonic_culture_trigger = yes
			OR = {
				ai = yes
				religion_group = christian
			}
		}
		top_liege = {
			is_ingvaeonic_culture_trigger = yes
			OR = {
				ai = yes
				religion_group = christian
			}
		}
		NOT = { has_global_flag = bede_start }		
	}

	mean_time_to_happen = {
		months = 2
	}
	
	immediate = {
		set_global_flag = bede_start
		create_character = {
			name="Bede"
			female = no
			dynasty = none
			random_traits = no
			health = 7
			age = 42
			attributes = {
				learning = 11
				stewardship = 9
				martial = 3
				diplomacy = 10
				intrigue = 8
			}
			culture = anglosaxon
			religion = catholic
			trait = mastermind_theologian
			trait = ambitious
			trait = quick
			trait = diligent
			trait = scholar
			trait = zealous
			trait = loyal
			trait = patient
		}
		new_character = {
			piety = 750
			b_jarrow = { 
				gain_title = PREV
			}
			set_character_flag = bede
		}
	}
	
	option = {
		name = "OK"
	}
}

# 731 AD - Historia Ecclesiastica Gentis Anglorum
narrative_event = {
	id = 311186
	title = "EVTNAME311186"
	desc = "EVTDESC311186"
	picture = "GFX_evt_christian_art"
	major = yes
	hide_new = yes
	
	#only_rulers = no
	min_age = 50
	
	border = "GFX_event_narrative_frame_religion"
	
	ai = yes
	
	trigger = {
		year = 731
		has_global_flag = bede_start
		NOT = { has_global_flag = bede_historia }
		has_character_flag = bede
		is_alive = yes
		NOT = { trait = incapable }
		is_ingvaeonic_culture_trigger = yes
		religion = catholic
		top_liege = {
			is_ingvaeonic_culture_trigger = yes
			religion_group = christian
		}
	}

	mean_time_to_happen = {
		months = 1
	}
	
	immediate = {
		set_global_flag = bede_historia
		ROOT = { give_nickname = nick_venerable }
	}
	
	option = {
		name = "EVTOPTA311186"
		trigger = {
			religion_group = christian
			is_ingvaeonic_culture_trigger = yes
		}
	}
	
	option = {
		name = "EVTOPTB311186"
		trigger = {
			NOT = { religion_group = christian }
			is_ingvaeonic_culture_trigger = no
		}
	}
	
	option = {
		name = "EVTOPTC311186"
		trigger = {
			religion_group = christian
			is_ingvaeonic_culture_trigger = no
		}
	}
	
	option = {
		name = "EVTOPTD311186"
		trigger = {
			NOT = { religion_group = christian }
			is_ingvaeonic_culture_trigger = yes
		}
	}
}

### The Free Town of Caletum ###
# 570 AD - Rise of the Merchants
character_event = {
	id = 313267
	desc = "You're not supposed to see this..."
	
	only_rulers = yes
	min_age = 15
	max_age = 50
	prisoner = no
	ai = yes
	
	trigger = {
		year = 570
		has_landed_title = c_caletum
		NOT = { higher_tier_than = DUKE }
		independent = no
		NOT = { trait = just }
		OR = {
			trait = greedy
			trait = arbitrary
			trait = cruel
			trait = impaler
			#trait = selfish
			trait = slow
			trait = imbecile
		}
		NOT = { has_global_flag = rep_caletum_start }		
	}

	mean_time_to_happen = {
		months = 12
	}
	
	immediate = {
		set_global_flag = rep_caletum_start
		any_liege = { set_character_flag = caletum_rep_close }
		any_sibling = { set_character_flag = caletum_rep_close }
		any_child = { set_character_flag = caletum_rep_close }
		spouse = { set_character_flag = caletum_rep_close }
		any_courtier = { set_character_flag = caletum_rep_close }
		create_random_steward = {
			random_traits = yes
			dynasty = random
			trait = ambitious
			trait = quick
			trait = diligent
			trait = greedy
			female = no
		}
		new_character = {
			change_stewardship = 5
			change_intrigue = 4
			change_diplomacy = 4
			if = {
				limit = {
					NOT = { stewardship = 10 }
				}
				change_stewardship = 5
			}
			if = {
				limit = {
					NOT = { learning = 10 }
				}
				change_learning = 5
			}
			if = {
				limit = { 
					b_caletumtown = {
						has_holder = no
					}
				}
				c_caletum = {
					location = {
						build_holding = { 
							title = b_caletumtown 
							type = city 
							holder = PREVPREV 
						}
					}
				}
			}
			else = {
				if = {
					limit = {
						b_caletumtown = {
							NOT = { holding_type = CITY }
						}
					}
					b_caletumtown = { convert_to = CITY }
				}
				b_caletumtown = { 
					gain_title = PREV
				}
			}
			if = {
				limit = { ROOT = { independent = no } }
				ROOT = {
					liege = {
						set_defacto_vassal = PREVPREV
					}
				}
			}
			b_caletumtown = {
				province_capital = yes
			}
			c_caletum = { 
				gain_title = PREV
			}
			b_caletumcastle = { 
				gain_title = ROOT
				ROOT = { 
					set_defacto_liege = PREVPREV
				}
			}
			capital = b_caletumtown
			any_playable_ruler = {
				limit = { ai = no }
				character_event = { id = 313261 days = 1 }
			}
		}
	}
	
	option = {
		name = "OK"
	}
}
narrative_event = {
	id = 313261
	title = "EVTNAME313261"
	desc = "EVTDESC313261"
	picture = "GFX_evt_coastal_town"
	major = yes
	
	hide_from = yes
	
	ai = no
	
	is_triggered_only = yes
	
	option = {	# Strictly related rulers
		name = "EVTOPTA313261"
		trigger = {
			OR = {
				has_character_flag = caletum_rep_close
				location = { province_id = 125 }
			}
		}
		c_caletum = {
			holder_scope = {
				set_character_flag = caletum_legatus
			}
		}
	}
	option = {	# Other rulers
		name = "EVTOPTB313261"
		trigger = {
			NOT = { has_character_flag = caletum_rep_close }
			NOT = { location = { province_id = 125 } }
		}
		c_caletum = {
			holder_scope = {
				set_character_flag = caletum_legatus
			}
		}
	}
}
